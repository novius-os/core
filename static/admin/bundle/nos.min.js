/**
 * NOVIUS OS - Web OS for digital communication
 *
 * @copyright  2011 Novius
 * @license    GNU Affero General Public License v3 or (at your option) any later version
 *             http://www.gnu.org/licenses/agpl-3.0.html
 * @link http://www.novius-os.org
 */
define("jquery-nos-validate",["jquery","jquery.validate","wijmo.wijtooltip"],function(b){var a=function(g,h){var d=this;if(!d.counter){d.counter=1}var c=b(g);var e=this.errorsFor(g);if(e.length){e.removeClass(this.settings.validClass).addClass(this.settings.errorClass);e.closest(".wijmo-wijaccordion-content").prev().addClass(this.settings.errorClass)}else{e=b("<"+this.settings.errorElement+"/>").attr({"for":this.idOrName(g),generated:true}).addClass(this.settings.errorClass).css({background:"transparent",border:"0",padding:"0 4px",width:"32px",verticalAlign:"middle"}).html('<span class="ui-icon ui-icon-alert nos-inline-icon16"></span>');e.wijtooltip({group:"group_"+d.counter++,showCallout:false,calloutFilled:true,closeBehavior:"sticky",position:{my:"right top",at:"center bottom",offset:"0 0"},triggers:"click",content:h,showing:function(l,k){b(k.element).addClass("ui-state-error")}});if(!this.labelContainer.append(e).length){this.settings.errorPlacement?this.settings.errorPlacement(e,b(g)):e.insertAfter(g)}var f=e.data("wijtooltip");f._tooltip.addClass("nos-tooltip-error");var i=f._tooltip;i.find(".wijmo-wijtooltip-close").click(function(){e.data("wijtooltip-manuallyclosed",true)}).removeClass("wijmo-wijtooltip-close").css({background:"none",border:"none",display:"block",height:"16px",position:"absolute",right:"3px",top:"3px",width:"16px"}).parent().removeClass("ui-state-default").addClass("ui-state-error");i.find(".wijmo-wijtooltip-container").addClass("ui-state-error ui-corner-all");e.click(function(){if(i.is(":hidden")&&!c.is(".media")){e.data("wijtooltip-manuallyclosed",false);e.wijtooltip("show")}else{e.data("wijtooltip-manuallyclosed",true);e.wijtooltip("hide")}});var j=b(g).closest(".wijmo-wijaccordion-content").prev().addClass(this.settings.errorClass).removeClass(this.settings.validClass);if(c.hasClass("media")){e.insertAfter(c.closest(".ui-inputfilethumb"));c.closest(".ui-inputfilethumb").find(".ui-inputfilethumb-thumb").addClass(this.settings.errorClass).removeClass(this.settings.validClass);c.bind("change.validation",function(){b(this).valid()})}j.closest(".wijmo-wijaccordion").unbind("wijaccordionselectedindexchanged").bind("wijaccordionselectedindexchanged",function(n,l){var m=b(this).find(".wijmo-wijaccordion-content");var k=m.eq(l.newIndex).find("label[generated=true]");if(k.data("wijtooltip-manuallyclosed")){}else{k.wijtooltip("show")}});j.closest(".wijmo-wijaccordion").bind("wijaccordionbeforeselectedindexchanged",function(m,k){var l=b(this).find(".wijmo-wijaccordion-content");l.eq(k.prevIndex).find("label[generated=true]").wijtooltip("hide")});if(e.is(":visible")){e.wijtooltip("show")}else{e.wijtooltip("hide")}}if(!h&&this.settings.success){e.wijtooltip("hide");e.wijtooltip("destroy");e.closest(".wijmo-wijaccordion-content").prev().addClass(this.settings.validClass).removeClass(this.settings.errorClass);if(c.hasClass("media")){c.closest(".ui-inputfilethumb").find(".ui-inputfilethumb-thumb").addClass(this.settings.validClass).removeClass(this.settings.errorClass);c.unbind("change.validation")}e.removeClass(this.settings.errorClass).addClass(this.settings.validClass);e.remove()}this.toShow=this.toShow.add(e)};b.extend(b.validator.prototype,{showLabel:a,optional:function(c){return !b.validator.methods.required.call(this,b.trim(c.value),c)}})});
define("jquery-nos-wysiwyg",["module","jquery-nos","jquery","tinymce"],function(a,b){b.fn.wysiwyg=function(d){var c=b(this);d=d||{};b.ajax({dataType:"json",url:"admin/nos/wysiwyg/enhancers",data:d.urlEnhancers?{urlEnhancers:true}:null,success:function(e){var f=b("base").attr("href");d=b.extend({document_base_url:f,language:b.nosLang.substr(0,2),script_url:f+"static/novius-os/admin/vendor/tinymce/tiny_mce_jquery"+(a.config().minified?"":"_src")+".js",theme:"nos",skin:"bootstrap",plugins:"spellchecker,xhtmlxtras,style,table,advlist,inlinepopups,media,searchreplace,paste,noneditable,visualchars,nonbreaking",paste_text_use_dialog:true,theme_nos_enhancers:e},d||{});b(c).tinymce(d)}})};return b});
define("jquery-nos",["jquery","jquery-nos-validate","jquery-form","jquery-ui.button","wijmo.wijtextbox","wijmo.wijcheckbox","wijmo.wijradio","wijmo.wijdropdown","wijmo.wijexpander","wijmo.wijaccordion","wijmo.wijdialog"],function(e){var g=void (0),f=window.$nos=e,b=g,a=false,c=function(){if(b===g){b=e(".nos-ostabs")}return b},d={dialogOpened:[],dialogFocused:-1,open:function(j){var h=this,i=j.data("callbacks.nosdialog");h.dialogOpened.push(j[0]);if(!e.isPlainObject(i)){j.data("callbacks.nosdialog",{})}},focus:function(k){var h=this,j=k.data("callbacks.nosdialog"),i=e.inArray(k[0],h.dialogOpened);if(i!==-1){h.dialogOpened.splice(i,1)}h.dialogOpened.push(k[0]);h.dialogFocused=k[0];if(e.isPlainObject(j)){e.each(j,function(l,m){h.fireDialogEvent(k,m)});k.data("callbacks.nosdialog",{})}},close:function(j){var h=this,i=e.inArray(j[0],h.dialogOpened);if(i!==-1){h.dialogOpened.splice(i,1)}if(i>0){h.focus(e(h.dialogOpened[i-1]))}},fireDialogEvent:function(i,h){var k=i.find("> iframe");if(k.size()){if(k[0].contentDocument.$){k[0].contentDocument.$("body").trigger(h)}}else{try{i.trigger(h)}catch(j){log("fireDialogEvent error",j,h)}}},dispatchEvent:function(i){var h=this;e.each(h.dialogOpened,function(){var k=e(this);if(this===h.dialogFocused){h.fireDialogEvent(k,i)}else{var j=k.data("callbacks.nosdialog");if(e.isPlainObject(j)){j[i.type+(i.namespace?"."+i.namespace:"")]=i}}})}};e.extend({nosTexts:{chooseMediaFile:"Choose a media file",chooseMediaImage:"Choose a image",errorImageNotfind:"Weâ€™re afraid we cannot find this image."},nosContext:function(h){h=e.extend({locales:{},sites:{},contexts:{}},h||{});return{locales:h.locales,sites:h.sites,contexts:h.contexts,label:function(i){if(e.type(i)==="string"){i={defaultLabel:i}}i=e.extend({oneLocale:i.allContexts,oneSite:i.allContexts},i);if(Object.keys(this.sites).length===1){return i.oneSite}else{if(Object.keys(this.locales).length===1){return i.oneLocale}}return i.defaultLabel},siteLabel:function(j,i){i=e.extend({"short":false},i||{});if(e.type(j)!=="object"){j=this.site(j)}j=e.extend({alias:j},j);if(i["short"]){return'<span title="'+j.title+'">'+j.alias+"</span>"}else{return j.title}},localeLabel:function(i,j){j=e.extend({"short":false},j||{});if(e.type(i)!=="object"){i=this.locale(i)}i=e.extend({flag:i.code.substr(0,2).toLowerCase()},i);if(j["short"]){return'<img src="static/novius-os/admin/novius-os/img/flags/'+i.flag+'.png" title="'+i.title+'" style="vertical-align:middle;" />'}else{return i.title+' <img src="static/novius-os/admin/novius-os/img/flags/'+i.flag+'.png" title="'+i.title+'" style="vertical-align:middle;" />'}},contextLabel:function(m,l){var k=this.site(m),i=this.locale(m),j;l=e.extend({"short":false,template:"{site} {locale}"},l||{});if(Object.keys(this.sites).length===1){j=this.localeLabel(i,l)}else{if(Object.keys(this.locales).length===1){j=this.siteLabel(k,l)}else{j=l.template.replace("{locale}",this.localeLabel(i,{"short":true})).replace("{site}",this.siteLabel(k,l))}}return j},localeCode:function(j){var i=j.split("::",2);if(!i[1]){return j}return i[1]},locale:function(i){var j=this.localeCode(i);if(!this.locales[j]){return{code:j,title:j,flag:j.substr(0,2).toLowerCase()}}return e.extend({code:j},this.locales[j])},siteCode:function(j){var i=j.split("::",2);return i[0]},site:function(j){var i=this.siteCode(j);if(!this.sites[i]){return{code:i,title:i,alias:i}}return e.extend({code:i},this.sites[i])}}},nosDispatchEvent:function(i){if(window.parent!=window&&window.parent.$nos){return window.parent.$nos.nosDispatchEvent(i)}var h=c(),j=e.Event("noviusos",{noviusos:i});h.ostabs("dispatchEvent",j);d.dispatchEvent(j);return e},nosNotify:function(h,i){if(window.parent!=window&&window.parent.$nos){return window.parent.$nos.nosNotify(h,i)}if(!e.isPlainObject(h)){h={title:h}}if(i!==g){e.extend(h,e.isPlainObject(i)?i:{type:i})}if(e.isPlainObject(h)){require(["link!static/novius-os/admin/vendor/jquery/pnotify/jquery.pnotify.default.css","static/novius-os/admin/vendor/jquery/pnotify/jquery.pnotify"],function(){return e.pnotify(e.extend({styling:"jqueryui",history:false,addclass:"nos-notification"},h))})}return false},nosMediaVisualise:function(i){if(!i.image){window.open(i.path);return}var h=this.offset();h={top:h.top+this.height()/2-16,left:h.left+this.width()/2};require(["wijmo.wijlightbox"],function(){var j=new Image();j.onerror=function(){e.nosNotify(e.nosTexts.errorImageNotfind,"error")};j.onload=function(){var k=e("<div><a><img /></a></div>").find("a").attr({href:i.path,rel:"wijlightbox"}).find("img").attr({src:i.path,title:i.title}).css({width:0,height:0}).end().end().css({position:"absolute",width:0,height:0}).css(h).appendTo(document.body).wijlightbox({zIndex:1201,textPosition:"outside",player:"img",dialogButtons:"fullsize",modal:true,open:function(){e(".wijmo-wijlightbox-overlay").css("z-index",1200)},close:function(l){k.wijlightbox("destroy");k.remove()}});k.find("a").triggerHandler("click")};j.src=i.path})},nosUIElement:function(k,l){var j,m,h,i;k=e.extend({type:"button",bind:{}},k);if(k.action){k.bind.click=e.extend(true,{},k.action);delete k.action}switch(k.type){case"button":i=e("<button></button>").data(k);if(k.label){i.html(k.label)}break;case"link":if(k.iconClasses){h=k.iconClasses}else{if(k.icon){h="nos-inline-icon16 ui-icon ui-icon-"+k.icon}}i=(h?'<span class="'+h+'"></span> ':"");i+='<span class="ui-button-text">'+k.label+"</span>";i=e('<a href="#"></a>').css({display:"inline-block"}).html(i);if(k.red){i.addClass("ui-state-error")}break}if(k.disabled&&k.disabled!==false){i.attr("disabled",true);if(e.type(k.disabled)==="string"){i.attr("title",k.disabled)}}if(i){e.each(k.bind,function(n,o){i.bind(n,function(p){p.preventDefault();i.nosAction(o,l)})});if(k.menu){j=new Date();m=j.getDate()+"_"+j.getHours()+"_"+j.getMinutes()+"_"+j.getSeconds()+"_"+j.getMilliseconds();i.attr("id",m).nosOnShow("one",function(){var n=e("<ul></ul>");e.each(k.menu.menus,function(){var p=this,o=e("<li><a></a></li>").data("action",p.action).appendTo(n).find("a");if(p.content){o.append(p.content)}else{if(p.icon){e("<span></span>").addClass("ui-icon wijmo-wijmenu-icon-left ui-icon-"+p.icon).appendTo(o)}else{if(p.iconClasses){e("<span></span>").addClass("wijmo-wijmenu-icon-left "+p.iconClasses).appendTo(o)}else{if(p.iconUrl){e("<span></span>").addClass("wijmo-wijmenu-icon-left  nos-icon16").css("backgroundImage","url("+p.iconUrl+")").appendTo(o)}}}if(p.label){e("<span></span>").addClass("wijmo-wijmenu-text").html(p.label).appendTo(o)}}});n.insertAfter(i).wijmenu(e.extend(true,{orientation:"vertical",animation:{animated:"slide",option:{direction:"up"},duration:50,easing:null},hideAnimation:{animated:"slide",option:{direction:"up"},duration:0,easing:null}},k.menu.options||{},{trigger:"#"+m,select:function(p,o){var q=e(o.item.element);q.nosAction(q.data("action"))}}))})}}return i},nosDataReplace:function(i,h){if(e.type(i)==="string"){return i.replace(/{{([\w]+)}}/g,function(m,l,k,j){return h[l]||""}).replace(/{{urlencode:([\w]+)}}/g,function(m,l,k,j){return encodeURIComponent(h[l]||"")})}else{if(e.isPlainObject(i)){e.each(i,function(j,k){i[j]=e.nosDataReplace(k,h)})}}return i},nosCleanupTranslation:function(h){return h.replace(/&nbsp;/g," ")}});e.fn.extend({nosAction:function(m,k){var j,n;k=k||{};try{if(e.isFunction(m)){m(e(this),k)}else{switch(m.action){case"nosTabs":var i=[];n=e.extend(true,{},m);n.method&&i.push(n.method);i.push(e.nosDataReplace(n.tab,k));n.dialog&&i.push(n.dialog);e.fn.nosTabs.apply(e(this),i);break;case"confirmationDialog":n=e.extend(true,{ajax:true,width:500,height:"auto","class":"nos-confirmation-dialog"},e.nosDataReplace(e.extend(true,{},m.dialog),k));e(this).nosDialog(n);break;case"nosDialog":n=e.nosDataReplace(e.extend(true,{},m.dialog),k);e(this).nosDialog(n);break;case"nosAjax":n=e.nosDataReplace(e.extend(true,{},m.params),k);e(this).nosAjax(n);break;case"nosMediaVisualise":e.nosMediaVisualise.call(this,k);break;case"dialogPick":e(this).closest(".ui-dialog-content").trigger(m.event,k);break;case"window.open":j=e.nosDataReplace(m.url,k);window.open(j);break;case"document.location":j=e.nosDataReplace(m.url,k);if(!(j.substr(0,5)==="http:"||j.substr(0,6)==="https:")){var h=e("base");if(h.size()){j=h.attr("href")+j}}document.location.href=j;break}}}catch(l){log("nosAction",l)}return false},nosAjax:function(k){var i=e.extend({cache:false,dataType:"json",type:"POST",data:{}},k||{}),l=i.success,j=i.error,h=this;if(i.dataType=="json"){i.success=function(m){if(e.isFunction(l)){m.user_success=l}h.nosAjaxSuccess(m)}}i.error=function(m,n){h.nosAjaxError(m,n);if(e.isFunction(j)){j.call(this,m,n)}};return e.ajax(i)},nosAjaxSuccess:function(m){if(m.error){if(e.isArray(m.error)){e.each(m.error,function(){e.nosNotify(this,"error")})}else{e.nosNotify(m.error,"error")}}if(m.internal_server_error){var n=m.internal_server_error;var o="An internal server error has been detected.\n\n";o+=n.type+" [ "+n.severity+" ]: "+n.message+"\n";o+=n.filepath+" @ line "+n.error_line+"\n\n";o+="Backtrace:\n";for(var l=0;l<n.backtrace.length;l++){o+=(l+1)+": "+n.backtrace[l].file+" @ line "+n.backtrace[l].line+"\n"}if(console){console.error(o)}}if(m.notify){if(e.isArray(m.notify)){e.each(m.notify,function(){e.nosNotify(this)})}else{e.nosNotify(m.notify)}}if(m.action){var h=this;if(e.isArray(m.action)){e.each(m.action,function(){e(h).nosAction(this)})}else{e(h).nosAction(m.action)}}if(e.isFunction(m.user_success)){m.user_success.call(this,m)}var k=this.closest(".ui-dialog-content").size();if(k){if(m.closeDialog){this.nosDialog("close")}}else{if(m.closeTab){this.nosTabs("close")}if(m.redirect){document.location.href=m.redirect}if(m.replaceTab){this.nosTabs("update",{url:m.replaceTab,reload:true})}}if(m.dispatchEvent){var j=m.dispatchEvent;if(!e.isArray(j)){j=[j]}e.each(j,function(p,q){e.nosDispatchEvent(q)})}return this},nosAjaxError:function(h,j){if(h.status==403){try{var i=e.parseJSON(h.responseText);if(i.login_popup&&!a){i.login_popup.close=function(){a=false};i.login_popup.contentUrl+="?lang="+e.nosLang;e("body").nosDialog("open",i.login_popup);a=true}return}catch(j){}}if(h.status!=0){e.nosNotify("Connection error!","error")}else{if(j=="parsererror"){e.nosNotify("Request seemed a success, but we could not read the answer.")}else{if(j=="timeout"){e.nosNotify("Time out (server is busy?). Please try again.")}}}return this},nosSaveUserConfig:function(h,i){this.nosAjax({url:"admin/nos/noviusos/save_user_configuration",data:{key:h,configuration:i}});return this},nosMedia:function(j){j=j||{};var h={all:"admin/noviusos_media/appdesk?view=media_pick",image:"admin/noviusos_media/appdesk?view=image_pick"},k={all:e.nosTexts.chooseMediaFile,image:e.nosTexts.chooseMediaImage},l=this;var i=e.extend({title:l.attr("title")||"File",allowDelete:true,classes:j.mode,choose:function(){var m=l.nosDialog({destroyOnClose:true,contentUrl:h[j.mode],ajax:true,title:k[j.mode]}).bind("select_media",function(o,n){l.inputFileThumb({file:n.image?n.thumbnail:n.path});l.val(n.id).trigger("change",{item:n});m.nosDialog("close")})}},j.inputFileThumb||{});require(["static/novius-os/admin/vendor/jquery/jquery-ui-input-file-thumb/js/jquery.input-file-thumb","link!static/novius-os/admin/vendor/jquery/jquery-ui-input-file-thumb/css/jquery.input-file-thumb.css"],function(){e(function(){l.inputFileThumb(i);l.prependTo(l.closest(".ui-widget-content"))})});return this},nosFormUI:function(){var h=this;h.find(":input[type='text'],:input[type='password'],:input[type='email'],textarea").filter(":not(.notransform)").wijtextbox();h.find(":input[type='submit'],button").filter(":not(.notransform)").each(function(){var l=e(this).data(),i=e.extend(true,{icons:{}},l||{}),j={},k=e(this);if(l.red){k.addClass("ui-state-error")}l.icons=e.extend(true,{primary:null,secondary:null},l.icons||{});if(l.icon){l.icons.primary={icon:l.icon}}else{if(l.iconClasses){l.icons.primary={iconClasses:l.iconClasses}}else{if(l.iconUrl){l.icons.primary={iconUrl:l.iconUrl}}}}e.each(l.icons,function(m,n){if(!n){return true}if(e.type(n)==="string"){i.icons[m]="ui-icon-"+n.replace("ui-icon-","")}else{if(n.icon){i.icons[m]="ui-icon-"+n.icon.replace("ui-icon-","")}else{if(n.iconClasses){i.icons[m]=n.iconClasses}else{if(n.iconUrl){j[m]=n.iconUrl;i.icons[m]="nos-icon16"}}}}});k.button(i);e.each(j,function(n,m){k.find("span.ui-button-icon-"+n).css({backgroundImage:"url("+m+")"})})});h.find("select").filter(":not(.notransform)").nosOnShow("one",function(){var i=e(this).wijdropdown().closest(".wijmo-wijdropdown");i.width(i.width()+5)});h.find(":input[type=checkbox]").filter(":not(.notransform)").nosOnShow("one",function(){e(this).wijcheckbox()});h.find(":input[type=radio]").filter(":not(.notransform)").nosOnShow("one",function(){e(this).wijradio()});h.find(".expander").add(h.filter(".expander")).filter(":not(.notransform)").each(function(){var i=e(this);i.wijexpander(e.extend({expanded:true},i.data("wijexpander-options")))});h.find(".accordion").add(h.filter(".accordion")).filter(":not(.notransform)").wijaccordion({header:"h3",selectedIndexChanged:function(j,i){e(j.target).find(".wijmo-wijaccordion-content").eq(i.newIndex).nosOnShow()}});return h},nosFormValidate:function(i){var h=this;i=i||{};if(!h.is("form")){h=h.find("form")}require(["jquery-nos-validate"],function(){h.validate(e.extend({},i,{errorClass:"ui-state-error",success:true,ignore:"input[type=hidden]"}))});return this},nosFormAjax:function(){var h=this;if(!h.is("form")){h=h.find("form")}require(["jquery-form"],function(){h.ajaxForm({dataType:"json",success:function(i){h.nosAjaxSuccess(i).triggerHandler("ajax_success",[i])},error:function(i,j){h.nosAjaxError(i,j)}})});return this},nosOnShow:function(){var h=Array.prototype.slice.call(arguments),j="show";if(h.length>0&&e.inArray(h[0],["one","bind","show"])!==-1){j=h.shift()}switch(j){case"one":case"bind":var i=h[0];if(!e.isFunction(i)){return}this.each(function(){var l=e(this),k=l.data("nos-on-show")||0;l.addClass("nos-on-show").data("nos-on-show",k+(j==="bind"?1:0))[j]("nos-on-show",i);if(l.is(":visible")){l.nosOnShow()}});break;case"show":this.not(".nos-on-show-exec").addClass("nos-on-show-exec").each(function(){var l=e(this),k=l.data("nos-on-show")||0;if(l.is(".nos-on-show")){l.css("display","block")}if(!l.is(":visible")){return true}if(l.is(".nos-on-show")){if(!k){l.removeClass("nos-on-show")}l.trigger("nos-on-show")}l.find(".nos-on-show").not(".nos-on-show-exec").nosOnShow()}).removeClass("nos-on-show-exec");break}return this},nosDialog:function(){var l=Array.prototype.slice.call(arguments),h="open";if(l.length>0&&e.inArray(l[0],["open","close"])!==-1){h=l.shift()}switch(h){case"open":if(this.is(".ui-dialog-content")){this.closest(".ui-dialog").show().appendTo("body");this.wijdialog("open");return this}var p=l[0]||{},q=e.extend(true,{},{destroyOnClose:true,width:window.innerWidth-200,height:window.innerHeight-100,modal:true,captionButtons:{pin:{visible:false},refresh:{visible:p.contentUrl!=null&&!p.ajax},toggle:{visible:false},minimize:{visible:false},maximize:{visible:false}}},p),m={open:q.open,close:q.close,focus:q.focus},n=this.closest(".nos-dispatcher, body"),o=this,i=e("<div></div>").addClass("nos-dispatcher").appendTo(n);e.extend(q,{close:function(s,r){d.close(i);if(e.isFunction(m.close)){m.close.apply(i,arguments)}if(q.destroyOnClose){i.wijdialog("destroy").remove()}else{i.closest(".ui-dialog").hide().appendTo(n)}},focus:function(s,r){d.focus(i);if(e.isFunction(m.focus)){m.focus.apply(i,arguments)}},open:function(s,r){d.open(i);if(e.isFunction(m.open)){m.open.apply(i,arguments)}}});if(q.content!==g){i.append(q.content)}if(q["class"]!==g){i.addClass(q["class"])}var k=true;if(q.ajax&&q.contentUrl){var j=q.contentUrl;delete q.contentUrl;q.autoOpen=false;i.wijdialog(q);i.nosAjax({url:j,type:"GET",dataType:"html",data:q.ajaxData||{},complete:function(t,r,u){u=t.responseText;if(t.state()==="resolved"){t.done(function(w){u=w});try{var s=e.parseJSON(u);k=false}catch(v){}if(k){i.wijdialog("open").html(u);e.isFunction(q.dialogRendered)&&q.dialogRendered(i)}else{i.empty().wijdialog("destroy").remove();o.nosAjaxSuccess(s)}}}})}else{i.wijdialog(q);e.isFunction(q.dialogRendered)&&q.dialogRendered(i)}if(k&&e.isFunction(q.onLoad)){q.onLoad()}return i;break;case"close":this.closest(":wijmo-wijdialog").wijdialog("close");break}return this},nosListenEvent:function(h,m,k){var i=this,l=this.closest(".nos-dispatcher, body"),j=l.data("noviusos-listens");k=k||null;if(!e.isArray(j)){l.on("noviusos",function(n){n.noviusos=n.noviusos||{};e.each(l.data("noviusos-listens"),function(r,q){var p=q.json_match,s=q.callback,o=false;e.each(p,function(t,u){var v=true;e.each(u,function(x,y){if(!e.isArray(n.noviusos[x])&&!e.isArray(y)){v=n.noviusos[x]===y}else{if(e.isArray(n.noviusos[x])&&!e.isArray(y)){v=e.inArray(y,n.noviusos[x])!==-1}else{if(!e.isArray(n.noviusos[x])&&e.isArray(y)){v=e.inArray(n.noviusos[x],y)!==-1}else{if(e.isArray(n.noviusos[x])&&e.isArray(y)){var w=false;e.each(y,function(z,A){w=e.inArray(A,n.noviusos[x])!==-1;return !w});v=w}}}}return v});if(v){o=true;return false}});if(o){s(n.noviusos)}})})}j=e.isArray(j)?j:[];j.push({caller:k,json_match:e.isArray(h)?h:[h],callback:m});l.data("noviusos-listens",j);return i},nosUnlistenEvent:function(j){var h=this,k=this.closest(".nos-dispatcher, body"),i=k.data("noviusos-listens");if(e.isArray(i)){i=e.extend(true,[],i);for(var l=0;l<i.length;l++){if(i[l].caller===j){i.splice(l,1);l--}}k.data("noviusos-listens",i)}return h},nosTabs:function(){var i=Array.prototype.slice.call(arguments),k="open",j=function(l){if(window.parent!=window&&window.parent.$nos){return window.parent.$nos(window.frameElement).data("nos-ostabs-index")}var m=e(l).parents(".nos-ostabs-panel-content");if(m.size()){return m.data("nos-ostabs-index")}return false},h=this;if(i.length>0&&e.inArray(i[0],["open","close","add","update","init","current"])!==-1){k=i.shift()}switch(k){case"open":(function(){var o=i[0]||{},n=i[1]||{},m=h.closest(".ui-dialog-content").size();if(m){h.nosDialog(e.extend({contentUrl:o.url,ajax:!o.iframe,title:o.label},n))}else{if(window.parent!=window&&window.parent.$nos){window.parent.$nos(window.frameElement).nosTabs("open",o,n)}else{if(c().length){var l=c().ostabs("tabs"),p=false;e.each(l,function(r,q){if(q.url===o.url){p=r;return false}});if(p!==false){return c().ostabs("select",p+1)}else{h.nosTabs("add",o)}}else{if(o.url){window.open(o.url)}}}}})();break;case"add":(function(){var p=i[0],o=i[1]||{},n=h.closest(".ui-dialog-content").size(),l=i[2]||"end";if(n){h.nosDialog(e.extend({contentUrl:p.url,ajax:!p.iframe,title:p.label},o))}else{if(window.parent!=window&&window.parent.$nos){window.parent.$nos(window.frameElement).nosTabs("add",p,l)}else{var m;if(e.inArray(l,["before","after"])!==-1){m=j(h)+(l==="before"?-1:1)}if(c().length){m=c().ostabs("add",p,m);c().ostabs("select",m)}else{if(p.url){window.open(p.url)}}}}})();break;case"close":(function(){var m=h.closest(":wijmo-wijdialog");if(m.size()){h.nosDialog("close")}else{if(window.parent!=window&&window.parent.$nos){window.parent.$nos(window.frameElement).nosTabs("close")}else{var l=j(h);if(c().length){c().ostabs("remove",l)}}}})();break;case"update":(function(){var m=i[0];if(window.parent!=window&&window.parent.$nos){window.parent.$nos(window.frameElement).nosTabs("update",m)}else{if(h.size()&&!h.closest(".ui-dialog-content").size()&&c().length){var l=j(h);c().ostabs("update",l,m)}}})();break;case"current":return(function(){if(window.parent!=window&&window.parent.$nos){return window.parent.$nos(window.frameElement).nosTabs("current")}else{if(c().length){return c().ostabs("current")}}return null})();break;case"init":(function(){var n=i[0],m=false,l=function(){if(c().length){if(m){clearTimeout(m)}m=setTimeout(function(){c().nosSaveUserConfig("tabs",{selected:c().ostabs("option","selected"),tabs:c().ostabs("tabs")})},500)}};b=h;e.extend(n,{add:l,remove:l,select:l,show:l,drag:l,update:l});if(n.user_configuration["tabs"]){if(!n.options){n.options={}}n.initTabs=n.user_configuration["tabs"]["tabs"];n.selected=n.user_configuration["tabs"]["selected"]}b.ostabs(n)})();break}return this},nosToolbar:function(){var i=Array.prototype.slice.call(arguments),j="add",h=this;if(i.length>0&&e.inArray(i[0],["create","add"])!==-1){j=i.shift()}switch(j){case"create":return(function(){var k=e('<table><tr><td class="nos-toolbar-left"><table><tr class="nos-toolbar-left"></tr></table></td><td class="nos-toolbar-right"><table><tr class="nos-toolbar-right"></tr></table></td></tr></table>').addClass("nos-toolbar ui-widget-header").insertBefore(h);h.addClass("nos-toolbar-target fill-parent nos-fixed-content").parent().addClass("nos-toolbar-parent");return k})();break;case"add":return(function(){var n=i[0],l=i[1],k=h.closest(".nos-toolbar-target"),m,o;if(!k.size()){h.nosToolbar("create");k=h}m=k.prev();o=e(n);e("<td></td>").append(o).appendTo(m.find("tr.nos-toolbar-"+(l?"right":"left"))).nosFormUI();k.css({top:m.outerHeight(),bottom:0,height:"auto"});return o})();break}return this}});return e});
define("jquery-nos-loadspinner",["jquery","jquery-nos","jquery-ui.widget"],function(a){a.widget("nos.loadspinner",{options:{diameter:40,color:null,density:40,range:1.3,scaling:false,fading:true,shape:"circle",speed:2,fps:24},shapes:["circle","square","rectangle","roundedRectangle"],colorReg:/^\#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/,colorRgb:/^rgb\((\d+)[ \,]+(\d+)[ \,]+(\d+)\)$/,UISpinnerCanvas:null,UISpinnerContext:null,UISpinnerCacheCanvas:null,UISpinnerCacheContext:null,running:false,ready:false,timer:null,activeId:0,colorRGB:null,_create:function(){this.UISpinnerCanvas=a("<canvas></canvas>").attr("id","CanvasLoader").get(0);this.UISpinnerContext=this.UISpinnerCanvas.getContext("2d");this.element.append(this.UISpinnerCanvas);this.UISpinnerCanvas.width=this.UISpinnerCanvas.height=this.options.diameter;this.UISpinnerCacheCanvas=a("<canvas></canvas>").get(0);a("body").append(this.UISpinnerCacheCanvas);this.UISpinnerCacheContext=this.UISpinnerCacheCanvas.getContext("2d");this.UISpinnerCacheCanvas.width=this.UISpinnerCacheCanvas.height=this.options.diameter;a(this.UISpinnerCacheCanvas).hide()},_init:function(){if(!this.options.color){this.options.color=this.element.css("color")}this._setOption("color",this.options.color);this.ready=true;this._draw();this.start()},_setOption:function(c,d){var b=this;switch(c){case"diameter":if(isNaN(d)){return}d=Math.round(Math.abs(d));break;case"color":this.colorRGB=this._RGB(d);break;case"shape":if(a.inArray(d,this.shapes)==-1){return}break;case"density":if(isNaN(d)){return}d=Math.round(Math.abs(d));break;case"range":if(isNaN(d)){return}d=Math.abs(d);break;case"speed":if(isNaN(d)&&Math.abs(d)>0){return}d=Math.round(Math.abs(d));break;case"fps":if(isNaN(d)){return}d=Math.round(Math.abs(d));break}a.Widget.prototype._setOption.apply(b,arguments);if(a.inArray(c,["diameter","color","shape","density","range","scaling","fading"])!=-1){this._redraw()}else{if(a.inArray(c,["speed","fps"])!=-1){this._reset()}}},_RGB:function(c){var b={};if(this.colorReg.test(c)){c=c.charAt(0)==="#"?c.substring(1,7):c;if(c.length==3){c=c+c}b.r=parseInt(c.substring(0,2),16);b.g=parseInt(c.substring(2,4),16);b.b=parseInt(c.substring(4,6),16)}else{if(this.colorRgb.exec(c)){b.r=parseInt(RegExp.$1);b.g=parseInt(RegExp.$2);b.b=parseInt(RegExp.$3)}else{b.r=0;b.g=0;b.b=0}}return b},_draw:function(){var e=0,o=this.options.diameter*0.07,d,k,n,j,m,l,c,g=0.1,b=Math.round(this.options.density*this.options.range),f;this.UISpinnerCacheContext.clearRect(0,0,this.UISpinnerCacheCanvas.width,this.UISpinnerCacheCanvas.height);this.UISpinnerCanvas.width=this.UISpinnerCanvas.height=this.UISpinnerCacheCanvas.width=this.UISpinnerCacheCanvas.height=this.options.diameter;switch(this.options.shape){case this.shapes[0]:while(e<this.options.density){if(e<=b){f=1-((1-g)/b*e)}else{f=g}d=(this.options.density-e)*((Math.PI*2)/this.options.density);m=this.UISpinnerCanvas.width*0.5+Math.cos(d)*(this.options.diameter*0.45-o)-this.UISpinnerCanvas.width*0.5;l=this.UISpinnerCanvas.height*0.5+Math.sin(d)*(this.options.diameter*0.45-o)-this.UISpinnerCanvas.height*0.5;this.UISpinnerCacheContext.beginPath();if(this.options.fading){this.UISpinnerCacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+","+f.toString()+")"}else{this.UISpinnerCacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+",1)"}if(this.options.scaling){this.UISpinnerCacheContext.arc(this.options.diameter*0.5+m,this.options.diameter*0.5+l,o*f,0,Math.PI*2,false)}else{this.UISpinnerCacheContext.arc(this.options.diameter*0.5+m,this.options.diameter*0.5+l,o,0,Math.PI*2,false)}this.UISpinnerCacheContext.closePath();this.UISpinnerCacheContext.fill();e+=1}break;case this.shapes[1]:o=this.UISpinnerCanvas.width*0.12;while(e<this.options.density){if(e<=b){f=1-((1-g)/b*e)}else{f=g}c=360-360/this.options.density*e;d=c/180*Math.PI;m=Math.cos(d)*o*3+this.UISpinnerCacheCanvas.width*0.5;l=Math.sin(d)*o*3+this.UISpinnerCacheCanvas.height*0.5;this.UISpinnerCacheContext.save();this.UISpinnerCacheContext.translate(m,l);this.UISpinnerCacheContext.rotate(d);this.UISpinnerCacheContext.translate(-m,-l);this.UISpinnerCacheContext.beginPath();if(this.options.fading){this.UISpinnerCacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+","+f.toString()+")"}else{this.UISpinnerCacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+",1)"}this.UISpinnerCacheContext.fillRect(m,l-o*0.5,o,o);this.UISpinnerCacheContext.closePath();this.UISpinnerCacheContext.fill();this.UISpinnerCacheContext.restore();e+=1}break;case this.shapes[2]:n=this.UISpinnerCacheCanvas.width*0.24;j=n*0.35;while(e<this.options.density){if(e<=b){f=1-((1-g)/b*e)}else{f=g}c=360-360/this.options.density*e;d=c/180*Math.PI;m=Math.cos(d)*(j+(this.UISpinnerCacheCanvas.height-j)*0.13)+this.UISpinnerCacheCanvas.width*0.5;l=Math.sin(d)*(j+(this.UISpinnerCacheCanvas.height-j)*0.13)+this.UISpinnerCacheCanvas.height*0.5;this.UISpinnerCacheContext.save();this.UISpinnerCacheContext.translate(m,l);this.UISpinnerCacheContext.rotate(d);this.UISpinnerCacheContext.translate(-m,-l);this.UISpinnerCacheContext.beginPath();if(this.options.fading){this.UISpinnerCacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+","+f.toString()+")"}else{this.UISpinnerCacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+",1)"}this.UISpinnerCacheContext.fillRect(m,l-j*0.5,n,j);this.UISpinnerCacheContext.closePath();this.UISpinnerCacheContext.fill();this.UISpinnerCacheContext.restore();e+=1}break;case this.shapes[3]:n=this.UISpinnerCacheCanvas.width*0.24;j=n*0.35;k=j*0.65;while(e<this.options.density){if(e<=b){f=1-((1-g)/b*e)}else{f=g}c=360-360/this.options.density*e;d=c/180*Math.PI;m=Math.cos(d)*(j+(this.UISpinnerCacheCanvas.height-j)*0.13)+this.UISpinnerCacheCanvas.width*0.5;l=Math.sin(d)*(j+(this.UISpinnerCacheCanvas.height-j)*0.13)+this.UISpinnerCacheCanvas.height*0.5;this.UISpinnerCacheContext.save();this.UISpinnerCacheContext.translate(m,l);this.UISpinnerCacheContext.rotate(d);this.UISpinnerCacheContext.translate(-m,-l);if(this.options.fading){this.UISpinnerCacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+","+f.toString()+")"}else{this.UISpinnerCacheContext.fillStyle="rgba("+this.colorRGB.r+","+this.colorRGB.g+","+this.colorRGB.b+",1)"}this.UISpinnerCacheContext.beginPath();this.UISpinnerCacheContext.moveTo(m+k,l-j*0.5);this.UISpinnerCacheContext.lineTo(m+n-k,l-j*0.5);this.UISpinnerCacheContext.quadraticCurveTo(m+n,l-j*0.5,m+n,l-j*0.5+k);this.UISpinnerCacheContext.lineTo(m+n,l-j*0.5+j-k);this.UISpinnerCacheContext.quadraticCurveTo(m+n,l-j*0.5+j,m+n-k,l-j*0.5+j);this.UISpinnerCacheContext.lineTo(m+k,l-j*0.5+j);this.UISpinnerCacheContext.quadraticCurveTo(m,l-j*0.5+j,m,l-j*0.5+j-k);this.UISpinnerCacheContext.lineTo(m,l-j*0.5+k);this.UISpinnerCacheContext.quadraticCurveTo(m,l-j*0.5,m+k,l-j*0.5);this.UISpinnerCacheContext.closePath();this.UISpinnerCacheContext.fill();this.UISpinnerCacheContext.restore();e+=1}break}this._tick(true);return this},_clean:function(){this.UISpinnerContext.clearRect(0,0,this.UISpinnerCanvas.width,this.UISpinnerCanvas.height);return this},_redraw:function(){if(this.ready){this._clean();this._draw()}return this},_reset:function(){if(this.running){this.stop();this.start()}return this},_tick:function(b){var c=this.options.density>360?this.options.density/360:360/this.options.density;c*=this.options.speed;if(!b){this.activeId+=c}if(this.activeId>360){this.activeId-=360}this.UISpinnerContext.clearRect(0,0,this.options.diameter,this.options.diameter);this.UISpinnerContext.save();this.UISpinnerContext.translate(this.options.diameter*0.5,this.options.diameter*0.5);this.UISpinnerContext.rotate(Math.PI/180*this.activeId);this.UISpinnerContext.translate(-this.options.diameter*0.5,-this.options.diameter*0.5);this.UISpinnerContext.drawImage(this.UISpinnerCacheCanvas,0,0,this.options.diameter,this.options.diameter);this.UISpinnerContext.restore();return this},start:function(){if(!this.running){this.running=true;var b=this;this.timer=window.setInterval(function(){b._tick()},Math.round(1000/this.options.fps))}return this},stop:function(){if(this.running){this.running=false;clearInterval(this.timer);this.timer=null;delete this.timer}return this},destroy:function(){if(this.running){this.stop()}a(this.UISpinnerCanvas).remove();a(this.UISpinnerCacheCanvas).remove();a.Widget.prototype.destroy.apply(this);return this}});return a});
define("jquery-nos-ostabs",["jquery","jquery-nos","jquery-ui.widget","jquery-nos-loadspinner","jquery-ui.sortable","wijmo.wijsuperpanel","wijmo.wijmenu","modernizr"],function(a){var b=void (0);a.widget("nos.ostabs",{options:{initTabs:[],newTab:"appsTab",trayView:[],appsTab:{},fx:null,labelMinWidth:100,labelMaxWidth:200,selected:null,texts:{newTab:"New tab",closeTab:"Close tab",closeTabs:"Close all tabs",closeOtherTabs:"Close all other tabs",confirmCloseOtherTabs:"Are you sure to want to close all other tabs?",confirmCloseTabs:"Are you sure to want to close all tabs?",reloadTab:"Reload tab"},add:null,remove:null,select:null,show:null,drag:null},tabId:0,openRank:0,_create:function(){var c=this,d=c.options;c._tabify(true);a(window).resize(function(){if(d.selected){c._firePanelEvent(c.panels.eq(d.selected),a.Event("resizePanel"))}})},_setOption:function(d,e){var c=this;if(d=="selected"){c.select(e)}else{c.options[d]=e;c._tabify()}},_getNextTabId:function(){var c=this;return ++c.tabId},_tabId:function(c){var d=this;return a(c).data("panelid.tabs")||"nos-ostabs-"+d._getNextTabId()},_sanitizeSelector:function(c){return c.replace(/:/g,"\\:")},_ui:function(c,d){var e=this,f=e.lis.index(c);if(d===b){d=e.element.find(e._sanitizeSelector(a(e.anchors[f]).data("anchor.tabs")))[0]}return{tab:c,panel:d,index:f}},_cleanup:function(){var c=this;c.lis.filter(".ui-state-processing").removeClass("ui-state-processing").find("span.nos-ostabs-icon").removeClass("nos-ostabs-loader").each(function(){if(a.isFunction(a.fn.loadspinner)){a(this).loadspinner("destroy")}}).html(" ");return c},_tabify:function(p){var q=this,f=q.options,d=/^#.+/;if(p){q.element.addClass("nos-ostabs ui-widget ui-widget-content"+(Modernizr.touch?" nos-ostabs-touch":""));q.uiOstabsHeader=a("<div></div>").addClass("nos-ostabs-header").appendTo(q.element);q.uiOstabsSuperPanel=a("<div></div>").addClass("nos-ostabs-tabs").appendTo(q.uiOstabsHeader);q.uiOstabsTray=a("<div></div>").addClass("nos-ostabs-tray nos-ostabs-nav");if(f.trayView!==null){q.uiOstabsTray.html(f.trayView)}q.uiOstabsTray.prependTo(q.uiOstabsHeader);q.uiOstabsTray.find("#menu").wijmenu();if(a.isPlainObject(f.appsTab)){q.uiOstabsAppsTab=a("<ul></ul>").addClass("nos-ostabs-appstab  nos-ostabs-nav").prependTo(q.uiOstabsHeader);q._add(f.appsTab,q.uiOstabsAppsTab,true).addClass("nos-ostabs-appstab").removeClass("ui-state-default")}else{q.uiOstabsAppsTab=a("<ul></ul>")}q.uiOstabsSuperPanel.css("left",q.uiOstabsAppsTab.outerWidth(true)+25).css("right",q.uiOstabsTray.outerWidth(true)+35).wijsuperpanel({allowResize:false,autoRefresh:true,hScroller:{scrollBarVisibility:"hidden",scrollMode:"buttons",increaseButtonPosition:{my:"left bottom",at:"right bottom"},decreaseButtonPosition:{my:"right bottom",at:"left bottom"}},vScroller:{scrollBarVisibility:"hidden"},showRounder:false}).removeClass("ui-widget ui-widget-content").css("overflow","visible");q.uiOstabsSuperPanelContent=q.uiOstabsSuperPanel.wijsuperpanel("getContentElement");q.uiOstabsTabs=a("<ul></ul>").appendTo(q.uiOstabsSuperPanelContent);if(a.isArray(f.initTabs)){a.each(f.initTabs,function(o,r){q._add(r)})}var e=f.newTab;if(a.isPlainObject(e)){e=a.extend({label:f.texts.newTab,iconClasses:"ui-icon ui-icon-circle-plus"},e)}else{if(e&&a.isPlainObject(f.appsTab)){e=a.extend({},f.appsTab,{label:f.texts.newTab,iconClasses:"ui-icon ui-icon-circle-plus",iconUrl:"",iconSize:16})}else{e=false}}if(e){q.uiOstabsNewTab=q._add(e,null,true).addClass("nos-ostabs-newtab")}else{q.uiOstabsNewTab=a("<li>/<li>")}q.uiOstabsNewTab.hover(function(){a(this).find(".nos-ostabs-label").css("display","inline-block");q._tabsWidth()},function(){a(this).find(".nos-ostabs-label").css("display","none");q._tabsWidth()});q.uiOstabsTabs.sortable({items:"li:not(.nos-ostabs-newtab)",appendTo:q.uiOstabsSuperPanelContent,cursor:"move",delay:250,scroll:false,helper:"clone",tolerance:"pointer",axis:"x",zIndex:100000,placeholder:"ui-state-highlight",forcePlaceholderSize:true,start:function(){q.sorting=true},stop:function(){q.sorting=false},update:function(){q._trigger("drag",null);q.lis=q.uiOstabsAppsTab.add(q.uiOstabsTabs).find("li");q.anchors=q.lis.map(function(r){var o=a("a",this)[0];q.element.find(q._sanitizeSelector(a(o).data("anchor.tabs"))).find(".nos-ostabs-panel-content").data("nos-ostabs-index",r);return o});q._tabsWidth()}});q.tabsWidth=q.uiOstabsSuperPanelContent.width();q.labelWidth=f.labelMaxWidth;q.uiOstabsTabs.width(q.tabsWidth)}var l=[];q.lis=q.uiOstabsAppsTab.add(q.uiOstabsTabs).find("li").each(function(o){var s=a(this),r=s.data("ui-ostab")||{};if(!s.hasClass("nos-ostabs-appstab")&&r.openRank!==false){l[r.openRank]=s}});q.openRank=1;a.each(l,function(o,s){if(s){var r=s.data("ui-ostab")||{};r.openRank=q.openRank++}});q.anchors=q.lis.map(function(){return a("a",this)[0]});q.panels=a([]);q.anchors.each(function(v,x){var t=a(x),o=t.attr("href"),u=t.data("anchor.tabs");if(!o&&u){x.href=u;o=u}var w=o.split("#")[0],y,z;if(w&&(w===location.toString().split("#")[0]||(y=a("base")[0])&&w===y.href)){o=x.hash;x.href=o}if(d.test(o)){z=q.element.find(q._sanitizeSelector(o));q.panels=q.panels.add(z)}else{if(o&&o!=="#"){t.data("href.tabs",o);t.data("load.tabs",o.replace(/#.*$/,""));var r=q._tabId(x);x.href="#"+r;z=q.element.find("#"+r);if(!z.length){var s=q.lis.eq(v).data("ui-ostab");z=a("<div></div>").attr("id",r).addClass("nos-ostabs-panel ui-widget-content ui-corner-bottom nos-ostabs-hide").appendTo(q.element);q._actions(z,v)}q.panels=q.panels.add(z)}}t.data("anchor.tabs",x.hash).removeAttr("href");z.find(".nos-ostabs-panel-content").data("nos-ostabs-index",v)});if(p){q.uiOstabsTray.add(q.uiOstabsAppsTab).addClass("nos-ostabs-nav ui-helper-reset ui-helper-clearfix");q.lis.addClass("ui-corner-top");q.panels.addClass("nos-ostabs-panel ui-widget-content");if(f.selected===b){if(location.hash){q.anchors.each(function(r,o){if(a(o).data("anchor.tabs")==location.hash){f.selected=r;return false}})}if(typeof f.selected!=="number"&&q.lis.filter(".nos-ostabs-selected").length){f.selected=q.lis.index(q.lis.filter(".nos-ostabs-selected"))}f.selected=f.selected||(q.lis.length?0:-1)}f.selected=((f.selected>=0&&q.anchors[f.selected])||f.selected<0)?f.selected:0;q.panels.addClass("nos-ostabs-hide");q.lis.removeClass("nos-ostabs-selected ui-state-active");if(f.selected>=0&&q.anchors.length){q.element.find(q._sanitizeSelector(a(q.anchors[f.selected]).data("anchor.tabs"))).removeClass("nos-ostabs-hide");q.lis.eq(f.selected).addClass("nos-ostabs-selected ui-state-active ui-state-open");q.element.queue("tabs",function(){q._trigger("show",null,q._ui(q.lis[f.selected]))});q.title(f.selected,q.title(f.selected));q._load(f.selected)}a(window).bind("unload",function(){q.lis.add(q.anchors).unbind(".tabs");q.lis=q.anchors=q.panels=null})}else{f.selected=q.lis.index(q.lis.filter(".nos-ostabs-selected"))}q.anchors.removeData("cache.tabs");q.lis.add(q.anchors).unbind(".tabs");var h=function(r,o){o.addClass("ui-state-"+r)};var k=function(r,o){o.removeClass("ui-state-"+r)};q.lis.bind("mouseover.tabs",function(){h("hover",a(this))});q.lis.bind("mouseout.tabs",function(){k("hover",a(this))});q.anchors.bind("focus.tabs",function(){h("focus",a(this).closest("li"))});q.anchors.bind("blur.tabs",function(){k("focus",a(this).closest("li"))});var c,i;if(f.fx){if(a.isArray(f.fx)){c=f.fx[0];i=f.fx[1]}else{c=i=f.fx}}function g(o,r){o.css("display","");if(!a.support.opacity&&r.opacity){o[0].style.removeAttribute("filter")}}function j(s){var r=s.data("callbacks.ostabs"),o=s.find(".nos-dispatcher");if(a.isPlainObject(r)){a.each(r,function(t,u){q._firePanelEvent(o,u)});r={}}}var m=i?function(o,r){var s=a(o).closest("li").addClass("nos-ostabs-selected ui-state-active");q._tabsWidth();r.hide().removeClass("nos-ostabs-hide").animate(i,i.duration||"normal",function(){if(s.hasClass("nos-ostabs-newtab")){q._tabsWidth()}q.uiOstabsSuperPanel.wijsuperpanel("scrollChildIntoView",s.find("a"));g(r,i);j(r);q._firePanelEvent(r,a.Event("showPanel"))})}:function(o,r){var s=a(o).closest("li");if(s.hasClass("nos-ostabs-newtab")){q._tabsWidth()}q.uiOstabsSuperPanel.wijsuperpanel("scrollChildIntoView",s.find("a"));s.addClass("nos-ostabs-selected ui-state-active");q._tabsWidth();r.removeClass("nos-ostabs-hide");j(r);q._firePanelEvent(r,a.Event("showPanel"))};var n=c?function(r,o){o.animate(c,c.duration||"normal",function(){if(q.uiOstabsNewTab.hasClass("ui-state-active")){q._tabsWidth()}q.lis.removeClass("nos-ostabs-selected ui-state-active");q._tabsWidth();o.addClass("nos-ostabs-hide");g(o,c);q.element.dequeue("tabs");o.trigger("hidePanel.ostabs")})}:function(r,o){if(q.uiOstabsNewTab.hasClass("ui-state-active")){q._tabsWidth()}q.lis.removeClass("nos-ostabs-selected ui-state-active");q._tabsWidth();o.addClass("nos-ostabs-hide");q.element.dequeue("tabs");o.trigger("hidePanel.ostabs")};q.anchors.bind("click.tabs",function(){var t=this,v=a(t).closest("li"),o=q.panels.filter(":not(.nos-ostabs-hide)"),u=q.element.find(q._sanitizeSelector(a(t).data("anchor.tabs"))),s=v.data("ui-ostab");v.addClass("ui-state-open");q.uiOstabsNewTab.removeClass("ui-state-open");f.selected=q.anchors.index(this);if(v.hasClass("nos-ostabs-selected")||v.hasClass("ui-state-processing")||q.panels.filter(":animated").length||q._trigger("select",null,q._ui(v[0],u[0]))===false){this.blur();return false}q._abort();if(u.length){if(o.length){q.element.queue("tabs",function(){n(t,o)})}q.element.queue("tabs",function(){if(!v.hasClass("nos-ostabs-appstab")){s.openRank=q.openRank++}m(t,u)});a("title").html(v.find(".nos-ostabs-label").html());var r=encodeURIComponent(s.url).replace(/%2F/g,"/");if("replaceState" in window.history){window.history.replaceState({},"",document.location.pathname+"?tab="+r)}else{document.location.hash="tab="+r}q._load(q.anchors.index(this))}else{throw"jQuery UI Tabs: Mismatching fragment identifier."}this.blur()}).bind("mousedown.tabs",function(s){if(s.which===2){var r=this,t=a(r).closest("li"),o=t.not(".nos-ostabs-appstab").length;if(o){q.remove(q.lis.index(t),!t.hasClass("nos-ostabs-selected"))}}});q.anchors.bind("click.tabs",function(){return false});q._tabsWidth()},_getIndex:function(d){var c=this;if(typeof d=="string"){c.anchors.each(function(e){if(a(this).data("anchor.tabs")===d){d=e;return false}})}return d},_actions:function(m,f){var l=this,c=l.options,j=l.lis.eq(f),h=l.anchors.eq(f),k=j.not(".nos-ostabs-appstab").length,e=h.data("iframe.tabs"),d=[],g,i;m.find(".nos-ostabs-actions").remove();g=a("<div></div>").addClass("nos-ostabs-actions ui-state-active").prependTo(m);if(!Modernizr.touch&&!k){return}if(k){d.push({classes:"nos-ostabs-close",click:function(){l.remove(l.lis.index(j));return false},label:c.texts.closeTab,iconClass:"ui-icon-closethick",iconUrl:"static/novius-os/admin/novius-os/img/16/close.png"},{classes:"nos-ostabs-close-allothers",click:function(){if(confirm(a.nosCleanupTranslation(c.texts.confirmCloseOtherTabs))){l.lis.not(".nos-ostabs-appstab").not(".nos-ostabs-newtab").each(function(){var n=this;if(n!==j[0]){l.remove(l.lis.index(n))}})}return false},label:c.texts.closeOtherTabs,iconClass:"ui-icon-closethick",iconUrl:"static/novius-os/admin/novius-os/img/16/close.png"})}if(!Modernizr.touch||!k){d.push({classes:"nos-ostabs-close-all",click:function(){if(confirm(a.nosCleanupTranslation(c.texts.confirmCloseTabs))){l.lis.not(".nos-ostabs-appstab").not(".nos-ostabs-newtab").each(function(){l.remove(l.lis.index(this))})}return false},label:c.texts.closeTabs,iconClass:"ui-icon-closethick",iconUrl:"static/novius-os/admin/novius-os/img/16/close.png"})}if(e){d.push({classes:"nos-ostabs-reload",click:function(){var n=m.find("iframe.nos-ostabs-panel-content");if(n!==b){n.attr("src",n.attr("src"))}return false},label:c.texts.reloadTab,iconClass:"ui-icon-refresh",iconUrl:"static/novius-os/admin/novius-os/img/16/refresh.png"})}if(Modernizr.touch){i=a("<div></div>").addClass("nos-ostabs-actions-links").prependTo(g);a.each(d,function(){var o=this,n=a('<a href="#"></a>').addClass(o.classes).click(function(){return o.click()}).appendTo(i);a("<span></span>").addClass("ui-icon "+o.iconClass).html(o.label).appendTo(n);a("<span></span>").html(o.label).appendTo(n)})}else{if(("HTMLMenuItemElement" in window)&&("HTMLCommandElement" in window)){l.element.find("#"+m.attr("id")+"-menucontext").remove();i=a("<menu></menu>").attr({type:"context",id:m.attr("id")+"-menucontext"}).prependTo(l.element);a.each(d,function(){var n=this;a("<menuitem></menuitem>").attr({label:"Novius OS - "+n.label,icon:n.iconUrl}).click(function(){return n.click()}).appendTo(i)});j.attr("contextmenu",m.attr("id")+"-menucontext")}else{j.off("contextmenu.nosostabs").on("contextmenu.nosostabs",function(o){var n;o.preventDefault();o.stopPropagation();l.element.find("ul.nos-ostabs-menuactions").remove();n=a("<ul></ul>").addClass("nos-ostabs-menuactions").prependTo(l.element);a.each(d,function(){var p=this,q=a('<li><a href="#"></a></li>').appendTo(n).find("a").click(function(){n.remove();return p.click()});a("<span></span>").addClass("ui-icon wijmo-wijmenu-icon-left "+p.iconClass).appendTo(q);a("<span></span>").addClass("wijmo-wijmenu-text").html(p.label).appendTo(q)});n.wijmenu({orientation:"vertical"}).closest(".wijmo-wijmenu").position({my:"center top",at:"center bottom",of:j});setTimeout(function(){a(document).on("click.nosostabs",function(p){a(document).off("click.nosostabs");n.remove()})},500)})}}},_tabsWidth:function(){var c=this,g=c.options,e=0;c.uiOstabsTabs.width(10000000);c.uiOstabsTabs.find("li").each(function(){e+=a(this).outerWidth(true)});c.uiOstabsTabs.width(e);var d=c.uiOstabsTabs.find(".nos-ostabs-label:visible").length,f;if(c.tabsWidth<c.uiOstabsTabs.width()){while(c.tabsWidth<c.uiOstabsTabs.width()&&c.labelWidth>g.labelMinWidth){f=c.labelWidth-g.labelMinWidth;f=f>10?10:f;e=e-d*f;c.uiOstabsTabs.width(e);c.labelWidth=c.labelWidth-f;a("head .tabswidth").remove();a('<style type="text/css" class="tabswidth">.nos-ostabs .nos-ostabs-header .nos-ostabs-label {width : '+c.labelWidth+"px !important;}</style>").appendTo("head")}}else{do{f=g.labelMaxWidth-c.labelWidth;f=f>10?10:f;if(c.tabsWidth>(e+d*10)){e=e+d*f;c.uiOstabsTabs.width(e);c.labelWidth=c.labelWidth+f;a("head .tabswidth").remove();a('<style type="text/css" class="tabswidth">.nos-ostabs .nos-ostabs-header .nos-ostabs-label {width : '+c.labelWidth+"px !important;}</style>").appendTo("head")}}while(c.tabsWidth>(e+d*10)&&c.labelWidth<g.labelMaxWidth)}if(c.tabsWidth<c.uiOstabsTabs.width()){c.uiOstabsSuperPanel.find(".wijmo-wijsuperpanel-buttonleft, .wijmo-wijsuperpanel-buttonright").css("visibility","visible")}else{c.uiOstabsSuperPanel.find(".wijmo-wijsuperpanel-buttonleft, .wijmo-wijsuperpanel-buttonright").css("visibility","hidden")}},add:function(e,d){var c=this;if(!a.isPlainObject(e)||e.url===b){return false}if(d===b){d=c.anchors.length-1}var f=c._add(e);if(d<c.lis.length){f.insertBefore(c.lis[d])}else{d=c.lis.eq(f)}c.uiOstabsTabs.sortable("refresh");c._tabify();if(c.anchors.length==1){c.select(0)}c._trigger("add",e,c._ui(f[0]));return d},_add:function(d,f,e){var k=this,c=k.options,i,g,h,j;if(!a.isPlainObject(d)||d.url===b){return false}f=f||k.uiOstabsTabs;d=a.extend({url:"",iframe:false,label:"",labelDisplay:true,iconClasses:"ui-icon ui-icon-document",iconUrl:"",openRank:false,iconSize:16,panelId:false},d);if(d.openRank!==false&&d.openRank>=k.openRank){k.openRank=d.openRank+1}i=a('<a href="'+d.url+'" onclick="return false;"></a>');if(d.iframe){i.data("iframe.tabs",true)}if(d.panelId){i.data("panelid.tabs",d.panelId)}g=k._icon(d).appendTo(i);h=a("<span></span>").addClass("nos-ostabs-label").html(d.label?d.label:"New tab").appendTo(i);if(!d.labelDisplay){h.hide()}j=a("<li></li>").append(i).attr("title",h.text()).addClass("ui-corner-top ui-state-default").data("ui-ostab",d).appendTo(f);if(!Modernizr.touch&&!e){a("<span><span></span></span>").addClass("nos-ostabs-closetab").attr("title",c.texts.closeTab).click(function(m){var l=this,n=a(l).closest("li");m.preventDefault();k.remove(k.lis.index(n),!n.hasClass("nos-ostabs-selected"))}).find("span").addClass("ui-icon ui-icon-closethick").text(c.texts.closeTab).end().appendTo(j)}if(!isNaN(d.iconSize)&&d.iconSize!==16&&f!==k.uiOstabsTabs){j.css({height:(d.iconSize+4)+"px",bottom:(d.iconSize-35)+"px"});g.css("top","2px")}return j},remove:function(e,f){var k=this;f=f||false;e=k._getIndex(e);var h=k.lis.eq(e),d=k.anchors.eq(e),l=k.element.find(k._sanitizeSelector(a(k.anchors[e]).data("anchor.tabs"))),i=0,j=0;if(e==0&&!h.hasClass("nos-ostabs-selected")){var g=k.lis.filter(".nos-ostabs-newtab");if(g.hasClass("nos-ostabs-selected")){h=g}}if(h.not(".nos-ostabs-appstab").not(".nos-ostabs-newtab").length){h.remove();l.remove()}else{var c=h.data("ui-ostab");c.openRank=false;h.data("ui-ostab",c)}h.removeClass("ui-state-active ui-state-open");if(!f){i=e>2?e-1:(k.lis.length>3?1:0);k.lis.each(function(n){var m=a(this),o=m.data("ui-ostab")||{};if(m[0]!=h[0]&&o.openRank&&o.openRank>j){j=o.openRank;i=n}});i=k.anchors.eq(i).data("anchor.tabs")}if(h.not(".nos-ostabs-appstab").not(".nos-ostabs-newtab").length){a("> *",l).not(".nos-ostabs-actions").remove()}l.addClass("nos-ostabs-hide").removeData("callbacks.ostabs");h.removeClass("nos-ostabs-selected");k._tabify();k._trigger("remove",null,k._ui(h[0],l[0]));if(!f){k.select(i)}return k},title:function(d,f){var c=this,e=c.options;d=c._getIndex(d);var g=c.lis.eq(d);if(f===b){return g.find(".nos-ostabs-label").text()}else{g.find(".nos-ostabs-label").html(f);if(e.selected==d){a("title").html(f)}c._trigger("title",null,c._ui(g[0]));return c}},update:function(f,e){var j=this;f=j._getIndex(f);if(!a.isPlainObject(e)){return false}var d=!!e.url&&e.reload,g=j.lis.eq(f);e=a.extend({},g.data("ui-ostab"),e);if(d){delete e.reload;this.remove(f,true);this.add(e,f);this.select(f)}else{if(j.options.selected==f){a("title").html(e.label);var c=encodeURIComponent(e.url).replace(/%2F/g,"/");if("replaceState" in window.history){window.history.replaceState({},"",document.location.pathname+"?tab="+c)}else{document.location.hash="tab="+c}}var i=j._add(e),h=i.find("a"),k=j.panels.eq(f);g.data("ui-ostab",e).attr("title",i.find(".nos-ostabs-label").text()).addClass(i.attr("class")).css({height:i.css("height"),bottom:i.css("bottom")}).find("a").empty().append(h.children());j._actions(k,f);i.remove();j._trigger("update",null,j._ui(g[0],k[0]))}return j},_icon:function(d){var c=a("<span></span>").addClass("nos-ostabs-icon");if(d.iconUrl){c.css("background-image",'url("'+d.iconUrl+'")')}else{c.addClass(d.iconClasses)}if(!isNaN(d.iconSize)&&d.iconSize!==16){c.css({width:d.iconSize+"px",height:d.iconSize+"px",lineHeight:d.iconSize+"px",top:(d.iconSize>22?22-d.iconSize:10-d.iconSize/2)+"px"})}return c},select:function(d){var c=this;d=c._getIndex(d);if(d==-1){return c}c.anchors.eq(d).trigger("click.tabs");return c},_load:function(g){var e=this;g=e._getIndex(g);var j=e.options,d=e.anchors.eq(g)[0],f=a.data(d,"load.tabs"),h=a.data(d,"iframe.tabs");e._abort();if((!f&&h)||e.element.queue("tabs").length!==0&&a.data(d,"cache.tabs")){e.element.dequeue("tabs");return}var c=e.element.find(e._sanitizeSelector(a(d).data("anchor.tabs"))),i=a("> *",c).not(".nos-ostabs-actions").length;if(i!==0){e.element.dequeue("tabs");return}e.lis.eq(g).addClass("ui-state-processing");if(a.isFunction(a.fn.loadspinner)){a("span.nos-ostabs-icon",d).each(function(){var k=a(this);k.addClass("ui-state-processing").loadspinner({diameter:k.width(),scaling:true})})}if(!h){e.xhr=a.ajax({url:f,success:function(m,l,o){var k;a("<div></div>").addClass("nos-ostabs-panel-content nos-dispatcher").data("nos-ostabs-index",g).prependTo(c.data("callbacks.ostabs",{})).html(m);a.data(d,"cache.tabs",true);try{k=a.parseJSON(o.responseText);e.element.nosAjaxSuccess(k)}catch(n){}},complete:function(k){e._cleanup();e._trigger("load",null,e._ui(e.lis[g]))},error:function(l,k){e.remove(g);e.element.nosAjaxError(l,k)}})}else{a("<iframe "+(a.browser.msie?'allowTransparency="true" ':"")+'src="'+f+'" frameborder="0"></iframe>').data("nos-ostabs-index",g).addClass("nos-ostabs-panel-content nos-dispatcher").bind("load",function(){e._cleanup();e._trigger("load",null,e._ui(e.lis[g]))}).prependTo(c.data("callbacks.ostabs",{}));a.data(d,"cache.tabs",true)}e.element.dequeue("tabs");return e},_abort:function(){var c=this;c.element.queue([]);c.panels.stop(false,true);c.element.queue("tabs",c.element.queue("tabs").splice(-2,2));c._cleanup();return c},tabs:function(){var c=this,d=[];c.uiOstabsTabs.find("li:not(.nos-ostabs-newtab)").each(function(){var e=a.extend({},a(this).data("ui-ostab"));delete e.openRank;d.push(e)});return d},dispatchEvent:function(d){var c=this,e=c.options;a.each(c.panels,function(f){var h=a(this);if(f===e.selected){c._firePanelEvent(h,d)}else{var g=h.data("callbacks.ostabs");if(a.isPlainObject(g)){g[d.type+(d.namespace?"."+d.namespace:"")]=d}}});return c},_firePanelEvent:function(c,d){c=c.is(".nos-dispatcher")?c:c.find(".nos-dispatcher");if(c.is("iframe")){if(c[0].contentDocument.$){c[0].contentDocument.$("body").trigger(d)}}else{try{c.trigger(d)}catch(f){log("_firePanelEvent error",f,d)}}},current:function(){var c=this,d=c.options;return{tab:a(c.lis.get(d.selected)),panel:a(c.panels.get(d.selected)),index:d.selected}}});return a});
define("jquery-nos-preview",["jquery","jquery-nos","jquery-ui.widget","wijmo.wijsuperpanel"],function(a){var b=void (0);a.widget("nos.preview",{options:{meta:{},actions:[],data:null,dataParser:null,texts:{headerDefault:"Preview",selectItem:"No item selected"}},data:null,_create:function(){var c=this,d=c.options;c.element.addClass("nos-preview ui-widget ui-widget-content wijmo-wijgrid").parents(".nos-appdesk").bind("selectionChanged.appdesk",function(g,f){if(a.isPlainObject(f)){c.select(f)}else{c.unselect()}})},_init:function(){var c=this,d=c.options;c.data=c.data||d.data;if(a.isPlainObject(c.data)){c.select(c.data)}else{c.unselect()}},_uiHeader:function(g){var c=this,f=c.options;var d=a('<table cellspacing="0" cellpadding="0" border="0"><thead></thead></table>').addClass("nos-preview-header wijmo-wijsuperpanel-header wijmo-wijgrid-root wijmo-wijgrid-table").css({borderCollapse:"separate","-moz-user-select":"-moz-none"}).appendTo(c.element);var e=a("<tr></tr>").addClass("wijmo-wijgrid-headerrow").appendTo(d);a("<th><div><span></span></div></th>").addClass("wijgridth ui-widget wijmo-c1basefield ui-state-default wijmo-c1field").appendTo(e).find("div").addClass("wijmo-wijgrid-innercell").find("span").addClass("wijmo-wijgrid-headertext").html(g);return c},_uiFooter:function(d){var c=this,e=c.options;if(e.actions.length>0){c.uiFooter=a("<div></div>").addClass("nos-preview-footer").appendTo(c.uiContainer);a.each(e.actions,function(){var h=this,g=a.extend(true,{type:h.primary?"button":"link"},h,{disabled:d&&d.actions&&d.actions[h.name]==false}),f=a.nosUIElement(g,d).appendTo(c.uiFooter).css({marginBottom:"5px"}).nosOnShow("show");c.uiFooter.nosFormUI()})}return c},_uiThumbnail:function(d){var c=this,e=c.options,f;if(d.thumbnail){f=d.thumbnail.replace(/64-64/g,"256-256")}else{if(d.thumbnailAlternate){f=d.thumbnailAlternate}}if(f){c._loadImg(d,f)}return c},_loadImg:function(d,f){var c=this;var e=c.options;a("<img />").error(function(){a(this).remove();if(f===d.thumbnail&&d.thumbnailAlternate){c._loadImg(d,d.thumbnailAlternate)}}).load(function(){var h=a(this),g=h.height();var j=a("<div></div>").addClass("nos-preview-thumb").css({background:'url("'+h.attr("src")+'") no-repeat center center',backgroundSize:"contains",height:(g<=100?g:100)+"px"}).prependTo(c.uiContainer);var i=null;a.each(e.actions,function(){if(this.name==e.actionThumbnail){i=this}});if(i!==null){j.attr({title:i.label}).css({cursor:"pointer"}).click(function(k){k.preventDefault();k.stopImmediatePropagation();a(this).nosAction(i.action,c.data)})}h.remove()}).css({position:"absolute",visibility:"hidden"}).attr("src",f).appendTo("body");return c},_uiMetaData:function(f){var c=this,g=c.options,d=0;var e=a('<table cellspacing="0" cellpadding="0" border="0"><tbody></tbody></table>').addClass("nos-preview-metadata wijmo-wijgrid-root wijmo-wijgrid-table").css({borderCollapse:"separate","-moz-user-select":"-moz-none"}).appendTo(c.uiContainer).find("tbody").addClass("ui-widget-content wijmo-wijgrid-data");a.each(g.meta,function(h,j){var i=a("<tr></tr>").addClass("wijmo-wijgrid-row ui-widget-content wijmo-wijgrid-datarow"+(d%2?" wijmo-wijgrid-alternatingrow":"")).appendTo(e);a("<th><div></div></th>").addClass("wijgridtd wijdata-type-string").appendTo(i).find("div").addClass("wijmo-wijgrid-innercell").html(j.label||"");a("<td><div></div></td>").addClass("wijgridtd wijdata-type-string").appendTo(i).find("div").addClass("wijmo-wijgrid-innercell").text(f[h]||"");d++});return c},unselect:function(){var c=this,d=c.options;if(c.element.data("wijmo-wijsuperpanel")){c.element.wijsuperpanel("destroy")}c.element.empty();c._uiHeader(d.texts.headerDefault);c.uiContainer=a("<div></div>").addClass("nos-preview-noitem").html(d.texts.selectItem).appendTo(c.element);c.element.wijsuperpanel({showRounder:false});return c},select:function(d){var c=this,e=c.options;if(d===b){return c.data}else{c.data=d;if(a.isFunction(e.dataParser)){d=e.dataParser(d)}c.element.wijsuperpanel("destroy").empty().css("height","100%");c._uiHeader(d.title||e.texts.headerDefault);c.uiContainer=a("<div></div>").addClass("nos-preview-container").appendTo(c.element);c._uiThumbnail(d)._uiMetaData(d)._uiFooter(d);c.element.wijsuperpanel({showRounder:false,autoRefresh:true})}return c},resize:function(){var c=this;c._init();return c}});return a});
define("jquery-nos-listgrid",["jquery","jquery-nos","jquery-ui.widget","wijmo.wijgrid"],function(a){a.widget("nos.noslistgrid",a.wijmo.wijgrid,{options:{culture:"en-GB",loadingText:"Loading..."},_create:function(){var b=this;a.wijmo.wijgrid.prototype._create.call(b)},_init:function(){var d=this,e=d.options;if(a.isFunction(e.columnResized)){var b=e.columnResized}e.columnResized=function(h,f){var g=d.option("columns");a.extend(g[f.column.thX],{ensurePxWidth:true,width:f.column.width});d.setSize(d.outerDiv.parent().width());if(a.isFunction(b)){b.apply(this,arguments)}};if(a.isFunction(e.dataLoaded)){var c=e.ajaxError}e.ajaxError=function(h,f){var g=f.XMLHttpRequest;if(g.status==403){a(this).nosAjaxError(g)}if(a.isFunction(c)){c.apply(this,arguments)}};a.wijmo.wijgrid.prototype._init.call(d)}});return a});
define("jquery-nos-treegrid",["jquery","jquery-nos","jquery-ui.widget","jquery-nos-listgrid","wijmo.wijgrid","wijmo.wijdatasource"],function(a){var b=void (0);a.widget("nos.nostreegrid",a.nos.noslistgrid,{options:{urlJson:"",treeOptions:null,treeColumnIndex:0,culture:"en-GB",sortable:true,movable:true,data:[],preOpen:null},oldFirstColumn:null,treeData:{},treeDataSource:null,dragged:false,dropTarget:false,dragHelper:false,mousePressed:false,mouseMoved:false,timer:false,_create:function(){var d=this,f=d.options;if(a.isFunction(f.rendered)){var e=f.rendered}f.rendered=function(){if(a.isFunction(e)){e.apply(this,arguments)}d._dragInit()};if(a.isFunction(f.rowStyleFormatter)){var c=f.rowStyleFormatter}f.rowStyleFormatter=function(g){if(a.isFunction(c)){c.apply(this,arguments)}if(d.draggedIndex&&g.state&a.wijmo.wijgrid.renderState.hovered){g.$rows.removeClass("ui-state-hover")}};f.allowPaging=false;a.nos.noslistgrid.prototype._create.call(d)},_init:function(){var c=this,d=c.options;c.oldFirstColumn=a.extend(true,{},d.columns[d.treeColumnIndex]);d.columns[d.treeColumnIndex].cellFormatter=function(e){if(a.isPlainObject(e.row.data)){var g=e.$container.closest("tr"),f=e.row.data;if(e.column.dataKey){a("<span></span>").text(e.row.data[e.column.dataKey]).appendTo(e.$container)}if(a.isFunction(c.oldFirstColumn.cellFormatter)){c.oldFirstColumn.cellFormatter(e)}if(f.treeChilds){a('<div class="nostreegrid-toggle"></div>').css({marginLeft:(f.treeLevel*20)+"px",cursor:"pointer"}).addClass("ui-icon").addClass(a.isPlainObject(f.treeChilds)?"ui-icon-triangle-1-se":"ui-icon-triangle-1-e").click(function(h){h.stopImmediatePropagation();if(a.isPlainObject(f.treeChilds)){c._toggle(g,false)}else{c._toggle(g,true)}}).prependTo(e.$container)}else{a('<div class="nostreegrid-toggle"></div>').css({marginLeft:(f.treeLevel*20)+"px"}).addClass("nos-icon16 nos-icon16-empty").prependTo(e.$container)}g.data("treeNode",f);return true}};if(d.movable){d.columns.unshift({allowSort:false,allowMoving:false,allowSizing:false,width:25,ensurePxWidth:true,cellFormatter:function(e){if(a.isPlainObject(e.row.data)){e.$container.append('<div class="ui-icon ui-icon-grip-dotted-vertical nostreegrid-move-handle"></div>');return true}}})}a.each(d.columns,function(){this.sortDirection="none"});a.nos.noslistgrid.prototype._init.call(c);c._activateSpinner();c._datasource();c.treeDataSource.proxy.options.data.deep=2;if(a.isPlainObject(d.preOpen)){c.treeDataSource.proxy.options.data.preOpen=d.preOpen}c.treeDataSource.load();d.preOpen=null;delete c.treeDataSource.proxy.options.data.preOpen},_setOption:function(d,e){var c=this;a.nos.noslistgrid.prototype._setOption.apply(c,arguments);if(d==="treeOptions"){c._datasource().reload()}},_datasource:function(){var c=this,d=c.options;c.treeDataSource=new wijdatasource({dynamic:true,proxy:new wijhttpproxy({url:d.urlJson,dataType:"json",error:function(e,g,f){log(e,g,f)},data:d.treeOptions||{}}),loaded:function(k,h){var j=c.data(),g=function(e){return a.map(e,function(m,l){if(l==="length"){return null}var n=m;if(a.isPlainObject(m.treeChilds)){n=[m].concat(g(m.treeChilds))}return n})};if(!a.isPlainObject(h)){c.treeData=c._completeChilds(null,k.items);Array.prototype.splice.apply(j,[0,j.length].concat(g(c.treeData)))}else{var f=a.inArray(h.node,j);c._removeNode(h.node);if(h.close){h.node.treeChilds=k.data.total;Array.prototype.splice.apply(j,[f,0,h.node])}else{h.node.treeChilds=c._completeChilds(h.node,k.items);Array.prototype.splice.apply(j,[f,0,h.node].concat(g(h.node.treeChilds)))}}try{c.ensureControl(true)}catch(i){}c._deactivateSpinner()},reader:{read:function(e){e.items=e.data.items}}});return c},_dragInit:function(){var c=this,e=c.options;if(!e.movable){return c}c.element.find("tr.wijmo-wijgrid-row").each(function(){var h=a(this),g=h.data("treeNode"),i=h.find(".nostreegrid-move-handle");if(!c._trigger("movabled",null,{node:g,$tr:h})){return false}i.mousedown(function(k){if(k.which!=1){return true}k.stopImmediatePropagation();c.mousePressed=new Date().getTime();var j=h.clone();c.dragHelper=a('<div class="nostreegrid-drag-helper ui-state-highlight"></div>').hide().css("opacity","0.8").append(j.find("td:eq(1)").find(">div")).appendTo("body");c.helperInsert=a('<div class="nostreegrid-drag-inserthelper ui-state-highlight"></div>');a(document).on("mousemove",{treeGrid:c,node:g,$tr:h},c._dragStart).on("mouseup",{treeGrid:c},c._dragDestroy)});h.mouseup(function(){if(c.mousePressed&&c.mouseMoved&&c.dragged&&c.dropTarget){if(c._trigger("dropped",null,{dragged:c.dragged,dropped:h,notification:true})){c._move(h)}}c._dragDestroy()})});if(c.draggedIndex){var f=c.mousePressed,d=c.element.find("tr.wijmo-wijgrid-row").eq(c.draggedIndex);c._dragDestroy();d.find(".nostreegrid-move-handle").trigger(jQuery.Event("mousedown",{which:1}));c.mousePressed=f;c.dragOpen.event.target=c.element.find("tr.wijmo-wijgrid-row")[c.dragOpen.index];c.dragOpen.event.data.$tr=d;d.trigger(c.dragOpen.event)}return c},_dragStart:function(c){var q=c.data.treeGrid,e=q.options,f=c.data.node,k=c.data.$tr;if(!e.movable){return q}if(q.mousePressed&&(new Date().getTime()-q.mousePressed)>500){if(!q._scroller){q._scroller={superpanel:q._view()._scroller.data("wijsuperpanel")};var p=q._scroller.superpanel.getContentElement(),i=p.parent(),g=i.offset();q._scroller.contentElement=q._scroller.superpanel.getContentElement();q._scroller.contentWrapper=q._scroller.contentElement.parent();a.extend(q._scroller,q._scroller.contentElement.offset(),{bottom:g.top+i.height()})}if(c.pageY<q._scroller.top){q._scroller.superpanel._doScrolling("top",q._scroller.superpanel,true)}else{if(c.pageY<(q._scroller.top+20)){q._scroller.superpanel._doScrolling("top",q._scroller.superpanel)}else{if(c.pageY>q._scroller.bottom){q._scroller.superpanel._doScrolling("bottom",q._scroller.superpanel,true)}else{if(c.pageY>(q._scroller.bottom-20)){q._scroller.superpanel._doScrolling("bottom",q._scroller.superpanel)}}}}if(!q.mouseMoved){var j=a("body");if(j.css("cursor")){q._cursor=j.css("cursor")}j.css("cursor","move");q.mouseMoved=true}if(q.timer){clearTimeout(q.timer)}if(!q.dragHelper.is(":visible")){q.dragHelper.show();q.dragged=k;q.draggedIndex=k.data("wijgriddataItemIndex")}q.dragHelper.css({left:(c.pageX+5),top:(c.pageY+15)});k.css("visibility","hidden");q.dropTarget=false;var d=a(c.target).parents("tr:first");if(a(c.target).closest(q.element).size()&&(a(c.target).is("tr.wijmo-wijgrid-row")||a(c.target).parents("tr.wijmo-wijgrid-row").size())){var l=d.data("treeNode"),h=a.extend({width:d.width(),height:d.height()},d.offset()),m=d.find(".nostreegrid-toggle"),n=a.inArray(f.treeHash,l.treePath)!==-1;if(!n&&e.sortable&&c.pageY<(h.top+5)){q.dropTarget="before";d.removeClass("ui-state-hover");q.helperInsert.css({marginLeft:(parseInt(m.css("margin-left").replace("px",""))+m.width())+"px",marginBottom:""}).insertBefore(m)}else{if(!n&&e.sortable&&c.pageY>(h.top+h.height-5)){q.dropTarget="after";d.removeClass("ui-state-hover");q.helperInsert.css({marginLeft:(parseInt(m.css("margin-left").replace("px",""))+m.width())+"px",marginTop:""}).appendTo(d.find("td:eq(1)").find(">div"))}else{q.helperInsert.detach();if(n||!q._trigger("dropped",null,{dragged:k,dropped:d,notification:false})){d.removeClass("ui-state-hover")}else{q.dropTarget="in";if(a(c.target).hasClass("nostreegrid-toggle")&&a(c.target).hasClass("ui-icon-triangle-1-e")){q.timer=setTimeout(function(){q.dragOpen={event:c,index:d.data("wijgriddataItemIndex")};a(c.target).click()},700)}d.addClass("ui-state-hover")}}}}else{d.removeClass("ui-state-hover");q.dragHelper.hide();q.helperInsert.detach()}}return q},_dragDestroy:function(d){var c=d?d.data.treeGrid:this,e=c.options;if(!e.movable){return c}if(c.timer){clearTimeout(c.timer)}if(c.dragHelper){a(document).off("mousemove",c._dragStart).off("mouseup").off("mousedown");a("body").css("cursor",c._cursor||"auto");c.dragHelper.remove();c.helperInsert.remove();if(c.dragged){c.dragged.css("visibility","visible")}c.dragged=c.mousePressed=c.mouseMoved=c.dragHelper=c.timer=c._scroller=false}return c},_completeChilds:function(e,f){var d=this,c=0,g={};a.each(f,function(i,h){a.extend(h,{treeHash:h._model+"|"+h._id,treeLevel:!e?0:e.treeLevel+1,treePath:!e?[]:e.treePath.concat([e.treeHash])});if(a.isArray(h.treeChilds)||a.isPlainObject(h.treeChilds)){h.treeChilds=d._completeChilds(h,h.treeChilds)}c++;g[h.treeHash]=h});return a.extend({length:c},g)},_getTreeNode:function(e){var c=this,d=null;a.each(e,function(f,g){d=!d?c.treeData[g]:d.treeChilds[g]});return d},_move:function(g){var c=this,f=c.options,e=c.dragged.data("treeNode"),d=g.data("treeNode");a.ajax({async:true,url:f.urlJson,data:{move:true,itemModel:e._model,itemId:e._id,targetModel:d._model,targetId:d._id,targetType:c.dropTarget},dataType:"json",success:function(l,m){if(l.success){c.draggedIndex=false;if(c.dropTarget==="in"){c._removeNode(e);c._toggle(g,true)}else{var i=c._getTreeNode(e.treePath),k=c._getTreeNode(d.treePath),h,j;if(k){h=a.inArray(k,c.data());j=c.element.find("tr.wijmo-wijgrid-row").eq(h)}c._removeNode(e);if(i){delete i.treeChilds[e.treeHash];delete i.treeChilds.length;i.treeChilds=c._completeChilds(i,i.treeChilds)}if(j){c._toggle(j,true)}else{c.reload()}}}if(l.error){a.nosNotify(l.error,"error")}},error:function(h,j,i){log("error",j,i)}});return c},_toggle:function(f,d){var c=this,g=c.options,e=f.data("treeNode");d=d===b?f.hasClass("ui-icon-triangle-1-e"):d;f.find(".nostreegrid-toggle").addClass(d?"ui-icon-clock":"ui-icon-triangle-1-e").removeClass(d?"ui-icon-triangle-1-e":"ui-icon-triangle-1-se");c.treeDataSource.proxy.options.data.deep=d?1:-1;c.treeDataSource.proxy.options.data.id=e._id;c.treeDataSource.proxy.options.data.model=e._model;c.treeDataSource.load({close:d?false:true,node:e});return c},_removeNode:function(e){var c=this,d=false,g=0,f=c.data();a.each(f,function(j,k){var h=e.treeHash===k.treeHash||a.inArray(e.treeHash,k.treePath)!==-1;if(h){if(d===false){d=j}g++}if(!h&&d){return false}});if(d!==false){Array.prototype.splice.apply(f,[d,g])}return g},reload:function(){var c=this;c.treeDataSource.proxy.options.data.deep=2;delete c.treeDataSource.proxy.options.data.id;delete c.treeDataSource.proxy.options.data.model;c.treeDataSource.load();return c}});return a});
define("jquery-nos-thumbnailsgrid",["jquery","jquery-nos","jquery-ui.widget","wijmo.wijsuperpanel","wijmo.wijpager"],function(a){var b=void (0);a.widget("nos.thumbnailsgrid",{options:{thumbnailSize:128,pageIndex:0,pageSize:null,url:"",texts:{loading:"Loading..."},actions:[],loading:null,loaded:null,reader:null,dataParser:null,thumbFormatter:null},_data:null,_create:function(){var c=this;c.uiPager=a("<div></div>").addClass("wijmo-wijsuperpanel-footer  ui-state-default").appendTo(c.element)},destroy:function(){var c=this,d=c.options;c.uiPager.wijpager("destroy");c.uiPager.remove();c.element.removeClass("nos-thumbnailsgrid nos-thumbnailsgrid-size-"+d.thumbnailSize).wijsuperpanel("destroy");a.Widget.prototype.destroy.apply(this,arguments)},_init:function(){var d=this,f=d.options;if(a.inArray(f.thumbnailSize,[64,128])===-1){f.thumbnailSize=128}d.uiPager.wijpager({pageIndexChanging:function(h,g){d._trigger("pageIndexChanging",null,g);f.pageIndex=g.newPageIndex;d._load()},pageIndexChanged:function(h,g){d._trigger("pageIndexChanged");f.pageIndex=g.newPageIndex;d._load()}});d.element.addClass("nos-thumbnailsgrid nos-thumbnailsgrid-size-"+f.thumbnailSize).wijsuperpanel({showRounder:false,autoRefresh:true});d.uiContainer=a(d.element.wijsuperpanel("getContentElement"));d.uiOverlay=a("<div></div>").addClass("nos-thumbnailsgrid-overlay ui-widget-overlay").appendTo(d.element);d.uiOverlayText=a("<span><span></span>"+f.texts.loading+"</span>").addClass("nos-thumbnailsgrid-loadingtext ui-widget-content ui-corner-all").find("span").addClass("ui-icon ui-icon-clock").end().appendTo(d.element);d.uiOverlayText.css({marginLeft:(d.uiOverlayText.width()*-1/2)+"px",marginTop:(d.uiOverlayText.height()*-1/2)+"px"});if(f.pageSize===null){d._displayItem({title:"Test"});var e=d.uiContainer.find(".nos-thumbnailsgrid-thumb"),c=d.uiContainer.parent();d.itemDimension={width:e.outerWidth(true),height:e.outerHeight(true)};d.uiContainer.empty();f.pageSize=Math.floor(c.width()/d.itemDimension.width)*Math.max(1,Math.floor(c.height()/d.itemDimension.height))}d.dataSource=new wijdatasource({dynamic:true,proxy:new wijhttpproxy({url:f.url,dataType:"json",error:function(g,i,h){if(g.status==403){a(this).nosAjaxError(g)}d.uiOverlay.hide();log(g,i,h)},data:{}}),loading:function(h,g){h.proxy.options.data=a.extend(h.proxy.options.data,g.data);d.uiOverlay.add(d.uiOverlayText).show();if(a.isFunction(f.loading)){f.loading(h,g)}},loaded:function(h,g){if(a.isFunction(f.loaded)){f.loaded(h,g)}d.uiPager.wijpager("option",{pageCount:Math.ceil(h.data.totalRows/g.data.paging.pageSize),pageIndex:g.data.paging.pageIndex});d._data=h.data;d._display(h.data);d.uiOverlay.add(d.uiOverlayText).hide()},reader:f.reader});d._load()},_load:function(){var c=this,d=c.options;c.dataSource.load({data:{paging:{pageIndex:d.pageIndex,pageSize:d.pageSize}},afterRefresh:null,beforeRefresh:null});return c},_display:function(d){var c=this,f=c.options,e=c.uiContainer.empty().parent();c.uiContainer.detach();a.each(d,function(g){var h={item:{title:this._title,thumbnail:(this.thumbnail?this.thumbnail:this.thumbnailAlternate).replace(/64/g,f.thumbnailSize),thumbnailAlternate:this.thumbnailAlternate.replace(/64/g,f.thumbnailSize),actions:[]},noParseData:this};c._displayItem(h,g)});c.uiContainer.appendTo(e);c._trigger("rendered");return c},_displayItem:function(h,i){var m=this,f=m.options,l=h.item,c=h.noParseData;l=a.extend({title:"",thumbnail:null,thumbnailAlternate:null},l);var e=a("<div></div>").addClass("nos-thumbnailsgrid-thumb wijmo-wijgrid ui-widget-content").data("thumbnail",{data:h,index:i}).appendTo(m.uiContainer),g=a('<table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td></td></tr></tbody></table>').addClass("nos-thumbnailsgrid-thumb-grid wijmo-wijgrid-root wijmo-wijgrid-table").attr("title",l.title).css({borderCollapse:"separate","-moz-user-select":"-moz-none"}).hover(function(){g.parent().addClass("ui-state-hover")},function(){g.parent().removeClass("ui-state-hover")}).click(function(){m.select(i)}).appendTo(e).find("tbody").addClass("ui-widget-content wijmo-wijgrid-data").find("tr").addClass("wijmo-wijgrid-row ui-widget-content wijmo-wijgrid-datarow").find("td").addClass("wijgridtd"),d=a("<div></div>").addClass("nos-thumbnailsgrid-thumb-container-img wijmo-wijgrid-innercell").appendTo(g),k=a("<div></div>").addClass("nos-thumbnailsgrid-thumb-title wijmo-wijgrid-innercell").text(l.title).appendTo(g);m._itemThumbnail(d,l,i);var j=a.appdeskActions(f.actions,c);j.appendTo(e);if(a.isFunction(f.thumbFormatter)){f.thumbFormatter({"$container":e,item:{data:l,index:i}})}return m},_itemThumbnail:function(c,f,e){var d=this,h=d.options,i=f.thumbnail||f.thumbnailAlternate,g=f.colour;if(g){d._loadColour(c,g)}else{if(i){d._loadImg(c,f,i)}else{d._loadImgDefault(c)}}return d},_loadImg:function(c,e,g){var d=this,f=d.options;a("<img />").error(function(){if(g===e.thumbnail&&e.thumbnailAlternate){d._loadImg(c,e,e.thumbnailAlternate)}else{d._loadImgDefault(c)}}).load(function(){var h=a(this);h.prependTo(c).css({marginTop:"-"+(h.height()/2)+"px",marginLeft:"-"+(h.width()/2)+"px"})}).addClass("nos-thumbnailsgrid-thumb-img").attr("src",g);return d},_loadImgDefault:function(c){var d=this,e=d.options;a("<div></div>").addClass("nos-thumbnailsgrid-thumb-img-default").prependTo(c);return d},_loadColour:function(c,e){var d=this;a(c).css("backgroundColor",e);return d},select:function(d){var c=this,g=c.options;if(d===b){var f=c.uiContainer.find(".nos-thumbnailsgrid-thumb:has(wijmo-wijgrid-current-cell)");if(f.length){var e=f.data("thumbnail");return e.index}return null}else{c.uiContainer.find("td").removeClass("wijmo-wijgrid-current-cell ui-state-highlight");var f=c.uiContainer.find(".nos-thumbnailsgrid-thumb").eq(d);if(f.length){var e=f.data("thumbnail");f.find(".wijgridtd").eq(0).addClass("wijmo-wijgrid-current-cell ui-state-highlight");c._trigger("selectionChanged",null,{item:e})}else{c._trigger("selectionChanged");return false}}return c},unselect:function(){this._trigger("selectionChanged")},setSize:function(e,c){var d=this;if(e!==null){d.element.width(e)}if(c!==null){d.element.height(c)}return d},data:function(){return this._data}});return a});
define("jquery-nos-appdesk",["jquery","jquery-nos","jquery-ui.widget","jquery-nos-thumbnailsgrid","jquery-nos-listgrid","jquery-nos-treegrid","jquery-nos-preview","jquery-ui.button","wijmo.wijdropdown","wijmo.wijtabs","wijmo.wijsuperpanel","wijmo.wijsplitter","wijmo.wijgrid","wijmo.wijmenu"],function(a){var b=void (0);a.widget("nos.appdesk",{options:{buttons:[],inspectors:[],thumbnails:false,defaultView:"grid",locales:{},sites:{},culture:"en-GB",contexts:{},hideContexts:false,texts:{allSites:"All sites",allLanguages:"All languages",allContexts:"All contexts",settings:"Settings",item:"item",items:"items",showNbItems:"Showing {{x}} items out of {{y}}",showOneItem:"Showing 1 item",showNoItem:"No items",showAll:"Show all items",viewGrid:"List",viewTreeGrid:"Tree",viewThumbnails:"Thumbnails",selectSites:"Select the site(s) to show",selectLanguages:"Select the language(s) to show",selectContexts:"Select the context(s) to show",workInContext:"Show {{context}}",otherSites:"Other sites",otherLanguages:"Other languages",otherContexts:"Other contexts",contextsPopinOk:"OK",loading:"Loading...",search:"Search"},values:{},slidersChange:null,splitters:{vertical:null,horizontal:null},views:{},selectedView:null,selectedContexts:[],fromView:null,name:null,grid:{}},pageIndex:0,showFilter:false,gridRendered:false,nosContext:false,resizing:true,init:false,itemSelected:null,variantColumnsProperties:{visible:true,width:true,showFilter:true},variantInspectorsProperties:{hide:true,vertical:true},_create:function(){var c=this,d=c.options;c.element.addClass("nos-appdesk");c.dispatcher=c.element.closest(".nos-dispatcher");if(!c.dispatcher.size()){c.dispatcher=c.element}c.element.nosToolbar("create");c.uiSplitterVertical=a("<div></div>").addClass("nos-appdesk-splitter-v").appendTo(c.element);c.uiSplitterVerticalRight=a("<div></div>").appendTo(c.uiSplitterVertical);c.uiInspectorsVertical=a("<ul></ul>").addClass("nos-appdesk-inspectors nos-appdesk-inspectors-v").appendTo(c.uiSplitterVerticalRight);c.uiSplitterVerticalLeft=a("<div></div>").appendTo(c.uiSplitterVertical);c.uiSplitterHorizontal=a("<div></div>").appendTo(c.uiSplitterVerticalLeft);c.uiSplitterHorizontalTop=a("<div></div>").appendTo(c.uiSplitterHorizontal);c.uiInspectorsHorizontal=a("<ul></ul>").addClass("nos-appdesk-inspectors nos-appdesk-inspectors-h").appendTo(c.uiSplitterHorizontalTop);c.uiSplitterHorizontalBottom=a("<div></div>").appendTo(c.uiSplitterHorizontal);c.uiSearchBar=a("<div><form><div></div></form></div>").addClass("nos-appdesk-searchbar-container wijmo-wijgrid ui-widget ui-widget-header ui-state-default").appendTo(c.uiSplitterHorizontalBottom).find("form").addClass("wijmo-wijgrid-headerrow wijmo-wijgrid-innercell").find("div").addClass("nos-appdesk-searchbar wijmo-wijgrid-headertext");c.uiNbResult=a("<div></div>").addClass("nos-appdesk-nbresult").appendTo(c.uiSearchBar);c.uiInputContainer=a("<div></div>").addClass("nos-appdesk-input-container ui-widget-content ui-corner-all").appendTo(c.uiSearchBar);c.uiViewsButtons=a("<div></div>").addClass("nos-appdesk-views-button").appendTo(c.uiSearchBar);c.uiSearchIcon=a("<div></div>").addClass("nos-appdesk-search-icon ui-icon ui-icon-search").appendTo(c.uiInputContainer);c.uiSearchInput=a('<input type="search" name="search" placeholder="'+d.texts.search+'" value="" />').addClass("nos-appdesk-search-input ui-helper-reset").appendTo(c.uiInputContainer);c.uiInspectorsTags=a("<div></div>").addClass("nos-appdesk-inspectorstags").appendTo(c.uiInputContainer);c.uiResetSearch=a('<a href="#"></a>').html(d.texts.showAll).attr("title",d.texts.showAll).addClass("nos-appdesk-reset-search").appendTo(c.uiInputContainer);c.uiuiResetSearchIcon=a("<span></span>").html(d.texts.showAll).addClass("ui-icon").appendTo(c.uiResetSearch);c.uiGridTitle=a("<div></div>").addClass("nos-appdesk-title").appendTo(c.uiSearchBar);c.uiPaginationLabel=a("<span></span>").addClass("nos-appdesk-pagination");c.uiGrid=a("<table></table>").appendTo(c.uiSplitterHorizontalBottom);c.uiTreeGrid=a("<table></table>").appendTo(c.uiSplitterHorizontalBottom);c.uiThumbnail=a("<div></div>").appendTo(c.uiSplitterHorizontalBottom)},_init:function(){var c=this,d=c.options;if(!a.isPlainObject(d.thumbnails)){d.thumbnails=false}else{d.thumbnails=a.extend({thumbnailSize:128},d.thumbnails)}if(!d.texts.gridTitle){d.texts.gridTitle=d.texts.items}c.nosContext=a.nosContext({locales:d.locales,sites:d.sites,contexts:d.contexts});if(!a.isEmptyObject(d.contexts)){if(!a.isArray(d.selectedContexts)){d.selectedContexts=a.type(d.selectedContexts)==="string"?[d.selectedContexts]:[]}a.each(d.selectedContexts,function(f,e){if(!d.contexts[e]){delete d.selectedContexts[e]}});if(d.selectedContexts.length===0){d.selectedContexts.push(Object.keys(d.contexts)[0])}}c._css()._uiToolbar()._uiSplitters()._uiInspectors()._uiSearchBar()._uiList();c.init=true},_css:function(){var k=this,d=k.options;if(!a("style#inspectorsGrid").length){var f="";for(var i=0,e=document.styleSheets.length;i<e;i++){var g=document.styleSheets[i];if(g.href&&/wijmo/.test(g.href)){var h=g.rules?g.rules:g.cssRules;for(var c=0,j=h.length;c<j;c++){if(h[c].selectorText===".ui-widget-content"){f+=".nos-appdesk .nos-appdesk-splitter-v .wijmo-wijsplitter-v-panel2 .wijmo-wijsplitter-h-panel1 .wijmo-wijgrid-alternatingrow {background:"+h[c].style.background+";}";f+=".nos-appdesk .nos-appdesk-splitter-v .wijmo-wijsplitter-v-panel1 .wijmo-wijgrid-alternatingrow {background:"+h[c].style.background+";}"}if(h[c].selectorText===".wijmo-wijgrid tr.wijmo-wijgrid-row.ui-state-hover, .wijmo-wijgrid .wijmo-wijgrid-current-cell, .wijmo-wijgrid td.wijmo-wijgrid-rowheader.ui-state-active"||h[c].selectorText===".wijmo-wijgrid tr.ui-state-hover.wijmo-wijgrid-row, .wijmo-wijgrid .wijmo-wijgrid-current-cell, .wijmo-wijgrid td.ui-state-active.wijmo-wijgrid-rowheader"){f+=".nos-appdesk .nos-appdesk-splitter-v .wijmo-wijsplitter-v-panel2 .wijmo-wijsplitter-h-panel1 .wijmo-wijgrid-alternatingrow.ui-state-hover {background:"+h[c].style.background+";}";f+=".nos-appdesk .nos-appdesk-splitter-v .wijmo-wijsplitter-v-panel1 .wijmo-wijgrid-alternatingrow.ui-state-hover {background:"+h[c].style.background+";}"}}}}a('<style type="text/css" id="inspectorsGrid">'+f+"</style>").appendTo("head")}return k},_uiToolbar:function(){var c=this;return c._uiToolbarActions()._uiToolbarContexts()._uiToolbarViews()},_uiToolbarActions:function(){var c=this,d=c.options;if(!a.isArray(d.buttons)||!d.buttons.length){return c}a.each(d.buttons,function(g,f){var e;if(f.primary){e=a("<button></button>").html(f.label).data("icon",f.icon||"plus").addClass("primary").click(function(h){h.preventDefault();h.stopImmediatePropagation();a(this).nosAction(f.action,{context:d.selectedContexts.length?d.selectedContexts[0]:""})})}else{e=a('<a href="#"></a>').addClass("nos-appdesk-action-secondary").html(f.label).click(function(h){h.preventDefault();h.stopImmediatePropagation();a(this).nosAction(f.action,{context:d.selectedContexts.length?d.selectedContexts[0]:""})})}c.element.nosToolbar("add",e)});return c},_uiToolbarContexts:function(){var d=this,g=d.options;if(g.hideContexts||!!a.isEmptyObject(g.contexts)){return d}d.dispatcher.data("nosContext",g.selectedContexts);d._uiToolbarContextsButton();d.uiToolbarContextsDialog=a("<div><form><table><thead><tr><th></th></tr></thead><tbody></tbody></table></form></div>");var e=d.uiToolbarContextsDialog.find("table"),c=e.find("tbody"),f=e.find("tr");a.each(g.locales,function(h,i){a("<th></th>").html(i.title).append('<br /><img src="static/novius-os/admin/novius-os/img/flags/'+i.flag+'.png" />').appendTo(f)});a.each(g.sites,function(i,h){var j=a("<tr></tr>").appendTo(c);a("<th></th>").html(h.title).appendTo(j);a.each(g.locales,function(k,l){if(g.contexts[i+"::"+k]){a("<td></td>").append('<input type="checkbox" name="contexts" value="'+i+"::"+k+'" />').appendTo(j)}else{a("<td></td>").appendTo(j)}})});d.uiToolbarContextsDialog.wijdialog({title:d.nosContext.label({oneSite:g.texts.selectLanguages,oneLocale:g.texts.selectSites,defaultLabel:g.texts.selectContexts}),autoOpen:false,buttons:[{text:g.texts.contextsPopinOk,click:function(){g.selectedContexts=[];d.uiToolbarContextsDialog.find(":checked").each(function(){g.selectedContexts.push(a(this).val())});d._selectContexts()}}],captionButtons:{pin:{visible:false},refresh:{visible:false},toggle:{visible:false},minimize:{visible:false},maximize:{visible:false}},modal:true,open:function(){d.uiToolbarContextsDialog.nosOnShow("show");d.uiToolbarContextsDialog.find(":checkbox").attr("checked",false);a.each(g.selectedContexts,function(j,h){d.uiToolbarContextsDialog.find(':checkbox[value="'+h+'"]').attr("checked",true)});d.uiToolbarContextsDialog.find(":checkbox").wijcheckbox("refresh");d.uiToolbarContextsDialog.wijdialog("option","width",parseInt(d.uiToolbarContextsDialog.css("padding-left").replace("px"))*2+e.outerWidth())}}).nosOnShow("one",function(){e.wijgrid({columns:[{cellFormatter:function(h){h.$container.text(h.formattedValue).parent().addClass("wijmo-wijgrid-rowheader ui-widget-content ui-state-default").removeClass("wijdata-type-string");return true}}],cellStyleFormatter:function(h){if(h.state&a.wijmo.wijgrid.renderState.selected){h.$cell.removeClass("ui-state-highlight")}if(h._cellIndex>0){h.$cell.css("text-align","center");if(h.row.dataRowIndex===-1){var j=e.wijgrid("data");h.$cell.click(function(n){n.preventDefault();n.stopImmediatePropagation();var m=null;for(var k=1;k<=j.length;k++){var l=e.find("tr:eq("+k+")").find("td:eq("+h._cellIndex+")").find(":checkbox");if(m===null){m=l.is(":checked")}l.attr("checked",!m).wijcheckbox("refresh")}})}}else{var i=h.$cell.parent();h.$cell.click(function(l){l.preventDefault();l.stopImmediatePropagation();var k=i.find(":checkbox");k.attr("checked",!k.is(":checked")).wijcheckbox("refresh")})}}});d.uiToolbarContextsDialog.nosFormUI()});return d},_selectContexts:function(){var c=this,d=c.options;c.uiToolbarContextsDialog.wijdialog("close");c._uiToolbarContextsButtonLabel();c.element.nosSaveUserConfig(d.name+".selectedContexts",d.selectedContexts);c.uiSearchInput.val("");if(c.uiInspectorsTags.data("wijmo-wijsuperpanel")){c.uiInspectorsTags.wijsuperpanel("destroy")}c.uiInspectorsTags.empty();c._uiList();c.dispatcher.data("nosContext",d.selectedContexts).trigger("contextChange");return c},_uiToolbarContextsButton:function(){var d=this,h=d.options;var c=a("<div><button></button><button></button></div>").addClass("nos-appdesk-buttoncontext"),f=new Date(),i=f.getDate()+"_"+f.getHours()+"_"+f.getMinutes()+"_"+f.getSeconds()+"_"+f.getMilliseconds(),e=a("<ul></ul>"),g=0;c.find("button:first").click(function(j){j.preventDefault();j.stopImmediatePropagation();d.uiToolbarContextsDialog.wijdialog("open")}).end().find("button:last").attr("id",i).html(d.nosContext.label({oneSite:h.texts.selectLanguages,oneLocale:h.texts.selectSites,defaultLabel:h.texts.selectContexts})).data({text:false,icons:{primary:"triangle-1-s"}});d.uiToolbarContextsButton=d.element.nosToolbar("add",c,true);d.uiToolbarContextsButton.buttonset();d._uiToolbarContextsButtonLabel();a("<li><a></a></li>").appendTo(e).find("a").html(d.nosContext.label({oneSite:h.texts.selectLanguages,oneLocale:h.texts.selectSites,defaultLabel:h.texts.selectContexts}));a("<li></li>").appendTo(e);a.each(h.contexts,function(j){g++;a("<li><a></a></li>").data("context",j).appendTo(e).find("a").append(h.texts.workInContext.replace("{{context}}",d.nosContext.contextLabel(j)));if(g>10&&Object.key(h.contexts).length>12){a("<li><a></a></li>").appendTo(e).find("a").html(d.nosContext.label({oneSite:h.texts.otherLanguages,oneLocale:h.texts.otherSites,defaultLabel:h.texts.otherContexts}));return false}});e.insertAfter(d.uiToolbarContextsButton).wijmenu({orientation:"vertical",animation:{animated:"slide",option:{direction:"up"},duration:50,easing:null},hideAnimation:{animated:"slide",option:{direction:"up"},duration:0,easing:null},direction:"rtl",trigger:"#"+i,select:function(l,k){var m=a(k.item.element),j=m.data("context");if(j){h.selectedContexts=[j];d._selectContexts()}else{d.uiToolbarContextsDialog.wijdialog("open")}}});return d},_uiToolbarContextsButtonLabel:function(){var e="",i=0,f=0,h={},c={},d=this,j=d.options,g=d.uiToolbarContextsButton.find("button:first");if(j.selectedContexts.length===1){g.button("option","label",d.nosContext.contextLabel(j.selectedContexts[0]))}else{a.each(j.selectedContexts,function(n,m){var l=d.nosContext.siteCode(m),k=d.nosContext.localeCode(m);if(!h[l]){i++;h[l]=[]}h[l].push(k);if(!c[k]){f++;c[k]=[]}c[k].push(l)});if(Object.keys(j.contexts).length===j.selectedContexts.length){g.button("option","label",d.nosContext.label({oneSite:j.texts.allLanguages,oneLocale:j.texts.allSites,defaultLabel:j.texts.allContexts}))}else{if(i===1&&j.sites[Object.keys(h)[0]].locales.length===f){g.button("option","label",d.nosContext.siteLabel(Object.keys(h)[0])+", "+j.texts.allLanguages)}else{if(f===1&&j.locales[Object.keys(c)[0]].sites.length===i){g.button("option","label",j.texts.allSites+", "+d.nosContext.localeLabel(Object.keys(c)[0]))}else{a.each(h,function(l,k){if(e!==""){e+="&nbsp;&nbsp;"}if(Object.keys(j.sites).length>1){e+=d.nosContext.siteLabel(l,{"short":true})+" "}if(Object.keys(j.locales).length>1){a.each(k,function(n,m){e+=d.nosContext.localeLabel(m,{"short":true})+" "})}});g.button("option","label",e)}}}}return d},_uiToolbarViews:function(){var d=this,f=d.options;if(f.views[f.selectedView]&&f.views[f.selectedView].virtual){return d}var c=a("<select></select>"),e=0;a.each(f.views,function(h,g){if(g.virtual){return}e++;c.append(a("<option></option>").attr({value:h,selected:(f.selectedView==h)}).append(g.name))});if(e<=1){return d}c.change(function(){var g=a(this);g.nosSaveUserConfig(f.name+".selectedView",a(this).val());d.element.trigger("reloadView",{selectedView:a(this).val()})});d.element.nosToolbar("add",c,true);return d},_uiSplitters:function(){var e=this,g=function(){e.uiSplitterHorizontal.wijsplitter("refresh");e._resizeInspectorsV(true)._resizeInspectorsH(true)._resizeList(true)},c=function(){e._resizeInspectorsH(true)._resizeList(true)},f=a.extend(true,{orientation:"vertical",splitterDistance:200,showExpander:false,fullSplit:false,panel1:{minSize:150,scrollBars:"none"},panel2:{minSize:200,scrollBars:"none"},expanded:function(){g()},collapsed:function(){g()},sized:function(){e.resizing=true;g()}},e.options.splitters.vertical),d=a.extend(true,{orientation:"horizontal",fullSplit:true,splitterDistance:200,showExpander:false,panel1:{minSize:200,scrollBars:"none"},panel2:{minSize:200,scrollBars:"none"},expanded:function(){c()},collapsed:function(){c()},sized:function(){e.resizing=true;c()}},e.options.splitters.horizontal);e.uiSplitterVertical.wijsplitter(f).find(".ui-resizable-handle").mousedown(function(){e.resizing=false});e.uiSplitterHorizontal.wijsplitter(d).find(".ui-resizable-handle").mousedown(function(){e.resizing=false});return e},_uiInspectors:function(){var c=this,d=c.options;a.each(d.inspectors,function(){if(!this.hide){a("<li></li>").addClass("nos-appdesk-inspector ui-widget-content").data("inspector",this).appendTo(this.vertical?c.uiInspectorsVertical:c.uiInspectorsHorizontal)}});c._resizeInspectorsV(true)._resizeInspectorsH(true);c.uiInspectorsVertical.find("> li").add(c.uiInspectorsHorizontal.find("> li")).each(function(){c._loadInspector(a(this))});return c},_loadInspector:function(f){var c=this,e=f.data("inspector"),d=c.options;e.selectionChanged=function(k,i){var g=false,h=e.inputName;if(e.inputName.substr(-2,2)==="[]"){h=e.inputName.substr(0,e.inputName.length-2);g=true}if(!g){c.uiInspectorsTags.find("span."+h).remove()}else{var l=false;c.uiInspectorsTags.find("span."+h).each(function(){if(a(this).find("input").val()===k){l=true;return false}});if(l){return true}}c.pageIndex=0;if(c.uiInspectorsTags.data("wijmo-wijsuperpanel")){c.uiInspectorsTags.wijsuperpanel("destroy")}var j=a("<span></span>").addClass("nos-appdesk-inspectorstag ui-state-default ui-corner-all "+h).html(i).appendTo(c.uiInspectorsTags);a('<input type="hidden" name="'+e.inputName+'" />').val(k).appendTo(j);a('<a href="#"></a>').addClass("ui-icon ui-icon-close").click(function(m){m.preventDefault();a(this).parent().remove();c.gridReload()}).appendTo(j);c.uiInspectorsTags.wijsuperpanel({showRounder:false,hScroller:{scrollMode:"buttons"}});if(d.defaultView==="treeGrid"){c.uiViewsButtons.find(".view_grid").click().blur()}else{c.gridReload()}};f.data("inspector",e);if(a.isFunction(e.url)){e.url.call(c,f)}else{a.ajax({url:e.url,dataType:"html"}).done(function(g){a(g).appendTo(f)}).fail(function(g,i,h){log("error");log(i);log(h)})}return c},_uiSearchBar:function(){var d=this,f=d.options;d.uiResetSearch.hide();d.uiSearchInput.on("keypress",function(h){var i=a.ui.keyCode;d.pageIndex=0;if(d.timeoutSearchInput){clearTimeout(d.timeoutSearchInput)}if(h.keyCode===i.ENTER){if(f.defaultView==="treeGrid"){d.uiViewsButtons.find(".view_grid").click().blur()}else{d.gridReload()}return false}d.timeoutSearchInput=setTimeout(function(){if(f.defaultView==="treeGrid"){d.uiViewsButtons.find(".view_grid").click().blur()}else{d.gridReload()}},500)});d.uiResetSearch.click(function(h){h.preventDefault();d.uiSearchInput.val("");if(d.uiInspectorsTags.data("wijmo-wijsuperpanel")){d.uiInspectorsTags.wijsuperpanel("destroy")}d.uiInspectorsTags.empty();d.gridReload()});d.uiInspectorsTags.height(d.uiInputContainer.height()).width(parseInt(d.uiSearchBar.width()*0.3)).wijsuperpanel({showRounder:false,hScroller:{scrollMode:"buttons"}});var c=[{id:"treeGrid",text:f.texts.viewTreeGrid,icon:"view-tree"},{id:"grid",text:f.texts.viewGrid,icon:"view-list"},{id:"thumbnails",size:64,text:f.texts.viewThumbnails,icon:"view-thumbs-small"},{id:"thumbnails",size:128,text:f.texts.viewThumbnails,icon:"view-thumbs-big"}],e=new Date(),g=e.getDate()+"_"+e.getHours()+"_"+e.getMinutes()+"_"+e.getSeconds()+"_"+e.getMilliseconds();a.each(c,function(){var h=this;if(f[h.id]){a('<label for="view_'+g+h.id.toLowerCase()+(h.size?"_"+h.size:"")+'"></label>').html(h.text+(h.size?" "+h.size+"px":"")).appendTo(d.uiViewsButtons);a('<input type="radio" class="view_'+h.id.toLowerCase()+(h.size?"_"+h.size:"")+'" id="view_'+g+h.id.toLowerCase()+(h.size?"_"+h.size:"")+'" name="view" '+(f.defaultView===h.id&&(!h.size||h.size===f.thumbnails.thumbnailSize)?'checked="checked"':"")+'" />').appendTo(d.uiViewsButtons).button({text:false,label:h.text+(h.size?" "+h.size+"px":""),icons:{primary:"ui-icon "+h.icon,secondary:null}}).click(function(){if(f.defaultView!==h.id||(h.id==="thumbnails"&&f.thumbnails.thumbnailSize!==h.size)){d.uiViewsButtons.find("button").removeClass("ui-state-active");a(this).addClass("ui-state-active");f.defaultView=h.id;if(h.size){f.thumbnails.thumbnailSize=h.size}if(h.id==="treeGrid"){d.uiSearchInput.val("")}d._uiList()}})}});if(d.uiViewsButtons.find("input").length>1){d.uiViewsButtons.buttonset()}else{d.uiViewsButtons.hide()}return d},_uiList:function(){var c=this,d=c.options;c.gridRendered=false;c.uiGridTitle.html(d.texts.gridTitle);if(c.uiThumbnail.data("nos-thumbnailsgrid")){c.uiThumbnail.thumbnailsgrid("destroy")}if(c.uiThumbnail.data("nos-noslistgrid")){c.uiGrid.noslistgrid("destroy")}if(c.uiTreeGrid.data("nos-nostreegrid")){c.uiTreeGrid.nostreegrid("destroy")}c.uiThumbnail.add(c.uiGrid).add(c.uiTreeGrid).empty().hide();if(d.defaultView==="thumbnails"){c.uiThumbnail.show();c._uiThumbnail()}else{if(d.defaultView==="treeGrid"){c.uiTreeGrid.show();c._uiTreeGrid()}else{c.uiGrid.show();c._uiGrid()}}return c},_uiGrid:function(){var e=this,i=e.options,d=e.uiGrid.offset(),g=e.element.offset(),c=e.element.height()-d.top+g.top,h=a.grid.getHeights(),f=a.extend(true,{},i.grid);e._columnsMultiContext(f.columns);e.uiGrid.css({height:c,width:"100%"}).noslistgrid(a.extend({loadingText:i.texts.loading,columnsAutogenerationMode:"none",selectionMode:"singleRow",showFilter:e.showFilter,allowSorting:true,scrollMode:"auto",allowPaging:true,culture:i.culture,pageIndex:e.pageIndex,pageSize:Math.floor((c-h.footer-h.header-(e.showFilter?h.filter:0))/h.row),allowColSizing:true,allowColMoving:true,data:new wijdatasource({dynamic:true,proxy:new wijhttpproxy({url:i.grid.urlJson,dataType:"json",error:function(j,l,k){log(j,l,k)},data:{}}),loading:function(l,j){var k=j.data.paging;e.pageIndex=k.pageIndex;if(e.gridRendered){e.uiGrid.noslistgrid("currentCell",-1,-1)}l.proxy.options.data.context=i.selectedContexts||"";l.proxy.options.data.inspectors=e._jsonInspectors();l.proxy.options.data.offset=k.pageIndex*k.pageSize;l.proxy.options.data.limit=k.pageSize},loaded:function(k,j){if(k.data.totalRows===0){e.uiPaginationLabel.html(i.texts.showNoItem);e.uiNbResult.html(i.texts.showNoItem)}else{if(k.data.totalRows===1){e.uiPaginationLabel.html(i.texts.showOneItem);e.uiNbResult.html("1 "+i.texts.item)}else{e.uiPaginationLabel.html(i.texts.showNbItems.replace("{{x}}",k.data.length).replace("{{y}}",k.data.totalRows));e.uiNbResult.html(k.data.totalRows+" "+i.texts.items)}}e.uiNbResult.show();e.uiResetSearch[e.uiInspectorsTags.find(".nos-appdesk-inspectorstag").length||e.uiSearchInput.val()?"show":"hide"]()},reader:{read:function(k){var j=parseInt(k.data.total,10);k.data=k.data.items;k.data.totalRows=j}}}),pageIndexChanging:function(){e.element.trigger("selectionChanged.appdesk",false)},cellStyleFormatter:function(j){if(j.$cell.is("th")){j.$cell.removeClass("ui-state-active")}if(j.state&a.wijmo.wijgrid.renderState.selected&&j.$cell.hasClass("ui-state-default")){j.$cell.removeClass("ui-state-highlight")}if(j.state&a.wijmo.wijgrid.renderState.selected){j.$cell.removeClass("wijmo-wijgrid-current-cell")}},currentCellChanging:function(){return e.gridRendered},currentCellChanged:function(k){if(k){var l=a(k.target).noslistgrid("currentCell").row(),j=l?l.data:false;if(j){e.itemSelected=a.extend({},j);e.element.trigger("selectionChanged.appdesk",j)}}return true},rendering:function(){e.gridRendered=false},rendered:function(){e.gridRendered=true;e.uiGrid.css("height","auto");var j=e.uiGrid.noslistgrid("selection");j&&j.clear();if(e.itemSelected!==null){a.each(e.uiGrid.noslistgrid("data")||[],function(k,l){if(l._model==e.itemSelected._model&&l._id==e.itemSelected._id){j.addRows(k);e.element.trigger("selectionChanged.appdesk",l)}})}},dataLoading:function(j){e.uiPaginationLabel.detach()},loaded:function(){e.uiSplitterHorizontalBottom.find(".wijmo-wijgrid-footer").prepend(e.uiPaginationLabel)}},f));return e},_uiTreeGrid:function(){var e=this,i=e.options,d=e.uiTreeGrid.offset(),h=e.element.offset(),c=e.element.height()-d.top+h.top,g=a.extend(true,{},i.grid),f=a.extend({},i.treeGrid.columns||i.grid.columns);delete g.columns;delete g.urlJson;e._columnsMultiContext(f);e.uiTreeGrid.css({height:c,width:"100%"}).nostreegrid(a.extend(true,{loadingText:i.texts.loading,urlJson:i.treeGrid.urlJson,treeOptions:{context:i.selectedContexts||""},columnsAutogenerationMode:"none",selectionMode:"singleRow",allowSorting:true,scrollMode:"auto",culture:i.culture,allowColSizing:true,allowColMoving:true,columns:i.treeGrid.columns||i.grid.columns,sorting:function(k,j){a.each(i.grid.columns,function(){var l=this;if(l.headerText===j.column.headerText){l.sortDirection=j.sortDirection}else{l.sortDirection="none"}});e.uiViewsButtons.find(".view_grid").click().blur();return false},cellStyleFormatter:function(j){if(j.$cell.is("th")){j.$cell.removeClass("ui-state-active")}if(j.state&a.wijmo.wijgrid.renderState.selected&&j.$cell.hasClass("ui-state-default")){j.$cell.removeClass("ui-state-highlight")}if(j.state&a.wijmo.wijgrid.renderState.selected){j.$cell.removeClass("wijmo-wijgrid-current-cell")}},currentCellChanging:function(){return e.gridRendered},currentCellChanged:function(k){if(k){var l=a(k.target).nostreegrid("currentCell").row(),j=l?l.data:false;if(j){e.itemSelected=a.extend({},j);e.element.trigger("selectionChanged.appdesk",j)}}return true},rendering:function(){e.gridRendered=false},rendered:function(){e.gridRendered=true;e.uiTreeGrid.css("height","auto");var j=e.uiTreeGrid.nostreegrid("selection");j&&j.clear();if(e.itemSelected!==null){a.each(e.uiTreeGrid.nostreegrid("data")||[],function(k,l){if(l._model==e.itemSelected._model&&l._id==e.itemSelected._id){j.addRows(k);e.element.trigger("selectionChanged.appdesk",l)}})}},dataLoading:function(j){e.uiPaginationLabel.detach()},loaded:function(){e.uiSplitterHorizontalBottom.find(".wijmo-wijgrid-footer").prepend(e.uiPaginationLabel)}},g));return e},_uiThumbnail:function(){var e=this,g=e.options,d=e.uiThumbnail.offset(),f=e.element.offset(),c=e.element.height()-d.top+f.top;e.uiThumbnail.css("height",c).thumbnailsgrid(a.extend({texts:{loading:g.texts.loading},pageIndex:0,url:g.grid.urlJson,loading:function(j,h){var i=h.data.paging;e.pageIndex=i.pageIndex;j.proxy.options.data.context=g.selectedContexts||"";j.proxy.options.data.inspectors=e._jsonInspectors();j.proxy.options.data.offset=i.pageIndex*i.pageSize;j.proxy.options.data.limit=i.pageSize},loaded:function(i,h){if(i.data.totalRows===0){e.uiPaginationLabel.html(g.texts.showNoItem);e.uiNbResult.html(g.texts.showNoItem)}else{if(i.data.totalRows===1){e.uiPaginationLabel.html(g.texts.showOneItem);e.uiNbResult.html("1 "+g.texts.item)}else{e.uiPaginationLabel.html(g.texts.showNbItems.replace("{{x}}",i.data.length).replace("{{y}}",i.data.totalRows));e.uiNbResult.html(i.data.totalRows+" "+g.texts.items)}}e.uiNbResult.show();e.uiResetSearch[e.uiInspectorsTags.find(".nos-appdesk-inspectorstag").length||e.uiSearchInput.val()?"show":"hide"]()},rendered:function(){e.uiSplitterHorizontalBottom.find(".wijmo-wijpager").prepend(e.uiPaginationLabel);if(e.itemSelected!==null){var h=false;a.each(e.uiThumbnail.thumbnailsgrid("data")||[],function(i,j){if(j._model==e.itemSelected._model&&j._id==e.itemSelected._id){h=true;if(!e.uiThumbnail.thumbnailsgrid("select",i)){e.itemSelected=null}}});if(!h){e.uiThumbnail.thumbnailsgrid("unselect")}}},reader:{read:function(i){var h=parseInt(i.data.total,10);i.data=i.data.items;i.data.totalRows=h}},pageIndexChanging:function(){e.itemSelected=null;e.element.trigger("selectionChanged.appdesk",false)},selectionChanged:function(i,h){if(!h||a.isEmptyObject(h)){e.itemSelected=null;e.element.trigger("selectionChanged.appdesk",false)}else{e.itemSelected=a.extend({},h.item.data.noParseData);e.element.trigger("selectionChanged.appdesk",h.item.data.noParseData)}}},g.thumbnails));return e},_columnsMultiContext:function(d){var c=this,e=c.options;if(!e.hideContexts){a.each(d,function(f,g){if(g.dataKey==="context"){g.visible=e.selectedContexts.length>1}else{if(g.multiContextHide){g.visible=e.selectedContexts.length===1}}})}return c},_jsonInspectors:function(){var c=this,d=a.extend({},this.options.values||{});c.uiInspectorsTags.find("input").add(c.uiSearchInput).each(function(){var f=a(this),g=f.attr("name"),e=false;if(g.substr(-2,2)==="[]"){g=g.substr(0,g.length-2);e=true}if(!e){d[g]=f.val()}else{if(!a.isArray(d[g])){d[g]=[];d[g].push(f.val())}else{if(-1==a.inArray(f.val(),d[g])){d[g].push(f.val())}}}});return d},_resizeInspectorsV:function(d){var c=this;if(c.resizing){var e=c.uiInspectorsVertical.find(".wijmo-wijsplitter-v-bar").css({width:null,borderRightWidth:null}).end().find("> li").css({width:"100%",height:"auto"});if(e.length){e.css("height",(c.uiInspectorsVertical.height()/e.length)+"px").trigger(d?"widgetReload":"widgetResize")}else{c._hideSplitterV()}}return c},_resizeInspectorsH:function(d){var c=this;if(c.resizing){var e=c.uiInspectorsHorizontal.find(".wijmo-wijsplitter-h-bar").css({height:null,borderTopWidth:null}).end().find("> li").css({width:"auto",height:"100%"});if(e.length){e.css("width",(c.uiInspectorsHorizontal.width()/e.length)+"px").trigger(d?"widgetReload":"widgetResize")}else{c._hideSplitterH()}}c.uiSplitterVertical.wijsplitter("option","splitterDistance");c._trigger("slidersChange",null,c.slidersSettings());return c},_resizeList:function(e){var d=this,g=d.options;if(d.init){var c=d.uiSplitterHorizontalBottom.height()-d.uiSearchBar.outerHeight(true);if(g.defaultView==="thumbnails"){if(e){d._uiList()}else{d.uiThumbnail.thumbnailsgrid("setSize",d.uiSplitterHorizontalBottom.width(),c)}}else{if(g.defaultView==="treeGrid"){if(e){d._uiList()}else{d.uiTreeGrid.nostreegrid("setSize",null,c)}}else{d.uiGrid.noslistgrid("setSize",null,c);if(e){var f=a.grid.getHeights();d.uiGrid.noslistgrid("option","pageSize",Math.floor((c-f.footer-f.header-(d.showFilter?f.filter:0))/f.row))}}}}return d},_hideSplitterV:function(){var c=this;c.uiSplitterVertical.find(".wijmo-wijsplitter-v-bar").css({width:"0px",borderRightWidth:"0px"}).end().wijsplitter("option","panel1",{collapsed:true}).wijsplitter("refresh",true,false);return c},_hideSplitterH:function(){var c=this;c.uiSplitterHorizontal.find(".wijmo-wijsplitter-h-bar").css({height:"0px",borderTopWidth:"0px"}).end().wijsplitter("option","panel1",{collapsed:true}).wijsplitter("refresh",true,false);return c},gridReload:function(){var c=this,d=c.options;if(c.init){if(d.defaultView==="thumbnails"){c._uiList()}else{if(d.defaultView==="treeGrid"){c._uiList()}else{c.uiGrid.noslistgrid("ensureControl",true)}}}return c},resize:function(){var c=this,d=c.options;c.uiSplitterVertical.wijsplitter("refresh",true,false);c.uiSplitterHorizontal.wijsplitter("refresh",true,false);c._resizeInspectorsV()._resizeInspectorsH()._resizeList();return c},slidersSettings:function(){return{vertical:{splitterDistance:this.uiSplitterVertical.wijsplitter("option","splitterDistance")/a(window).width()},horizontal:{splitterDistance:this.uiSplitterHorizontal.wijsplitter("option","splitterDistance")/a(window).height()}}}});a.extend({appdeskAdd:function(j,f){var e=this,i=false,d="",c,g=function(p){var k=a.extend({},true,p);var q=p.i18n||{};var n={},m=function(s,r){s.setupkey=r;return s},l=function(s,u){if(s[u+"Order"]){var v=s[u+"Order"].split(",");var r=[];for(var t=0;t<v.length;t++){if(s[u][v[t]]!=null){s[u][v[t]]["setupkey"]=v[t];r.push(s[u][v[t]])}}return r}else{return a.map(s[u],m)}},o=function(r){a.each(r,function(u,y){var t,w,x=[];if(a.isPlainObject(y)){if(a.isFunction(y._)){r[u]=y._()}else{o(y)}}else{if(a.isArray(y)){o(y)}}if(u==="columns"){r[u]=l(r,u);for(t=0;t<r[u].length;t++){if(r[u][t].context){if(k.hideContexts){r[u].splice(t,1);t--;continue}w=a.nosContext({locales:p.locales,sites:p.sites,contexts:p.contexts});r[u][t]={headerText:w.label({oneLocale:q.sites,oneSite:q.languages,defaultLabel:q.contexts||"Contexts"}),dataKey:"context",setupkey:"context",allowSort:false,showFilter:false,cellFormatter:function(z){if(z.row.type&a.wijmo.wijgrid.rowType.data){z.$container.css("text-align","center").html(z.row.data.context);return true}},width:1}}else{if(r[u][t].actions){x=r[u][t].actions;var v;var s=r[u][t].showOnlyArrow?true:false;if(s){v=20}else{v=a.grid.getActionWidth(x);if(x.length>1){}}r[u][t]={headerText:s?"":"",cellFormatter:function(z){var A;if(a.isPlainObject(z.row.data)){A=a.appdeskActions(x,z.row.data,{showOnlyArrow:s});A.appendTo(z.$container);z.$container.parent().addClass("buttontd").css({width:v+1});return true}},allowSizing:false,allowSort:false,width:v,ensurePxWidth:true,showFilter:false,setupkey:"actions"}}else{if(r[u][t].cellFormatters){(function(){var A=a.isPlainObject(r[u][t].cellFormatters)?r[u][t].cellFormatters:[r[u][t].cellFormatter];var z=r[u][t].cellFormatter;r[u][t]=a.extend(r[u][t],{cellFormatter:function(B){if(B.row.type&a.wijmo.wijgrid.rowType.data){B.$container.html(B.formattedValue);if(a.isFunction(z)){z.call(this,B)}a.each(A,function(E,D){D=a.type(D)==="object"?D:{type:D};if(D.replace){B.$container.empty()}switch(D.type){case"bold":B.$container.css("font-weight","bold");break;case"css":if(a.type(D.css)==="object"){B.$container.css(D.css)}break;case"icon":if(a.isPlainObject(B.row.data)){var F="";D.column&&B.row.data[D.column]&&(F=B.row.data[D.column]);D.src&&(F=D.src);a.type(D.mapping)==="object"&&D.mapping[B.formattedValue]&&(F=D.mapping[B.formattedValue]);if(!F){break}var C=(D.size?' width="'+D.size+'" height="'+D.size+'"':"");B.$container.prepend(' <img src="'+F+'" '+C+' style="vertical-align: middle;" /> ')}break;case"iconClasses":if(a.isPlainObject(B.row.data)){if(D.column&&!B.row.data[D.column]){break}B.$container.prepend(' <span class="'+(D.column?B.row.data[D.column]:D.classes)+'" style="float:left;"></span> ')}break;case"link":B.$container.wrapInner(a('<a href="#"></a>').click(function(G){G.preventDefault();if(D.action==="default"&&x.length&&x[0].action){D.action=x[0].action}if(D.action&&a.type(D.action)!=="object"&&c.actions&&c.actions[D.action]){D.action=c.actions[D.action].action}if(a.type(D.action)==="object"){a(this).nosAction(D.action,B.row.data)}}));break}});return true}}})})()}}}}}})},n={tab:null,appdesk:{buttons:{},grid:{urlJson:"",columns:{}},thumbnails:null,defaultView:"grid",inspectors:{},splittersVertical:null,splittersHorizontal:null},i18nMessages:{},i18n:function(s){var t={};var r=this;a.extend(t,{label:s,_:function(){return r.i18nMessages[t.label]||t.label}});return t},build:function(){var t=a.extend(true,{appdesk:{texts:this.i18nMessages,splitters:{},slidersChange:function(u,v){}}},this);if(t.appdesk.splittersVertical){t.appdesk.splitters.vertical={splitterDistance:t.appdesk.splittersVertical}}if(t.appdesk.splittersHorizontal){t.appdesk.splitters.horizontal={splitterDistance:t.appdesk.splittersHorizontal}}t.appdesk.buttons=a.map(t.appdesk.buttons,m);t.appdesk.inspectors=l(t.appdesk,"inspectors");if(t.actions){var r=t.actions;if(t.appdesk.grid.columns.actions&&t.appdesk.grid.columns.actions.actions){a.each(t.appdesk.grid.columns.actions.actions,function(u,v){if(a.type(v)=="string"){t.appdesk.grid.columns.actions.actions[u]=r[v]}})}if(t.appdesk.treeGrid&&t.appdesk.treeGrid.columns&&t.appdesk.treeGrid.columns.actions&&t.appdesk.treeGrid.columns.actions.actions){a.each(t.appdesk.treeGrid.columns.actions.actions,function(u,v){if(a.type(v)=="string"){t.appdesk.treeGrid.columns.actions.actions[u]=r[v]}})}if(t.appdesk.thumbnails&&t.appdesk.thumbnails.actions){a.each(t.appdesk.thumbnails.actions,function(u,v){if(a.type(v)=="string"){t.appdesk.thumbnails.actions[u]=r[v]}})}a.each(t.appdesk.inspectors,function(u,v){if(v.preview&&v.options.actions){a.each(v.options.actions,function(w,x){if(a.type(x)=="string"){v.options.actions[w]=r[x]}})}})}k=t.appdesk;o(t);for(var s=0;s<t.appdesk.inspectors.length;s++){if(t.appdesk.inspectors[s].preview){t.appdesk.inspectors[s].url=function(w){var u=w.data("inspector"),v=a("<div></div>").appendTo(w).preview(u.options).parent().on({widgetResize:function(){v.preview("resize")}}).end()}}}return t}};return n};if(f.selectedView=="custom"){if(f.custom){d=f.views[f.custom.from].json;i=true}else{f.selectedView="default"}}if(f.selectedView!="custom"){d=f.views[f.selectedView].json}c=g(f);a.extend(true,c.i18nMessages,f.i18n);if(a.isPlainObject(f.appdesk)){a.extend(true,c,f.appdesk)}var h=function(){var p=(typeof f.hideContexts!="undefined"?f.hideContexts:Object.keys(f.contexts).length<=1);a.extend(true,c.appdesk,{contexts:f.contexts,sites:f.sites,locales:f.locales,hideContexts:p,views:f.views,name:f.configuration_id,selectedView:f.selectedView,selectedContexts:f.selectedContexts});if(i){a.extend(true,c.appdesk,{fromView:f.custom.from},f.custom.appdesk)}var m,q=a("div#"+j),k=q.closest(".nos-dispatcher"),o=c.build();if(a.isPlainObject(o.tab)&&!a.isEmptyObject(o.tab)){try{a(q).nosTabs("update",o.tab)}catch(n){log("Could not update current tab. Maybe your config file should not try to update it.")}}q.removeAttr("id").appdesk(o.appdesk);k.on({resizePanel:function(){if(m){window.clearTimeout(m)}m=window.setTimeout(function(){q.appdesk("resize")},200)},showPanel:function(){q.appdesk("resize")}});if(o.reloadEvent){if(!a.isArray(o.reloadEvent)){o.reloadEvent=[o.reloadEvent]}var l=function(){var r=[];a.each(o.reloadEvent,function(s,t){if(a.type(t)==="string"){if(k.data("nosContext")){r.push({name:t,context:k.data("nosContext")})}else{r.push({name:t})}}else{r.push(t)}});k.nosListenEvent(r,function(){q.appdesk("gridReload")},"appdeskContext")};l();k.on("contextChange",function(){k.nosUnlistenEvent("appdeskContext");l()})}q.bind("reloadView",function(t,s){a.extend(f,s);var r=a('<div id="'+j+'"></div>');r.insertAfter(q);q.remove();e.appdeskAdd(j,f)})};if(d&&(!a.isArray(d)||d.length)){require(d,function(){for(var k=0;k<arguments.length;k++){a.extend(true,c,arguments[k](c))}h()})}else{h()}},appdeskActionsList:[],appdeskActions:function(i,h,f){f=f||{};var c=a("<table><tr></tr></table>").addClass("buttontd wijgridtd");var e=[];var d=[];if(!f.showOnlyArrow){a.each(i,function(){if(this.primary){e.push(this)}else{d.push(this)}});if(d.length==1&&(d[0].icon||d[0].iconClasses)){e.push(d[0])}a.each(e,function(k,m){var j=false;if(m.iconClasses){j=m.iconClasses}else{if(m.icon){j="ui-icon ui-icon-"+m.icon}}var l=a("<th></th>").css("white-space","nowrap").addClass("ui-state-default"+(m.red?" ui-state-error":"")).attr("title",m.label).html((j?'<span class="'+j+'"></span>':"")+(m.text||!j?"&nbsp;"+m.label+"&nbsp;":""));var n=(m.name&&h&&h.actions&&typeof h.actions[m.name]!=="undefined")?h.actions[m.name]:true;if(n!==true){l.addClass("ui-state-disabled").click(function(o){o.stopImmediatePropagation();o.preventDefault()});if(a.type(n)==="string"){l.attr("title",n)}}else{l.click(function(o){o.stopImmediatePropagation();o.preventDefault();l.nosAction(m.action,h)}).hover(function(){a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")})}if(j&&!m.text){l.css({width:20,textAlign:"center"}).children().css({margin:"auto"})}else{if(j&&m.text){l.find("span").css("float","left")}}l.appendTo(c.find("tr"))})}if(f.showOnlyArrow||d.length>=2||(d.length==1&&!(d[0].icon||d[0].iconClasses))){var g=a("<th></th>").addClass("ui-state-default").css({width:"20px"}).hover(function(){a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")});a("<span></span>").addClass("ui-icon ui-icon-triangle-1-s").appendTo(g);g.appendTo(c.find("tr")).click(function(l){a.each(a.appdeskActionsList,function(){a(this).wijmenu("hideAllMenus")});if(!this.created){var k=a("<ul></ul>");a.each(i,function(o,p){var n;if(p.iconClasses){n=p.iconClasses}else{if(p.icon){n="ui-icon ui-icon-"+p.icon}}var r='<span class="'+(n?n:"nos-icon16 nos-icon16-empty")+' wijmo-wijmenu-icon-left"></span><span class="wijmo-wijmenu-text">'+p.label+"</span>";var m=a('<li><a href="#"></a></li>').appendTo(k).find("a").html(r);if(p.red){m.addClass("ui-state-error")}var q=(p.name&&h&&h.actions&&typeof h.actions[p.name]!=="undefined")?h.actions[p.name]:true;if(q!==true){m.addClass("ui-state-disabled").click(function(s){s.stopImmediatePropagation();s.preventDefault()});if(a.type(q)==="string"){m.attr("title",q)}}else{m.click(function(s){s.stopImmediatePropagation();s.preventDefault();k.wijmenu("hideAllMenus");m.nosAction(p.action,h)})}});var j=g.closest(".ui-dialog-content, .nos-dispatcher, body");k.appendTo(j);k.wijmenu({trigger:g,triggerEvent:"click",orientation:"vertical",animation:{animated:"slide",option:{direction:"up"},duration:50,easing:null},hideAnimation:{animated:"slide",option:{direction:"up"},duration:0,easing:null},position:{my:"right top",at:"right bottom",collision:"flip",offset:"0 0"}});a.appdeskActionsList.push(k);this.created=true;g.triggerHandler("click")}});g.click(false)}return c},grid:{getHeights:function(){if(this.heights===b){var c=a("<div></div>").appendTo("body");var d=a("<table></table>").addClass("nos-appdesk").appendTo(c).noslistgrid({scrollMode:"auto",pageSize:1,showFilter:true,allowPaging:true,data:[["test"],["test2"]]});this.heights={row:d.find("tr:first").height(),footer:c.find(".wijmo-wijgrid-footer").outerHeight(),header:c.find(".wijmo-wijgrid-headerrow").outerHeight(),filter:c.find(".wijmo-wijgrid-filterrow").outerHeight()};d.noslistgrid("destroy");c.remove()}return this.heights},getActionWidth:function(f){var c=a("<div></div>").appendTo("body");var e=a("<table></table>").addClass("nos-appdesk").appendTo(c).noslistgrid({scrollMode:"none",showFilter:true,allowPaging:true,columns:[{headerText:"",cellFormatter:function(g){if(a.isPlainObject(g.row.data)){var h=a.appdeskActions(f,[]);h.appendTo(g.$container);g.$container.parent().addClass("buttontd");return true}},allowSizing:true,showFilter:false,ensurePxWidth:true}],data:[{key:"value"}]});c.find("table.buttontd.wijgridtd").css({"font-size":"1.05em",width:"auto"});var d=c.find(".buttontd .buttontd:first").outerWidth();e.noslistgrid("destroy");c.remove();return d}}});return a});
define("jquery-nos-datacatchers",["jquery","jquery-nos","jquery-ui.widget","jquery-ui.button","wijmo.wijaccordion"],function(a){var b=void (0);a.widget("nos.datacatchers",{options:{model_id:"",model_name:""},_create:function(){var c=this,d=c.options;c.element.addClass("nos-datacatchers ui-widget-content");c.uiApplications=c.element.find(".catchers div");c.uiCatcherForm=c.element.find(".nos-datacatchers-catecherform");c.uiForm=c.element.find("form");c.uiSave=c.uiForm.find(".nos-datacatchers-buttons button");c.uiClose=c.element.find(".nos-datacatchers-close")},_init:function(){var c=this,d=c.options;c.element.find(".accordion").wijaccordion();c._applications();c.uiForm.nosFormUI();c._form(c.uiForm);c.uiForm.bind("ajax_success",function(g,f){c.uiApplications.html(f.applications);c._applications();c.uiCatcherForm.empty()});c.uiClose.click(function(f){f.preventDefault();c.element.trigger("close")});c.element.nosListenEvent({name:d.model_name,id:d.model_id,action:"update"},function(){a.ajax({url:"admin/nos/datacatcher/form",data:{model_name:d.model_name,model_id:d.model_id},success:function(e){c.element.nosAjaxSuccess(e);c.element.remove()}})})},_applications:function(){var c=this,d=c.options;c.uiApplications.find("button.catcher").each(function(){var e=a(this),g=e.data("params"),f=e.data("nuggets");e.button({label:g.title,icons:{primary:g.iconClasses||"nos-icon16 nos-icon16-share"}}).click(function(h){h.preventDefault();h.stopImmediatePropagation();if(g.action){a(this).nosAction(g.action,f)}else{a.ajax({url:g.url,success:function(i){c.uiCatcherForm.empty();a("<div><h3></h3><div></div></div>").appendTo(c.uiCatcherForm).find("h3").html(g.title).end().find("div").html(i).end().wijaccordion().nosFormUI();c._form(c.uiCatcherForm);c.uiCatcherForm.find(".nos-datacatchers-buttons a").click(function(j){j.preventDefault();c.uiCatcherForm.empty()})}})}});if(g.iconUrl){e.find(".ui-button-icon-primary").removeClass("nos-icon16-share").addClass("nos-icon16").css("background-image",'url("'+g.iconUrl+'")')}});return c},_form:function(e){var c=this,d=c.options;e.find(".nos-datacatchers-nugget-checkbox").each(function(){a(this).change(function(){if(a(this).is(":checked")){a(this).closest("tr").find("td:eq(0) .ui-widget").each(function(){var f=a(this).attr("disabled",true).data();if(f.wijtextbox){f.wijtextbox.disable()}})}else{a(this).closest("tr").find("td:eq(0) .ui-widget").each(function(){var f=a(this).removeAttr("disabled").data();if(f.wijtextbox){f.wijtextbox.enable()}})}}).triggerHandler("change")});e.find(".nos-datacatchers-nugget-image").hover(function(){a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")}).click(function(){a(this).find("input").prop("checked",true).wijradio("refresh");a(this).addClass("ui-state-active").siblings().removeClass("ui-state-active")});return c}});return a});
