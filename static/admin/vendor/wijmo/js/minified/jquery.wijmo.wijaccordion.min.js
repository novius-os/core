/*
 *
 * Wijmo Library 2.3.7
 * http://wijmo.com/
 *
 * Copyright(c) GrapeCity, Inc.  All rights reserved.
 * 
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * licensing@wijmo.com
 * http://wijmo.com/widgets/license/
 *
 **/
(function(a){"use strict";a.widget("wijmo.wijaccordion",{widgetEventPrefix:"wijaccordion",options:{animated:"slide",duration:null,event:"click",disabled:false,expandDirection:"bottom",header:"> li > :first-child,> :not(li):even",requireOpenedPane:true,selectedIndex:0},_setOption:function(d,b){var c=this.options;if(c[d]!==b)switch(d){case"selectedIndex":this.activate(b);break;case"disabled":if(b)this.element.addClass("ui-state-disabled");else this.element.removeClass("ui-state-disabled");break;case"event":this._unbindLiveEvents();this.options.event=b;this._bindLiveEvents();break;case"header":this._handleHeaderChange(b,c.header);break;case"expandDirection":this._onDirectionChange(b,true,c.expandDirection)}a.Widget.prototype._setOption.apply(this,arguments)},_handleHeaderChange:function(b,a){var c=this.element.find(a);c.removeClass("wijmo-wijaccordion-header ui-helper-reset ui-state-active "+this._triangleIconOpened).siblings(".wijmo-wijaccordion-content").removeClass("wijmo-wijaccordion-content ui-helper-reset ui-widget-content wijmo-wijaccordion-content-active");this._initHeaders(b)},_initHeaders:function(a){var c=this.options,a=a?a:c.header,b=this.element.find(a);b.each(jQuery.proxy(this._initHeader,this))},_initHeader:function(e,f){var g=this.options,d=this.element.data("rightToLeft"),b=a(f),c=a(b.next()[0]);if(d){b.remove();b.insertAfter(c)}b.addClass("wijmo-wijaccordion-header ui-helper-reset").attr("role","tab");c.attr("role","tabpanel");b.find("> a").length===0&&b.wrapInner('<a href="#"></a>');b.find("> .ui-icon").length===0&&a('<span class="ui-icon"></span>').insertBefore(a("> a",b)[0]);if(e===g.selectedIndex){b.addClass("ui-state-active").addClass(this._headerCornerOpened).attr({"aria-expanded":"true",tabIndex:0}).find("> .ui-icon").addClass(this._triangleIconOpened);c.addClass("wijmo-wijaccordion-content-active").addClass(this._contentCornerOpened).wijTriggerVisibility()}else{b.addClass("ui-state-default ui-corner-all").attr({"aria-expanded":"false",tabIndex:-1}).find("> .ui-icon").addClass(this._triangleIconClosed);c.hide()}c.addClass("wijmo-wijaccordion-content ui-helper-reset ui-widget-content")},_create:function(){if(window.wijmoApplyWijTouchUtilEvents)a=window.wijmoApplyWijTouchUtilEvents(a);this.element.addClass("wijmo-wijaccordion ui-widget wijmo-wijaccordion-icons ui-helper-reset ui-helper-clearfix");var b=this.options;b.disabled&&this.element.addClass("ui-state-disabled");this._onDirectionChange(b.expandDirection,false);this._initHeaders();this.element.attr("role","tablist");a.Widget.prototype._create.apply(self,arguments)},_init:function(){this._bindLiveEvents()},destroy:function(){this._unbindLiveEvents();this.element.removeClass("wijmo-wijaccordion ui-widget ui-helper-reset wijmo-wijaccordion-icons").removeAttr("role");a.Widget.prototype.destroy.apply(this,arguments)},_getHeaders:function(){var g=this.options,f=this.element.data("rightToLeft"),e=[],c,d,b=this.element.find(g.header);if(b.length>0&&!a(b[0]).hasClass("wijmo-wijaccordion-header")&&a(b[0]).hasClass("wijmo-wijaccordion-content"))for(c=0;c<b.length;c+=1){d=f?a(b[c]).next(".wijmo-wijaccordion-header"):a(b[c]).prev(".wijmo-wijaccordion-header");d.length>0&&e.push(d[0])}else return b;return a(e)},activate:function(f){var b,d=this.options,j=this._getHeaders(),c,p=this.element.data("rightToLeft"),i,l,g,h,m,o,n,k,q,e;c=a(jQuery.grep(j,function(b){return a(b).hasClass("ui-state-active")}));if(typeof f==="number")b=a(j[f]);else if(typeof f==="string"){f=parseInt(f,0);b=a(j[f])}else{b=a(f);f=j.index(f)}if(b.hasClass("ui-state-disabled"))return false;if(b.hasClass("ui-state-active"))if(d.requireOpenedPane){if(c.length===b.length&&c.index()===b.index())return false}else{c=b;b=a(null)}else if(!d.requireOpenedPane)c=a(null);i=j.index(b);l=j.index(c);g=p?b.prev(".wijmo-wijaccordion-content"):b.next(".wijmo-wijaccordion-content");h=p?c.prev(".wijmo-wijaccordion-content"):c.next(".wijmo-wijaccordion-content");if(c.length===0&&b.length===0)return false;if(!this._trigger("beforeSelectedIndexChanged",null,{newIndex:i,prevIndex:l}))return false;c.removeClass("ui-state-active").removeClass(this._headerCornerOpened).addClass("ui-state-default ui-corner-all").attr({"aria-expanded":"false",tabIndex:-1}).find("> .ui-icon").removeClass(this._triangleIconOpened).addClass(this._triangleIconClosed);b.removeClass("ui-state-default ui-corner-all").addClass("ui-state-active").addClass(this._headerCornerOpened).attr({"aria-expanded":"true",tabIndex:0}).find("> .ui-icon").removeClass(this._triangleIconClosed).addClass(this._triangleIconOpened);if(d.animated){m={toShow:g,toHide:h,complete:jQuery.proxy(function(){h.removeClass("wijmo-wijaccordion-content-active");g.addClass("wijmo-wijaccordion-content-active").wijTriggerVisibility();h.css("display","");g.css("display","");if(a.fn.wijlinechart){h.find(".wijmo-wijlinechart").wijlinechart("redraw");g.find(".wijmo-wijlinechart").wijlinechart("redraw")}this._trigger("selectedIndexChanged",null,{newIndex:i,prevIndex:l})},this),horizontal:this.element.hasClass("ui-helper-horizontal"),rightToLeft:this.element.data("rightToLeft"),down:i>l,autoHeight:d.autoHeight||d.fillSpace};o=d.animated;n=d.duration;if(a.isFunction(o))d.animated=o(m);if(a.isFunction(n))d.duration=n(m);k=a.wijmo.wijaccordion.animations;q=d.duration;e=d.animated;if(e&&!k[e]&&!a.easing[e])e="slide";if(!k[e])k[e]=function(a){this.slide(a,{easing:e,duration:q||700})};k[e](m)}else{c.length>0&&h.hide().removeClass("wijmo-wijaccordion-content-active");b.length>0&&g.show().addClass("wijmo-wijaccordion-content-active").addClass(this._contentCornerOpened).wijTriggerVisibility();if(a.fn.wijlinechart){h.find(".wijmo-wijlinechart").wijlinechart("redraw");g.find(".wijmo-wijlinechart").wijlinechart("redraw")}this._trigger("selectedIndexChanged",null,{newIndex:i,prevIndex:l})}this.options.selectedIndex=i},_bindLiveEvents:function(){this.element.find(".wijmo-wijaccordion-header").live(this.options.event+".wijaccordion",jQuery.proxy(this._onHeaderClick,this)).live("keydown.wijaccordion",jQuery.proxy(this._onHeaderKeyDown,this)).live("mouseenter.wijaccordion",function(){a(this).addClass("ui-state-hover")}).live("mouseleave.wijaccordion",function(){a(this).removeClass("ui-state-hover")}).live("focus.wijaccordion",function(){a(this).addClass("ui-state-focus")}).live("blur.wijaccordion",function(){a(this).removeClass("ui-state-focus")})},_unbindLiveEvents:function(){this.element.find(".wijmo-wijaccordion-header").die(".wijaccordion")},_onHeaderClick:function(a){!this.options.disabled&&this.activate(a.currentTarget);return false},_onHeaderKeyDown:function(d){if(this.options.disabled||d.altKey||d.ctrlKey)return;var b=a.ui.keyCode,f=this.element.find(".wijmo-wijaccordion-header.ui-state-focus"),c,e=this._getHeaders();if(f.length>0){c=a(".wijmo-wijaccordion-header",this.element).index(f);switch(d.keyCode){case b.RIGHT:case b.DOWN:if(e[c+1]){e[c+1].focus();return false}break;case b.LEFT:case b.UP:if(e[c-1]){e[c-1].focus();return false}break;case b.SPACE:case b.ENTER:this.activate(d.currentTarget);d.preventDefault()}}return true},_onDirectionChange:function(j,e,i){var b,g,f,d,c,h;if(e){g=this.element.find(".wijmo-wijaccordion-header."+this._headerCornerOpened);g.removeClass(this._headerCornerOpened);f=this.element.find(".wijmo-wijaccordion-content."+this._contentCornerOpened);f.removeClass(this._contentCornerOpened);d=this.element.find("."+this._triangleIconOpened);c=this.element.find("."+this._triangleIconClosed);d.removeClass(this._triangleIconOpened);c.removeClass(this._triangleIconClosed)}i!==null&&this.element.removeClass("wijmo-wijaccordion-"+i);switch(j){case"top":this._headerCornerOpened="ui-corner-bottom";this._contentCornerOpened="ui-corner-top";this._triangleIconOpened="ui-icon-triangle-1-n";this._triangleIconClosed="ui-icon-triangle-1-e";b=true;this.element.removeClass("ui-helper-horizontal");this.element.addClass("wijmo-wijaccordion-top");break;case"right":this._headerCornerOpened="ui-corner-left";this._contentCornerOpened="ui-corner-right";this._triangleIconOpened="ui-icon-triangle-1-e";this._triangleIconClosed="ui-icon-triangle-1-s";b=false;this.element.addClass("ui-helper-horizontal");this.element.addClass("wijmo-wijaccordion-right");break;case"left":this._headerCornerOpened="ui-corner-right";this._contentCornerOpened="ui-corner-left";this._triangleIconOpened="ui-icon-triangle-1-w";this._triangleIconClosed="ui-icon-triangle-1-s";b=true;this.element.addClass("ui-helper-horizontal");this.element.addClass("wijmo-wijaccordion-left");break;default:this._headerCornerOpened="ui-corner-top";this._contentCornerOpened="ui-corner-bottom";this._triangleIconOpened="ui-icon-triangle-1-s";this._triangleIconClosed="ui-icon-triangle-1-e";b=false;this.element.removeClass("ui-helper-horizontal");this.element.addClass("wijmo-wijaccordion-bottom")}h=this.element.data("rightToLeft");this.element.data("rightToLeft",b);if(e){d.addClass(this._triangleIconOpened);c.addClass(this._triangleIconClosed);g.addClass(this._headerCornerOpened);f.addClass(this._contentCornerOpened)}e&&b!==h&&this.element.children(".wijmo-wijaccordion-header").each(function(){var c=a(this),d;if(b){d=c.next(".wijmo-wijaccordion-content");c.remove();c.insertAfter(d)}else{d=c.prev(".wijmo-wijaccordion-content");c.remove();c.insertBefore(d)}})}});a.extend(a.wijmo.wijaccordion,{animations:{slide:function(b,h){b=a.extend({easing:"swing",duration:300},b,h);if(!b.toHide.size()){b.toShow.stop(true,true).animate(b.horizontal?{width:"show"}:{height:"show"},b);return}if(!b.toShow.size()){b.toHide.stop(true,true).animate(b.horizontal?{width:"hide"}:{height:"hide"},b);return}var i=b.toShow.css("overflow"),f=0,e={},g={},j=b.horizontal?["width","paddingLeft","paddingRight"]:["height","paddingTop","paddingBottom"],d,c=b.toShow;if(b.horizontal){d=c[0].style.height;c.height(parseInt(c.parent().height(),10)-parseInt(c.css("paddingTop"),10)-parseInt(c.css("paddingBottom"),10)-(parseInt(c.css("borderTopWidth"),10)||0)-(parseInt(c.css("borderBottomWidth"),10)||0))}else{d=c[0].style.width;c.width(parseInt(c.parent().width(),10)-parseInt(c.css("paddingLeft"),10)-parseInt(c.css("paddingRight"),10)-(parseInt(c.css("borderLeftWidth"),10)||0)-(parseInt(c.css("borderRightWidth"),10)||0))}a.each(j,function(f,d){g[d]="hide";var c=(""+a.css(b.toShow[0],d)).match(/^([\d+-.]+)(.*)$/);e[d]={value:c?c[1]:0,unit:c?c[2]||"px":"px"}});b.toShow.css(b.horizontal?{width:0,overflow:"hidden"}:{height:0,overflow:"hidden"}).stop(true,true).show();b.toHide.filter(":hidden").each(b.complete).end().filter(":visible").stop(true,true).animate(g,{step:function(d,a){var c;if(a.prop===b.horizontal?"width":"height")f=a.end-a.start===0?0:(a.now-a.start)/(a.end-a.start);c=f*e[a.prop].value;if(c<0)c=0;b.toShow[0].style[a.prop]=c+e[a.prop].unit},duration:b.duration,easing:b.easing,complete:function(){!b.autoHeight&&b.toShow.css(b.horizontal?"width":"height","");b.toShow.css(b.horizontal?"height":"width",d);b.toShow.css({overflow:i});b.complete()}})},bounceslide:function(a){this.slide(a,{easing:a.down?"easeOutBounce":"swing",duration:a.down?1e3:200})}}})})(jQuery);