/*
 *
 * Wijmo Library 2.3.7
 * http://wijmo.com/
 *
 * Copyright(c) GrapeCity, Inc.  All rights reserved.
 * 
 * Licensed under the Wijmo Commercial License. Also available under the GNU GPL Version 3 license.
 * licensing@wijmo.com
 * http://wijmo.com/widgets/license/
 *
 *
 **/
(function(a){"use strict";a.widget("wijmo.wijcompositechart",a.wijmo.wijchartcore,{options:{stacked:false,clusterOverlap:0,clusterWidth:85,clusterRadius:0,clusterSpacing:0,seriesList:[],animation:{enabled:true,duration:400,easing:">"},seriesTransition:{enabled:true,duration:400,easing:">"},mouseDown:null,mouseUp:null,mouseOver:null,mouseOut:null,mouseMove:null,click:null},widgetEventPrefix:"wijcompositechart",_create:function(){var c=this,b=c.options,d=c._getDefFill();a.each(b.seriesList,function(d,c){if(c.type==="bar"){a.extend(true,b.axis,{x:{compass:"west"},y:{compass:"south"}});return true}else if(c.type==="pie"&&c.pieSeriesList)c.data=c.pieSeriesList});a.extend(true,{compass:"east"},b.hint);if(b.is100Percent)b.is100Percent=false;if(b.yAxes&&a.isArray(b.yAxes)&&b.yAxes.length>0)b.axis.y=b.yAxes;c._hotFixForJQ1_9();a.each(b.seriesStyles,function(b,a){if(!a.fill)a.fill=d[b]});a.wijmo.wijchartcore.prototype._create.apply(c,arguments);c.chartElement.addClass("wijmo-wijcompositechart")},_setOption:function(b){b!=="is100Percent"&&a.wijmo.wijchartcore.prototype._setOption.apply(this,arguments)},_supportStacked:function(){return true},destroy:function(){var d=this,b=d.chartElement,c=b.data("fields"),e=c&&c.aniBarsAttr;b.removeClass("wijmo-wijcompositechart");a.wijmo.wijchartcore.prototype.destroy.apply(this,arguments);d._destroyRaphaelArray(e);b.data("fields",null)},_isBarChart:function(){return true},_clearChartElement:function(){var c=this,e=c.options,d=c.chartElement,b=d.data("fields");if(b&&b.allElements){a.each(b.allElements,function(d,b){if(d==="scatters")b.length&&a.each(b,function(d,c){if(c.length){a.each(c,function(b,a){a&&a.remove&&a.remove();c[b]=null});b[d]=null}});c._destroyRaphaelArray(b)});b.allElements=null}a.wijmo.wijchartcore.prototype._clearChartElement.apply(c,arguments);if(b&&b.ctracers)b.ctracers=null;c.element.removeData("plotInfos");if(!e.seriesTransition.enabled)if(b&&b.aniBarsAttr)b.aniBarsAttr=null},_bindData:function(){var b=this,e=b.options,f=e.dataSource,g=e.seriesList,c=e.data,d;a.each(g,function(q,l){var e=l.data,m,n,k,j=l.dataSource||f,p=l.type,h,i,g,o=[];if(j&&e)if(p==="pie"){h=e.label;i=e.value;g=e.offset;if(h&&h.bind)h=b._getBindData(j,h.bind);if(i&&i.bind)i=b._getBindData(j,i.bind);if(g&&g.bind)g=b._getBindData(j,g.bind);if(h&&a.isArray(h)&&h.length&&i&&a.isArray(i)&&i.length){a.each(i,function(b,e){var d,c=0;if(b>=0&&b<h.length)d=h[b];if(g&&a.isArray(i)&&g.length&&b>=0&&b<g.length)c=typeof g[b]==="undefined"?0:g[b];o.push({data:e,label:d,offset:c,legendEntry:true})});l.data=o}}else{m=e.x;n=e.y;k=e.y1;if(m&&m.bind)e.x=b._getBindData(j,m.bind);else if(c&&c.x&&c.x.bind){if(d===undefined)d=b._getBindData(j,c.x.bind);e.x=d}if(n&&n.bind)e.y=b._getBindData(j,n.bind);if(k&&k.bind)e.y1=b._getBindData(j,k.bind)}})},getElement:function(f,b,c){var d=this.chartElement,e=d.data("fields"),a=e.chartElements;switch(f){case"bar":case"column":return a.bars[b];case"line":case"area":return a.paths[b];case"linemarkers":return a.markersSet[b];case"pie":return this._getPie(a,b,c)}return null},_getPie:function(b,e,d){if(d!==undefined)return b["sectors"+d]?b["sectors"+d][e]:null;else{var c=[];a.each(b,function(b,d){/sectors/.test(b)&&b!=="sectors"&&a.each(d,function(b,a){c.push(a)})});if(c.length===0)c=b.sectors;return c[e]}},_isSeriesDataEmpty:function(){var c=this,b=c.options.seriesList;if(!b||b.length===0)return true;a.each(b,function(b,a){return a.type==="pie"&&(!a.data||!a.label||a.label.length===0)?true:!a.data||(!a.data.x||!a.data.y)&&!a.data.xy?true:void 0});return false},_showSerieEles:function(d){var f=d.type,b=d.eles,e=this.options.showChartLabels,c;switch(f){case"pie":if(b.sector){b.sector.show();b.sector.shadow&&b.sector.shadow.show();b.sector.tracker&&b.sector.tracker.show()}b.label&&b.label.show();break;case"line":case"spline":case"bezier":case"area":b.markers&&a.each(b.markers,function(d,b){c=a(b.node).data("wijchartDataObj");if(c&&c.lineSeries&&c.lineSeries.markers)if(!c.lineSeries.markers.visible)return true;b.show()});b.dcl&&a.each(b.dcl,function(b,a){e&&a.show()});if(b.path){c=a(b.path.node).data("wijchartDataObj");if(c.visible){b.path.show();b.path.shadow&&b.path.shadow.show();b.path.area&&b.path.area.show();b.path.tracker&&b.path.tracker.show();a(b.path.node).data("wijchartDataObj")&&a(b.path.node).data("wijchartDataObj").virtualMarkers&&a.each(a(b.path.node).data("wijchartDataObj").virtualMarkers,function(b,a){a.visible=true})}}break;case"bar":case"column":a.each(b,function(c,b){if(b.bar){b.bar.show();b.bar.shadow&&b.bar.shadow.show();b.bar.tracker&&b.bar.tracker.show();if(a(b.bar.node).data("wijchartDataObj"))a(b.bar.node).data("wijchartDataObj").visible=true}b.dcl&&b.dcl.show();b.animatedBar&&!b.animatedBar.removed&&b.animatedBar.show()});break;case"scatter":a.each(b,function(c,b){b.show();b.label&&b.label.show();if(a(b.element).data("wijchartDataObj"))a(b.element).data("wijchartDataObj").visible=true});break;case"bubble":a.each(b,function(b,a){if(a.bubble){a.bubble.show();a.bubble.tracker&&a.bubble.tracker.show()}a.dcl&&a.dcl.show();a.symbol&&a.symbol.show()})}},_hideSerieEles:function(c){var d=c.type,b=c.eles;switch(d){case"pie":if(b.sector){b.sector.hide();b.sector.shadow&&b.sector.shadow.hide();b.sector.tracker&&b.sector.tracker.hide()}b.label&&b.label.hide();break;case"line":case"spline":case"bezier":case"area":b.markers&&a.each(b.markers,function(b,a){a.hide()});b.dcl&&a.each(b.dcl,function(b,a){a.hide()});if(b.path){b.path.hide();b.path.shadow&&b.path.shadow.hide();b.path.area&&b.path.area.hide();b.path.tracker&&b.path.tracker.hide();a(b.path.node).data("wijchartDataObj")&&a(b.path.node).data("wijchartDataObj").virtualMarkers&&a.each(a(b.path.node).data("wijchartDataObj").virtualMarkers,function(b,a){a.visible=false})}break;case"bar":case"column":a.each(b,function(c,b){if(b.bar){b.bar.hide();b.bar.shadow&&b.bar.shadow.hide();b.bar.tracker&&b.bar.tracker.hide();if(a(b.bar.node).data("wijchartDataObj"))a(b.bar.node).data("wijchartDataObj").visible=false}b.dcl&&b.dcl.hide();b.animatedBar&&!b.animatedBar.removed&&b.animatedBar.hide()});break;case"scatter":a.each(b,function(c,b){b.hide();b.label&&b.label.hide();if(a(b.element).data("wijchartDataObj"))a(b.element).data("wijchartDataObj").visible=false});break;case"bubble":a.each(b,function(b,a){if(a.bubble){a.bubble.hide();a.bubble.tracker&&a.bubble.tracker.hide()}a.dcl&&a.dcl.hide();a.symbol&&a.symbol.hide()})}},_indicatorLineShowing:function(c){var b;a.wijmo.wijchartcore.prototype._indicatorLineShowing.apply(this,arguments);a.each(c,function(c,a){b=a.type;if(b==="column"||b==="bar")a.bar.attr(a.hoverStyle);else if(b==="marker")a.marker.attr(a.markerHoverStyle);else if(b==="scatter"){a.dot.attr(a.hoverStyle);a.dot.scale(1.5,1.5)}})},_removeIndicatorStyles:function(c){var b;a.each(c,function(c,a){b=a.type;if(b==="column"||b==="bar")a.bar.attr(a.style);else if(b==="marker"){a.marker.attr(a.markerStyle);a.marker.transform("s1")}else if(b==="scatter"){a.dot.attr(a.style);a.dot.scale(1,1)}})},_paintTooltip:function(){var b=this,d=b.chartElement,e=d.data("fields")||{},c=e.ctracers||[];a.wijmo.wijchartcore.prototype._paintTooltip.apply(this,arguments);b.tooltip&&a.each(c,function(c,a){if(a.trackers&&a.trackers.length)c===0&&b.tooltip.setOptions({relatedElement:a.trackers[0]})})},_paintPlotArea:function(){var b=this,c=b.options,g="seriesList",f="seriesStyles",e="seriesHoverStyles",o=c[f],m=c[e],k=b.canvasBounds,l={},i=0,p=a.isArray(c.axis.y),j={canvas:b.canvas,tooltip:b.tooltip,bounds:k,widgetName:b.widgetName,seriesTransition:c.seriesTransition,showChartLabels:c.showChartLabels,textStyle:c.textStyle,chartLabelStyle:c.chartLabelStyle,chartLabelFormatString:c.chartLabelFormatString,shadow:c.shadow,hint:c.hint,animation:c.animation,disabled:c.disabled,culture:b._getCulture(),widget:this,mouseDown:function(c,a){b._trigger("mouseDown",c,a)},mouseUp:function(c,a){b._trigger("mouseUp",c,a)},mouseOver:function(c,a){b._trigger("mouseOver",c,a)},mouseOut:function(c,a){b._trigger("mouseOut",c,a)},mouseMove:function(c,a){b._trigger("mouseMove",c,a)},click:function(c,a){b._trigger("click",c,a)}},n=b.chartElement.data("fields"),d,h;if(n)n.ctracers=[];a.each(c[g],function(s,d){var h=d.type,b={},k=h,j={},q=a.extend({},o[i]),n=a.extend({},m[i]),r=d.yAxis;if(!h||h.length===0)return true;if(k==="spline"||k==="bezier")k="line";b=l[k];if(!b){if(h==="pie")b=[];else b={};l[k]=b;if(d.hint){b.hint=d.hint;if(!c.hint.content)c.hint.content=d.hint.content;if(!c.hint.title)c.hint.title=d.hint.title}}if(h==="pie"){a.each(d.data,function(c,b){q=a.extend({},o[i]);n=a.extend({},m[i]);if(!j[g])j[g]=[];if(!j[f])j[f]=[];if(!j[e])j[e]=[];b.pieID=s+1;j[g].push(b);j[f].push(q);j[e].push(n);i++});j.radius=d.radius;j.center=d.center;j.label=d.label;b.push(j);return true}else if(h==="column")b.horizontal=false;else if(h==="bar")b.horizontal=true;else if(h==="spline")d.fitType="spline";else if(h==="bezier")d.fitType="bezier";if(p)b.yAxis=r||0;if(h==="line"||h==="spline"||h==="bezier"){delete q.fill;delete n.fill}if(!b[g])b[g]=[];if(!b[f])b[f]=[];if(!b[e])b[e]=[];if(h==="scatter")b.showChartLabels=!!d.showChartLabels;b[g].push(d);b[f].push(q);b[e].push(n);i++});a.each(l,function(f,e){var i=e.yAxis,g=c.chartLabel;switch(f){case"pie":a.each(e,function(i,g){var e=g.center,c=g.radius||50,h=e?{startX:e.x-c,startY:e.y-c,endX:e.x+c,endY:e.y+c}:{startX:k.startX+10,startY:k.startY+10,endX:k.startX+10+2*c,endY:k.startY+10+2*c};d=a.extend(true,{},j,{bounds:h,radius:c},g);b.chartElement.wijpie(d);b.chartElement.data("fields").aniSectorAttrs=null;b.chartElement.data("fields").aniLabelAttrs=null;b._savechartData(f)});break;case"bar":case"column":d=a.extend(true,{},j,{stacked:c.stacked,axis:c.axis,clusterOverlap:c.clusterOverlap,clusterWidth:c.clusterWidth,clusterSpacing:c.clusterSpacing,is100Percent:c.is100Percent,clusterRadius:c.clusterRadius,isYTime:b.axisInfo.y[0].isTime,isXTime:b.axisInfo.x.isTime,yAxisInfo:b.axisInfo.y,yAxisIndex:i},e);b.chartElement.wijbar(d);b._savechartData(f);break;case"line":case"spline":case"bezier":case"area":h=b._getyAxisGroup(e);a.each(h,function(g,e){if(!b.aniPathsAttr)b.aniPathsAttr=[];d=a.extend(true,{},j,{axis:c.axis,isXTime:b.axisInfo.x.isTime,isYTime:b.axisInfo.y[0].isTime,type:f==="area"?"area":"line",hole:c.hole},e);d.aniPathsAttr=b.aniPathsAttr;d.chartLabelEles=b.chartLabelEles;d.axis.y=c.axis.y[g]||c.axis.y;b.chartElement.wijline(d);b._savechartData(f,true)});break;case"scatter":h=b._getyAxisGroup(e);a.each(h,function(h,g){d=a.extend(true,{},j,{axis:c.axis,isXTime:b.axisInfo.x.isTime,isYTime:b.axisInfo.y[0].isTime,zoomOnHover:c.zoomOnHover,showChartLabels:e.showChartLabels},g);d.axis.y=c.axis.y[h]||c.axis.y;b.chartElement.wijscatter(d);b._savechartData(f)});break;case"bubble":h=b._getyAxisGroup(e);if(!g)g={visible:c.showChartLabels,style:c.chartLabelStyle};a.each(h,function(e,h){d=a.extend(true,{},j,{axis:c.axis,isXTime:b.axisInfo.x.isTime,isYTime:b.axisInfo.y[0].isTime,xAxisInfo:b.axisInfo.x,yAxisInfo:b.axisInfo.y,chartLabel:g,minimumSize:c.minimumSize||5,maximumSize:c.maximumSize||20,sizingMethod:c.sizingMethod||"diameter"},h);d.axis.y=c.axis.y[e]||c.axis.y;d.yAxisInfo=b.axisInfo.y[e]||b.axisInfo.y[0];b.chartElement.wijbubble(d);b._savechartData(f)});break}});b.chartElement.data("fields").seriesEles=null;b._bindtooltip()},_savechartData:function(f,g){var d=this,b=d.chartElement.data("fields"),h=b.seriesEles,e=b.allElements||{},c;a.each(h,function(b,a){d.seriesEles.push({eles:a,type:f})});if(!g){c=b.ctracers||[];c.push({trackers:b.trackers,type:f});b.ctracers=c}b&&b.chartElements&&a.each(b.chartElements,function(b,a){d._copyElements(e,b,a)});b.allElements=e},_copyElements:function(d,e,b){var c;if(b&&a.isArray(b)){c=d[e]||[];d[e]=c.concat(b)}else if(b){c=d[e]||[];c.concat([b])}},_getyAxisGroup:function(c){var b={};a.each(c.seriesList,function(e,d){var a=d.yAxis||0;if(!b[a])b[a]={seriesList:[],seriesStyles:[],seriesHoverStyles:[]};b[a].seriesList.push(d);b[a].seriesStyles.push(c.seriesStyles[e]);b[a].seriesHoverStyles.push(c.seriesHoverStyles[e])});return b},_bindtooltip:function(){var b=this,c=b.widgetName,d=b.chartElement.data("fields");d&&d.ctracers&&a.each(d.ctracers,function(b,a){a.trackers&&a.trackers.toFront()});b.chartElement.delegate(".linetracker, .wijchart-canvas-marker, .bartracker, .pietracker, .wijscatterchart, .bubbletracker","mouseover."+c,a.proxy(b._tooltipMouseOver,b));b.chartElement.delegate(".linetracker, .wijchart-canvas-marker, .bartracker, .pietracker, .wijscatterchart, .bubbletracker","mouseout."+c,a.proxy(b._tooltipMouseOut,b));b.chartElement.delegate(".linetracker, .wijchart-canvas-marker, .bartracker, .pietracker, .wijscatterchart, .bubbletracker","mousemove."+c,a.proxy(b._tooltipMouseMove,b))},_tooltipMouseOver:function(g){var d=g.target,b=this,p=b.tooltip,h=b.options.hint,f=null,o=h.title,n=h.content,m=h.style,l=a.isFunction(o),k=a.isFunction(n),c,e,j,i;j=a(b.canvas.canvas.parentNode).offset();if(b.indicatorLine)return;if(a(d).data("owner"))d=a(d).data("owner");d=a(d);c=d.data("wijchartDataObj");if(b.tooltip){f=p.getOptions();if(l||k){if(l)f.title=a.proxy(o,c);if(k)f.content=a.proxy(n,c)}if(c.type==="line"||c.type==="marker"){if(c.type==="marker")c=c.lineSeries;if(c.path.removed)return;if(b.hoverLine!==c||b.hoverLine===null){b.isNewLine=true;if(b.hoverLine)if(!b.hoverLine.path.removed){b.hoverLine.path.wijAttr(b.hoverLine.lineStyle);if(b.hoverPoint&&!b.hoverPoint.isSymbol){b.hoverPoint.marker.wijAttr(b.hoverPoint.markerStyle);b.hoverPoint.marker.transform("s1")}}c.lineHoverStyle&&c.path.wijAttr(c.lineHoverStyle);b.hoverLine=c;b.hoverPoint=null;b.hoverVirtualPoint=null}}else if(c.type==="scatter"||h.relativeTo==="element"){b._clearHoverState();if(c.type==="scatter")e=c.dot.getBBox();else if(d[0]&&d[0].raphael&&d[0].raphaelid){i=b.canvas.getById(d[0].raphaelid);if(i)e=i.getBBox()}f.style.stroke=m.stroke||d.attr("stroke");e&&b.tooltip.showAt({x:e.x+e.width/2,y:e.y},g)}else{b._clearHoverState();f.style.stroke=m.stroke||d.attr("stroke");b.tooltip.showAt({x:g.pageX-j.left,y:g.pageY-j.top},g)}}},_tooltipMouseMove:function(e){var d=this,b=e.target,c,g=d.options.hint,f=a(d.canvas.canvas.parentNode).offset();if(a(b).data("owner"))b=a(b).data("owner");b=a(b);c=b.data("wijchartDataObj");if(d.tooltip&&!this.indicatorLine)c.type!=="line"&&c.type!=="marker"&&c.type!=="scatter"&&g.relativeTo!=="element"&&d.tooltip.showAt({x:e.pageX-f.left,y:e.pageY-f.top},e)},_tooltipMouseOut:function(e){var d=this,b=e.target,c;if(a(b).data("owner"))b=a(b).data("owner");b=a(b);c=b.data("wijchartDataObj");if(c.type!=="line"&&c.type!=="marker"&&!d.indicatorLine)d.tooltip&&d.tooltip.hide()},_mouseMoveInsidePlotArea:function(v,r){var b=this,g=b.tooltip,k=b.options.hint,f,i,c=0,m,e,n,o,u=null,h=null,l=null,t=k.title,s=k.content,q=a.isFunction(t),p=a.isFunction(s),j=0,d;if(g)l=g.getOptions();if(b.hoverLine&&!b.indicatorLine){d=b.hoverLine;if(b.isNewLine){k.enable&&g&&g.hide();b.isNewLine=false}f=d.lineMarkers;i=d.virtualMarkers;c=-1;m={x:0,y:0};if(f&&f.length){a.each(f,function(f,b){if(b.removed)return true;var a=b.wijGetBBox(),e=a.x+a.width/2,d=Math.abs(e-r.left);if(f===0||d<j){j=d;c=f;m={x:e,y:a.y+a.height/2}}});if(b.hoverPoint&&b.hoverPoint.index===c)return;if(c>-1){if(f[c].removed)return;e=a(f[c].node).data("wijchartDataObj");if(e){if(b.hoverPoint&&!b.hoverPoint.isSymbol)if(!b.hoverPoint.removed){b.hoverPoint.marker.wijAttr(b.hoverPoint.markerStyle);b.hoverPoint.marker.transform("s1")}if(!e.isSymbol)!e.marker.removed&&e.marker.wijAttr(e.markerHoverStyle)}b.hoverPoint=e;b.hoverVirtualPoint=i[c]}}else{a.each(i,function(d,a){var b=Math.abs(a.x-r.left);if(d===0||b<j){j=b;c=d;m={x:a.x,y:a.y}}});if(b.hoverVirtualPoint&&b.hoverVirtualPoint.index===c)return;if(c>-1){b.hoverPoint=null;b.hoverVirtualPoint=i[c]}}if(g){h=b.hoverVirtualPoint;n=h.valX;o=h.valY;if(q||p){if(q)l.title=function(){var b={pointIndex:c,lineIndex:d.index,x:n,y:o,label:d.label,data:h,fmt:t},e=a.proxy(b.fmt,b),f=e();return f};if(p)l.content=function(){var b={pointIndex:c,lineIndex:d.index,x:n,y:o,label:d.label,data:h,fmt:s},f=a.proxy(b.fmt,b),e=f();return e}}u=a.extend({stroke:d.path.attr("stroke")},k.style);l.style.stroke=u.stroke;g.showAt(m)}}a.wijmo.wijchartcore.prototype._mouseMoveInsidePlotArea.apply(b,arguments)},_mouseDownInsidePlotArea:function(){a.wijmo.wijchartcore.prototype._mouseDownInsidePlotArea.apply(this,arguments);this._clearHoverState(true)},_mouseMoveOutsidePlotArea:function(){var b=this;b._clearHoverState();a.wijmo.wijchartcore.prototype._mouseMoveOutsidePlotArea.apply(b,arguments)},_clearHoverState:function(c){var a=this,b=a.tooltip,d=a.options.hint;if(a.hoverLine){d.enable&&b&&!c&&b.hide();if(!a.hoverLine.path.removed){a.hoverLine.path.wijAttr(a.hoverLine.lineStyle);if(a.hoverPoint&&!a.hoverPoint.isSymbol){a.hoverPoint.marker.wijAttr(a.hoverPoint.markerStyle);a.hoverPoint.marker.transform("s1")}}}a.hoverLine=null;a.hoverPoint=null;a.hoverVirtualPoint=null},_getTooltipText:function(){return""},_calculateParameters:function(d,g){var e=this,f=false,c,b;a.wijmo.wijchartcore.prototype._calculateParameters.apply(e,arguments);a.each(e.options.seriesList,function(b,a){if(a.type==="column"||a.type==="bar"){f=true;return false}});if(!f)return;if(d.id==="x"){c=g.unitMinor;b=e._getBarAdjustment(d);if(b===0)b=c;else if(c<b&&c!==0)b=Math.floor(b/c)*c;d.min-=b;d.max+=b;e._calculateMajorMinor(g,d)}},_getBarAdjustment:function(d){var b=0,g=this.options,f=d.max,c=d.min,e=0;a.each(g.seriesList,function(c,a){if(a.type==="pie")return true;if(a.data.x===undefined||a.data.y===undefined)return true;e=a.data.x.length;if(b<e)b=e});if(b>1)return(f-c)/b*g.clusterWidth*.0125;else if(b===1){if(c===0&&f===1){c=-1;d.min=c}return(f-c)*.0125}else return 0}})})(jQuery);