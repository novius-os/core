/*
 *
 * Wijmo Library 2.3.7
 * http://wijmo.com/
 *
 * Copyright(c) GrapeCity, Inc.  All rights reserved.
 * 
 * Licensed under the Wijmo Commercial License. Also available under the GNU GPL Version 3 license.
 * licensing@wijmo.com
 * http://wijmo.com/widgets/license/
 *
 *
 **/
(function(a){"use strict";a.widget("wijmo.wijpiechart",a.wijmo.wijchartcore,{options:{startAngle:0,radius:null,innerRadius:0,chartLabelFormatter:null,labels:{style:{},formatString:"",formatter:null,connectorStyle:{},position:"inside",offset:10},animation:{enabled:true,duration:400,easing:">",offset:10},seriesTransition:{enabled:true,duration:1e3,easing:"bounce"},seriesList:[],mouseDown:null,mouseUp:null,mouseOver:null,mouseOut:null,mouseMove:null,click:null},widgetEventPrefix:"wijpiechart",_create:function(){var b=this,c=b._getDefFill();b._hotFixForJQ1_9();a.each(this.options.seriesStyles,function(b,a){if(!a.fill)a.fill=c[b]});a.wijmo.wijchartcore.prototype._create.apply(b,arguments);b.chartElement.addClass("wijmo-wijpiechart")},destroy:function(){var f=this,e=f.chartElement,b=e.data("fields"),c=b&&b.sectors,d=b&&b.labels;e.removeClass("wijmo-wijpiechart");a.wijmo.wijchartcore.prototype.destroy.apply(this,arguments);c&&c.length&&a.each(c,function(b,a){a=null});d&&d.length&&a.each(d,function(b,a){a=null});e.data("fields",null)},_isPieChart:function(){return true},getSector:function(b){var a=this.chartElement.data("fields");return a&&a.chartElements?a.chartElements.sectors[b]:null},_bindData:function(){var f=this,h=f.options,g=h.dataSource,e=h.data,i=[],c,d,b;if(g&&e){c=e.label;d=e.value;b=e.offset;if(c&&c.bind)c=f._getBindData(g,c.bind);if(d&&d.bind)d=f._getBindData(g,d.bind);if(b&&b.bind)b=f._getBindData(g,b.bind);if(c&&a.isArray(c)&&c.length&&d&&a.isArray(d)&&d.length){a.each(d,function(e,h){var g,f=0;if(e>=0&&e<c.length)g=c[e];if(b&&a.isArray(d)&&b.length&&e>=0&&e<b.length)f=typeof b[e]==="undefined"?0:b[e];i.push({data:h,label:g,offset:f,legendEntry:true})});h.seriesList=i}}},_hanldSharedXData:function(){},_getSeriesFromTR:function(i,e,h){var d=null,g=null,b=null,f=null,c=null;e.length&&e.each(function(){g=a("th",a(this));d=a.trim(g.text());b=a("td",a(this));if(b.length)f=parseFloat(a.trim(a(b[0]).text()));c={label:d,legendEntry:true,data:f};h.push(c)})},_showSerieEles:function(b){var c=this.options.showChartLabels;if(b.sector){b.sector.show();b.sector.shadow&&b.sector.shadow.show();b.sector.tracker&&b.sector.tracker.show()}if(b.label&&c){a(b.label.node).data("legendHide",false);b.label.show();b.label.connector&&b.label.connector.show()}},_hideSerieEles:function(b){if(b.sector){b.sector.hide();b.sector.shadow&&b.sector.shadow.hide();b.sector.tracker&&b.sector.tracker.hide()}if(b.label){a(b.label.node).data("legendHide",true);b.label.hide();b.label.connector&&b.label.connector.hide()}},_hasAxes:function(){return false},_mouseMoveInsidePlotArea:function(n,g){a.wijmo.wijchartcore.prototype._mouseMoveInsidePlotArea.apply(this,arguments);if(this.isTapAndHold){var c=this,d=c.previousAngle,b=0,k=c.chartElement,j=c.tapTarget?c.tapTarget.data("wijchartDataObj"):{},m=j.pieID||"",l=k.data("fields").chartElements["sectors"+m],f=c.canvasBounds,h=(f.startX+f.endX)/2,i=(f.startY+f.endY)/2,e=Raphael.angle(g.left,g.top,h,i);if(d){b=Math.round(e-d,10);if(Math.abs(e-d>180))if(e>d)b=b-360;else b=b+360;if(b){b=Raphael.format("...r{0},{1},{2}",b,h,i);a.each(l,function(c,a){a.transform(b)});c.tooltip&&c._setTouchTooltip()}}c.previousAngle=e}},_mouseMoveOutsidePlotArea:function(){var b=this;a.wijmo.wijchartcore.prototype._mouseMoveOutsidePlotArea.apply(b,arguments);b.isTapAndHold&&b._rotateToSectorCenter()},_rotateToSectorCenter:function(l){var b=this,h=b.options.animation,j=b.chartElement,m=b.tapTarget?b.tapTarget.data("wijchartDataObj"):{},k=m.pieID||"",e=j.data("fields").chartElements["sectors"+k],f=j.data("fields").chartElements["labels"+k],d=b.canvasBounds,n=(d.startX+d.endX)/2,o=(d.startY+d.endY)/2,i,g,c;b._hideSectorElements(e,f);if(b.tooltip)g=b._getTouchttSector(l);if(b.touchttSector&&b.touchttSector===g&&Math.abs(b.targetCenterAngle)>=.01){if(b.targetCenterAngle>180)c=b.targetCenterAngle-360;else if(b.targetCenterAngle<-180)c=b.targetCenterAngle+360;else c=b.targetCenterAngle;i=Raphael.animation({transform:Raphael.format("...r{0},{1},{2}",c,n,o)},h.duration,h.easing,function(){b._rotateCallback(this,f)});a.each(e,function(b,a){a.animate(i)})}else a.each(e,function(c,a){b._rotateCallback(a,f)});b.previousAngle=null;b.isTapAndHold=false;b.tapTarget=null},_rotateCallback:function(b,e){var k=this,h=k.canvasBounds,d=(h.startX+h.endX)/2,g=(h.startY+h.endY)/2,i=b.index,c=0,j=b.attr("transform"),f;a.each(j,function(b,a){if(a[0]!=="r")return true;if(a.length>=4)c+=a[1]});if(d>0){c=c%360;b.attr("transform",Raphael.format("r{0},{1},{2}",c,d,g))}if(b.tracker){b.tracker.attr("transform",Raphael.format("r{0},{1},{2}",c,d,g));b.tracker.show()}if(b.shadow){b.shadow.attr("transform",Raphael.format("r{0},{1},{2}",c,d,g));b.shadow.show()}if(e&&e.length&&e.length>i){f=e[i];f.attr("transform",Raphael.format("r{0},{1},{2}r{3}",c,d,g,0-c));if(a(f.node).data("legendHide"))return;f.show()}},_getTouchttSector:function(d){var b=this,h=b.chartElement,g=b.tapTarget?b.tapTarget.data("wijchartDataObj"):{},k=g.pieID||"",i=h.data("fields").chartElements["sectors"+k],j=b.tooltip.getOptions(),f=j.compass,c=90,e;switch(f){case"east":c=0;break;case"south":c=270;break;case"west":c=180;break;case"north":default:c=90}a.each(i,function(j,h){var i=h.attr("transform"),f=0,g=h.angles;a.each(i,function(b,a){if(a[0]!=="r")return true;if(a.length>=4)f+=a[1]});f=f%360;if(f<0)f=360+f;f=(c+f)%360;if(d){if(h===d){b.targetCenterAngle=(g.start+g.end)/2-f;e=d;return false}}else if(g.start<=f&&g.end>=f){b.targetCenterAngle=(g.start+g.end)/2-f;e=h;return false}});return e},_setTouchTooltip:function(l){var b=this,n=b.canvasBounds,f=b.tooltip.getOptions(),m=f.compass,e=b._getTouchttSector(l),k=b.options.hint,j=k.title,i=k.content,h=a.isFunction(j),g=a.isFunction(i),d,c;if(!e||b.touchttSector&&b.touchttSector===e)return;d=a(e.node).data("wijchartDataObj");c={data:d,value:d.value,label:d.label,total:d.total};if(h||g){if(h)f.title=function(){c.fmt=j;var b=a.proxy(c.fmt,c),d=b();return d};if(g)f.content=function(){c.fmt=i;var d=a.proxy(c.fmt,c),b=d();return b}}b._showTouchTooltip(m);b.touchttSector=e},_showTouchTooltip:function(e){var c=this,d=c.chartElement,a=c.canvasBounds,b={x:0,y:0};switch(e){case"east":b={x:d.width(),y:(a.startY+a.endY)/2};break;case"south":b={x:(a.startX+a.endX)/2,y:d.height()};break;case"west":b={x:0,y:(a.startY+a.endY)/2};break;case"north":default:b={x:(a.startX+a.endX)/2,y:0}}c.tooltip.showAt(b)},_mouseDown:function(i,h){var b=this,c=a(i.target),e=b.chartElement,d,f,g;a.wijmo.wijchartcore.prototype._mouseDown.apply(b,arguments);if(a.support.isTouchEnabled){b.isTapAndHold=true;if(c.data("owner"))c=c.data("owner");b.tapTarget=c;d=h.pieID||"";f=e.data("fields").chartElements["sectors"+d];g=e.data("fields").chartElements["labels"+d];b._hideSectorElements(f,g)}},_hideSectorElements:function(c,b){a.each(c,function(d,a){a.stop();a.tracker&&a.tracker.hide();a.shadow&&a.shadow.hide();if(b&&b.length){var c=b[d];c.hide()}})},_mouseUp:function(){var b=this;a.wijmo.wijchartcore.prototype._mouseUp.apply(b,arguments);a.support.isTouchEnabled&&b.isTapAndHold&&b._rotateToSectorCenter()},_mouseOver:function(){a.wijmo.wijchartcore.prototype._mouseOver.apply(this,arguments)},_mouseOut:function(){a.wijmo.wijchartcore.prototype._mouseOut.apply(this,arguments)},_mouseMove:function(){a.wijmo.wijchartcore.prototype._mouseMove.apply(this,arguments)},_click:function(h,e){var b=this,g=b.chartElement,f,c,d;a.wijmo.wijchartcore.prototype._click.apply(b,arguments);if(a.support.isTouchEnabled&&b.tooltip){f=e.pieID||"";c=g.data("fields").chartElements["sectors"+f];if(c.length&&c.length>e.index){d=c[e.index];b._setTouchTooltip(d);b._rotateToSectorCenter(d)}}},_paintTooltip:function(){var b=this,d=b.chartElement,e=b.canvasBounds,c=d.data("fields");a.wijmo.wijchartcore.prototype._paintTooltip.apply(this,arguments);if(b.tooltip&&c)if(a.support.isTouchEnabled){b.tooltip.setOptions({closeBehavior:"none",mouseTrailing:false,animated:null,showAnimated:null,windowCollisionDetection:"fit"});b._setTouchTooltip();b._rotateToSectorCenter()}else if(c.trackers&&c.trackers.length){b.tooltip.setSelector(a(".wijchart-canvas-object",d[0]));b.tooltip.setOptions({relatedElement:c.trackers[0]})}},_paintPlotArea:function(){var b=this,c=b.options,d=b.canvasBounds,g=d.endX-d.startX,f=d.endY-d.startY,e=c.radius;if(!e)e=Math.min(g,f)/2;else{if(g<2*e)e=g/2;if(f<2*e)e=f/2}d.startX+=g/2-e;d.endX=d.startX+2*e;d.startY+=f/2-e;d.endY=d.startY+2*e;if(b.chartElement.data("fields"))b.chartElement.data("fields").seriesEles=null;b.chartElement.wijpie({canvas:b.canvas,tooltip:b.tooltip,bounds:d,radius:e,startAngle:c.startAngle,widgetName:b.widgetName,innerRadius:c.innerRadius,seriesList:c.seriesList,seriesStyles:c.seriesStyles,seriesHoverStyles:c.seriesHoverStyles,seriesTransition:c.seriesTransition,showChartLabels:c.showChartLabels,disabled:c.disabled,textStyle:c.textStyle,chartLabelStyle:c.chartLabelStyle,chartLabelFormatString:c.chartLabelFormatString,chartLabelFormatter:c.chartLabelFormatter,labels:c.labels,shadow:c.shadow,animation:c.animation,culture:b._getCulture(),mouseDown:a.proxy(b._mouseDown,b),mouseUp:a.proxy(b._mouseUp,b),mouseOver:a.proxy(b._mouseOver,b),mouseOut:a.proxy(b._mouseOut,b),mouseMove:a.proxy(b._mouseMove,b),click:a.proxy(b._click,b)})},_getTooltipText:function(e,d){var c=a(d.node),b,f;if(c.data("owner"))c=c.data("owner");b=c.data("wijchartDataObj");f={data:b,value:b.value,label:b.label,total:b.total,target:d,fmt:e};return a.proxy(e,f)()}})})(jQuery);(function(a){"use strict";a.fn.extend({wijpie:function(b){var E=function(c,d,e){b.shadow&&a.wijchart.paintShadow(c,d,e)},C=a.wijchart.getDiffAttrs,y=a.wijraphael.addClass,o=a.wijraphael.getPositionByAngle,c=this,P=b.bounds,i=b.widgetName,j=b.canvas,f=b.animation,I=b.seriesList,D=b.seriesStyles,R=b.seriesHoverStyles,k=b.radius,r=b.innerRadius,l=b.seriesTransition,U=b.showChartLabels,X=b.textStyle,m=b.labels||{style:{},formatString:"",formatter:null,connectorStyle:{},position:"inside",offset:10},T=a.extend(true,{},X,b.chartLabelStyle,m.style),u=m.formatString||b.chartLabelFormatString,q=m.formatter||b.chartLabelFormatter,Y=b.culture,n=b.disabled,J=b.mouseDown,N=b.mouseUp,L=b.mouseOver,M=b.mouseOut,K=b.mouseMove,Q=b.click,O=b.tooltip,d=c.data("fields")||{},p=d.chartElements||{},v=d.aniSectorAttrs,w=d.aniLabelAttrs,F=[],G=[],A=[],g=[],x=[],e=b.startAngle||0,t=0,Z=P.startX,ab=P.startY,H=[],B,h,s,z=j.set(),W=D.length,bb={width:0,height:0};function V(){var b={x:0,y:0},d="",e=a.isFunction;if(a.support.isTouchEnabled)d="wij";O&&O.setTargets(x);a(".wijpiechart",c[0]).live(d+"mousedown."+i,function(f){if(n)return;var b=a(f.target),d;if(b.data("owner"))b=b.data("owner");d=b.data("wijchartDataObj");if(!d)return;e(J)&&J.call(c,f,d)}).live(d+"mouseup."+i,function(f){if(n)return;var b=a(f.target),d;if(b.data("owner"))b=b.data("owner");d=b.data("wijchartDataObj");if(!d)return;e(N)&&N.call(c,f,d)}).live(d+"mouseover."+i,function(o){if(n)return;var k=a(o.target),h,m,p=f&&f.enabled,l,d,g,i,j;if(k.data("owner"))k=k.data("owner");h=k.data("wijchartDataObj");if(!h)return;m=h.pieID||"";l=h.index;d=c.data("fields").chartElements["sectors"+m][l];g=d.showAnimationTimer;i=d.hideAnimationTimer;j=d.explodeAnimationShowing;e(L)&&L.call(c,o,h);if(a.support.isTouchEnabled)return;if(d.removed)return;d.wijAttr(h.hoverStyle);if(p){if(i){window.clearTimeout(i);i=null;d.hideAnimationTimer=i}if(g){window.clearTimeout(g);g=null;d.showAnimationTimer=null}if(j)return;g=window.setTimeout(function(){var a=f.duration,c=f.easing;if(d.removed)return;b=d.getOffset(f.offset||10);d.offset=b;d.shadow&&!d.shadow.removed&&d.shadow.hide();d.wijAnimate({transform:Raphael.format("t{0},{1}",b.x,b.y)},a,c);d.tracker&&!d.tracker.removed&&d.tracker.wijAnimate({transform:Raphael.format("t{0},{1}",b.x,b.y)},a,c);j=true;d.explodeAnimationShowing=j},150);d.showAnimationTimer=g}}).live(d+"mouseout."+i,function(o){if(n)return;var k=a(o.target),g,m,p=f&&f.enabled,l,d,i,h,j;if(k.data("owner"))k=k.data("owner");g=k.data("wijchartDataObj");if(!g)return;m=g.pieID||"";l=g.index;d=c.data("fields").chartElements["sectors"+m][l];i=d.showAnimationTimer;h=d.hideAnimationTimer;j=d.explodeAnimationShowing;e(M)&&M.call(c,o,g);if(a.support.isTouchEnabled)return;if(d.removed)return;if(g.style.segment)delete g.style.segment;d.wijAttr(g.style);if(p){if(h){window.clearTimeout(h);h=null;d.hideAnimationTimer=h}if(i){window.clearTimeout(i);i=null;d.showAnimationTimer=i}if(!j)return;h=window.setTimeout(function(){var a=f.duration,c=f.easing;b=d.offset;d.shadow&&!d.shadow.removed&&d.shadow.show();!d.removed&&d.wijAnimate({transform:"t0,0"},a,c);d.tracker&&!d.tracker.removed&&d.tracker.wijAnimate({transform:"t0,0"},a,c);d.shadow&&!d.shadow.removed&&d.shadow.wijAnimate({transform:"t0,0"},a,c);b={x:0,y:0};j=false;d.explodeAnimationShowing=j},150);d.hideAnimationTimer=h}}).live(d+"mousemove."+i,function(f){if(n)return;var b=a(f.target),d;if(b.data("owner"))b=b.data("owner");d=b.data("wijchartDataObj");if(!d)return;e(K)&&K.call(c,f,d)}).live(d+"click."+i,function(f){if(n)return;var b=a(f.target),d;if(b.data("owner"))b=b.data("owner");d=b.data("wijchartDataObj");if(!d)return;e(Q)&&Q.call(c,f,d)})}function S(){a(".wijpiechart",c[0]).die(i).die("."+i)}j.customAttributes.segment=function(h,i,d,b,g,f){var e=null,c=.01;if(b-d>360-c)b-=c;else if(b-d<c)b+=c;if(f)e=a.wijchart.donut(h,i,g,f,d,b);else e=a.wijchart.sector(h,i,g,d,b);return{path:e}};a.each(I,function(b,a){if(a&&typeof a.data==="number")t+=a.data});a.each(I,function(d,c){var K=a.extend({opacity:1,stroke:"gray","stroke-width":1},D[d%W]),M=360*c.data/t,I=Z+k,J=ab+k,S,b,f,p,i,Q,n,L,X,V=m.position,cb=m.connectorStyle,db=m.offset,O,P,N,bb=false;s=c.pieID;c=a.extend(true,{offset:0},c);if(c.offset){S=o(I,J,c.offset,e+M/2);I=S.x;J=S.y}B=[I,J,e,e+M,k,r].concat(" ");if(v&&l.enabled){K.segment=B;if(d<v.length)h=v[d];else{h=a.extend(true,{},K);h.segment=[I,J,0,360,k,r].concat(" ")}b=j.path().attr(h);K=C(h,K);!b.removed&&b.wijAnimate(K,l.duration,l.easing,function(){E(b);n&&!n.removed&&!b.removed&&n.attr({path:b.attr("path")});delete K.segment})}else{b=j.path().attr({segment:B});E(b);b.wijAttr(K)}b.angles={start:e,end:e+M};b.index=d;b.getOffset=function(c){var a=o(I,J,c,(b.angles.start+b.angles.end)/2);return{x:a.x-I,y:a.y-J}};b.center={x:I,y:J};b.radius=k;if(r)b.innerRadius=r;n=b.clone();if(a.browser.msie&&a.browser.version<9)n.attr({opacity:.01,fill:"white","stroke-width":0,"fill-opacity":.01});else n.attr({opacity:.01,fill:"white","fill-opacity":.01});y(a(n.node),"wijchart-canvas-object wijpiechart pietracker wijchart-tracker"+d);a(n.node).data("owner",a(b.node));b.tracker=n;z.push(n);y(a(b.node),"wijchart-canvas-object wijpiechart wijmo-wijpiechart-series-"+d);a(b.node).data("wijchartDataObj",c);if(U){if(V==="outside"){Q=o(I,J,k,e+M/2);p=o(I,J,k+db,e+M/2)}else p=o(I,J,c.offset+k*2/3,e+M/2);i=a.extend(true,{},i,T);if(c.textStyle)i=a.extend(true,i,c.textStyle);L=c.label;if(u&&u.length>0)L=Globalize.format(L,u,Y);if(q&&a.isFunction(q)){X={index:d,value:c.data,y:c.data,total:t,chartLabel:L,chartLabelFormatter:q};L=a.proxy(q,X)()}if(w&&l.enabled)if(d<w.length){bb=true;h=w[d];h.text=L;f=j.text(0,0,"").attr(h);i=C(h,i);i.x=p.x;i.y=p.y;f.wijAnimate(i,l.duration,l.easing,function(){N&&N.show()})}else f=j.text(p.x,p.y,L).attr(i);else f=j.text(p.x,p.y,L).attr(i);if(V==="outside"){O=(e+M/2)%360;P=f.wijGetBBox();if(O>=90&&O<=270)f.transform(Raphael.format("T{0},{1}",-P.width/2,0));else f.transform(Raphael.format("T{0},{1}",P.width/2,0));N=j.path(Raphael.format("M{0} {1}L{2} {3}",Q.x,Q.y,p.x,p.y)).attr(cb);bb&&N.hide();f.connector=N}y(a(f.node),"wijchart-canvas-object wijpiechart");a(f.node).data("wijchartDataObj",c);x.push(f);g.push(f);G[d]=f.attr()}H.push({label:g[d],sector:b});if(c.visible===false){b.hide();g[d]&&g[d].hide();N&&N.hide();b.shadow&&b.shadow.hide();n.hide()}F[d]=b.attr();A.push(b);x.push(b);c.style=K;c.hoverStyle=R[d];c.index=d;c.value=c.data;c.y=c.data;c.total=t;c.type="pie";e+=M});g&&g.length&&a.each(g,function(b,a){a.toFront()});p.sectors=A;if(s){p["sectors"+s]=A;p["labels"+s]=g}p.labels=g;if(!d.chartElements)d.chartElements={};z.toFront();a.extend(true,d.chartElements,p);d.aniSectorAttrs=F;d.aniLabelAttrs=G;d.seriesEles=H;d.trackers=z;c.data("fields",d);S();V()}})})(jQuery);